"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[3337],{53337:(e,o,t)=>{t.r(o),t.d(o,{default:()=>D});var i=t(80415),l=t(9950),r=t(12257),d=t(14857),n=t(2683),a=t(4139),u=t(87233),s=t(67535),m=t(74745),c=t(9449),v=t(60666),p=t(28429),h=t(42074),y=t(26473),f=t(27081),b=t(15999),A=t(76300),x=t(29024),w=t(96951),g=t(71826),j=t(84601),I=t(10447),C=t(62054),V=t(99635),S=t(64499),k=t(26059),O=t(44414);const _=function(e,o,t,i,l){let d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];return(0,O.jsx)(r.A,{spacing:1,children:(0,O.jsx)(w.o3,{name:e,type:t,label:o,placeholder:l,InputLabelProps:{shrink:d},...i&&{required:!0}})})},W=e=>{const{conditionsArray:o,setConditionsArray:t,columnData:d,dropdownLOVs:n,setDropdownLOVs:m,formId:p}=e,[h,f]=(0,l.useState)(),[A,x]=(0,l.useState)(),I=(0,c.mN)({resolver:(0,y.t)(v.Ik().shape({fromAttributeId:j.A.other,operatorKey:j.A.other})),defaultValues:{},mode:"all"}),{handleSubmit:V}=I,S=(e,o,t,i,l,d)=>(0,O.jsx)(r.A,{children:(0,O.jsx)(w.eu,{name:e,placeholder:l,label:o,onChange:d,InputLabelProps:{shrink:!0},menus:t,...i&&{required:!0}})}),[k,W]=(0,l.useState)(),[D,T]=(0,l.useState)();return(0,O.jsx)(w.Op,{methods:I,onSubmit:V((async e=>{const{fromAttributeId:i,operatorKey:l,compareWithFormAttributeId:r,compareWithValue:d}=e;t([...o,{fromAttributeId:i,operatorKey:l,compareWithFormAttributeId:r||null,compareWithValue:d,compare_with_form_value:{name:A},form_attribute:{name:h}}]),I.reset({operatorKey:"",compareWithValue:"",compareWithFormAttributeId:"",compare_with_form_value:"",form_attribute:"",fromAttributeId:""}),m([])})),children:(0,O.jsx)(a.Ay,{container:!0,alignItems:"center",sx:{pl:4,pr:4},children:(0,O.jsxs)(a.Ay,{container:!0,rowSpacing:4,columnSpacing:3,mt:1,mb:3,direction:"row",children:[(0,O.jsx)(a.Ay,{item:!0,md:2.5,xl:2.5,children:S("fromAttributeId","Column",d.filter((e=>{var o;return!["dateOnly","timeOnly"].includes(null===(o=e.properties)||void 0===o?void 0:o.pickerType)})),!0,"Select Column",(async e=>{var o,t,i,l,r,d,n,a,u,s,c,v,h,y;I.resetField("compareWithFormAttributeId"),I.resetField("compareWithValue"),f(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.name),T(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value),W(null===e||void 0===e||null===(i=e.target)||void 0===i?void 0:i.type);const b=[{name:null===e||void 0===e||null===(l=e.target)||void 0===l?void 0:l.name,sourceTable:null===e||void 0===e||null===(r=e.target)||void 0===r||null===(d=r.row)||void 0===d||null===(n=d.properties)||void 0===n?void 0:n.sourceTable,sourceColumn:null===e||void 0===e||null===(a=e.target)||void 0===a||null===(u=a.row)||void 0===u||null===(s=u.properties)||void 0===s?void 0:s.sourceColumn,type:"and",conditions:null===e||void 0===e||null===(c=e.target)||void 0===c||null===(v=c.row)||void 0===v||null===(h=v.properties)||void 0===h?void 0:h.conditions}];if("Dropdown"===(null===e||void 0===e||null===(y=e.target)||void 0===y?void 0:y.type)){const o=await(0,g.default)("/form-get-dropdown-field-data",{method:"POST",body:{formId:p,formDropdowns:b}});var A,x,w;if(o.success)m(null===(A=o.data)||void 0===A||null===(x=A.dropdownData[0])||void 0===x?void 0:x[null===(w=e.target)||void 0===w?void 0:w.name]);else(0,C.A)(o.error.message,{variant:"error"})}}))}),(0,O.jsx)(a.Ay,{item:!0,md:.15,xl:.15}),(0,O.jsx)(a.Ay,{item:!0,md:2,xl:2,children:S("operatorKey","Operation",i.we,!0,"Select")}),(0,O.jsx)(a.Ay,{item:!0,md:.15,xl:.15}),"Dropdown"!==k&&(0,O.jsx)(a.Ay,{item:!0,md:2.5,xl:2.5,children:S("compareWithFormAttributeId","Matching Column",d.filter((e=>{var o;return!["dateOnly","timeOnly"].includes(null===(o=e.properties)||void 0===o?void 0:o.pickerType)})),!1,"Select Column",(e=>{var o;x(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.name)}))}),"Dropdown"!==k&&(0,O.jsx)(a.Ay,{item:!0,md:.5,xl:.5,sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,O.jsx)(u.A,{children:"OR"})}),"Chip Select"===k||"Checkbox"===k?(0,O.jsx)(a.Ay,{item:!0,md:2.5,xl:2.5,children:S("compareWithValue","Matching Value",I.watch("fromAttributeId")?d.filter((e=>(null===e||void 0===e?void 0:e.id)==D)).flatMap((e=>{var o,t;return Object.keys(null===e||void 0===e?void 0:e.properties).length?null===e||void 0===e||null===(o=e.properties)||void 0===o||null===(t=o.values)||void 0===t?void 0:t.split(",").map((e=>({name:e,id:e}))):[]})):[],!1,"Select Value")}):"Date Time"===k?(0,O.jsx)(a.Ay,{item:!0,md:2.5,xl:2.5,children:(0,O.jsx)(b.A,{name:"compareWithValue",label:"Matching Value",pickerType:"dateTimeBoth",timeFormat:"24hour",format:"dd/MM/yyyy HH:mm"})}):"Dropdown"===k?(0,O.jsx)(a.Ay,{item:!0,md:2.5,xl:2.5,children:S("compareWithValue","Matching Value",n,!1,"Select Value")}):(0,O.jsx)(a.Ay,{item:!0,md:2.5,xl:2.5,children:_("compareWithValue","Matching Value","text",!1,"Enter Value")}),(0,O.jsx)(a.Ay,{item:!0,md:1,sx:{mt:4},children:(0,O.jsx)(s.A,{variant:"contained",size:"small",color:"primary",type:"submit",children:"Add"})})]})})})},D=()=>{var e,o,t;const i=(0,d.A)(),{formId:b}=(0,p.g)(),D=(0,p.zy)(),T=(0,f.wA)(),M=null===(e=D.state)||void 0===e?void 0:e.blockData,[E,F]=(0,l.useState)([]),[P,H]=(0,l.useState)([]),[R,K]=(0,l.useState)(!1),[L,N]=(0,l.useState)(null===M||void 0===M||null===(o=M.form_attribute)||void 0===o?void 0:o.id),[z,B]=(0,l.useState)(null),q=(0,p.Zp)(),Q=(0,c.mN)({resolver:(0,y.t)(v.Ik().shape({name:j.A.other,message:j.A.other,type:j.A.other,fromAttribute:j.A.other})),defaultValues:{},mode:"all"}),{handleSubmit:U,setValue:$}=Q;(0,l.useEffect)((()=>{(null===M||void 0===M?void 0:M.id)&&T((0,x.NiD)(null===M||void 0===M?void 0:M.id))}),[T,null===M||void 0===M?void 0:M.id]);const{attributeValidationCondition:Z}=(0,A.I)(),G=(0,l.useMemo)((()=>{var e;return(null===Z||void 0===Z||null===(e=Z.formAttributeValidationConditionObject)||void 0===e?void 0:e.rows)||[]}),[Z]);(0,l.useEffect)((()=>{F((e=>[...e,...G]))}),[G]);(0,l.useEffect)((()=>{var e;$("name",null===M||void 0===M?void 0:M.name),$("message",null===M||void 0===M?void 0:M.message),$("type",null===M||void 0===M?void 0:M.type),$("fromAttribute",null===M||void 0===M||null===(e=M.form_attribute)||void 0===e?void 0:e.id)}),[M,$]);const J=null!==M&&void 0!==M&&M.id?async e=>{e.formId=b,e.conditionsArray=E,e.validationBlockId=null===M||void 0===M?void 0:M.id;const o=await(0,g.default)("/attribute-validation-block-update",{method:"PUT",body:e});o.success?q(`/form-validation-rules/${b}`):(0,C.A)(o.error.message,{variant:"error"})}:async e=>{e.conditionsArray=E,e.formId=b,e.primaryColumn=L;const o=await(0,g.default)("/attribute-validation-block-create",{method:"POST",body:e});o.success?q(`/form-validation-rules/${b}`):(0,C.A)(o.error.message,{variant:"error"})};(0,l.useEffect)((()=>(b&&T((0,x.u44)({formId:b,sortBy:"rank",sortOrder:"ASC"})),()=>{T(I.wF.actions.reset()),T(I.pr.actions.reset())})),[T,b]);const{formAttributes:X}=(0,A.I)(),Y=(0,l.useMemo)((()=>{var e;return(null===X||void 0===X||null===(e=X.formAttributesObject)||void 0===e?void 0:e.rows)||[]}),[null===X||void 0===X||null===(t=X.formAttributesObject)||void 0===t?void 0:t.rows]),[ee,oe]=(0,l.useState)({}),te=(0,l.useRef)([]),ie=(0,l.useCallback)((async e=>{var o;const t=null===Y||void 0===Y?void 0:Y.find((o=>o.id===e.fromAttributeId));if(t&&"dropdown"===(null===t||void 0===t||null===(o=t.default_attribute)||void 0===o?void 0:o.inputType)){var i,l,r;const o=[{name:"lov",sourceTable:null===t||void 0===t||null===(i=t.properties)||void 0===i?void 0:i.sourceTable,sourceColumn:null===t||void 0===t||null===(l=t.properties)||void 0===l?void 0:l.sourceColumn,type:"and",conditions:[{column:null===k.Q||void 0===k.Q||null===(r=k.Q.find((e=>{var o;return e.id===(null===t||void 0===t||null===(o=t.properties)||void 0===o?void 0:o.sourceTable)})))||void 0===r?void 0:r.tableIdCell,operation:"et",value:e.compareWithValue}]}],u=await(0,g.default)("/form-get-dropdown-field-data",{method:"POST",body:{formId:b,formDropdowns:o}});var d,n,a;return u.success?null===(d=u.data)||void 0===d||null===(n=d.dropdownData[0])||void 0===n||null===(a=n.lov[0])||void 0===a?void 0:a.name:""}return""}),[Y,b]);(0,l.useEffect)((()=>{Y&&Y.length>0&&(async()=>{const e=te.current,o=null===E||void 0===E?void 0:E.filter((o=>!e.includes(o)));if(o.length>0){const e=(await Promise.all(o.map((async e=>({id:e.compareWithValue,name:await ie(e)}))))).reduce(((e,o)=>{let{id:t,name:i}=o;return i&&(e[t]=i),e}),{});oe((o=>({...o,...e})))}te.current=E})()}),[E,ie,Y]);const le=[{Header:"Column",accessor:"form_attribute.name"},{Header:"Operator",accessor:"operatorKey"},{Header:"Matching Column / Value",accessor:e=>{var o,t,i,l;return"dropdown"===(null===Y||void 0===Y||null===(o=Y.find((o=>o.id===e.fromAttributeId)))||void 0===o||null===(t=o.default_attribute)||void 0===t?void 0:t.inputType)?ee[e.compareWithValue]:e.compareWithValue||(null===(i=e.compare_with_column)||void 0===i?void 0:i.name)||(null===(l=e.compare_with_form_value)||void 0===l?void 0:l.name)}}];return(0,O.jsxs)(n.A,{sx:{maxHeight:"85vh",minHeight:"85vh",overflow:"auto",border:"1px solid",borderRadius:1,borderColor:i.palette.grey.A800,boxShadow:"inherit"},children:[(0,O.jsxs)(w.Op,{methods:Q,onSubmit:U(J),children:[(0,O.jsxs)(a.Ay,{sx:{position:"absolute",top:0,width:"100%",background:"white",zIndex:10,p:2,pb:0},children:[(0,O.jsx)(a.Ay,{container:!0,children:(0,O.jsxs)(a.Ay,{item:!0,md:12,sx:{display:"flex",justifyContent:"space-between"},children:[(0,O.jsx)(u.A,{variant:"h4",children:null!==M&&void 0!==M&&M.id?"Edit Validation Rule":"Add Validation Rule"}),(0,O.jsxs)(a.Ay,{item:!0,sx:{display:"flex",gap:2},children:[(0,O.jsx)(s.A,{component:h.N_,to:"/form-validation-rules/"+b,size:"small",variant:"outlined",color:"primary",children:"Back"}),null!==M&&void 0!==M&&M.id?(0,O.jsx)(s.A,{size:"small",type:"submit",variant:"contained",color:"primary",children:"Update"}):(0,O.jsx)(s.A,{size:"small",type:"submit",variant:"contained",color:"primary",children:"Save"})]})]})}),(0,O.jsx)(m.A,{sx:{mt:2}})]}),(0,O.jsxs)(a.Ay,{container:!0,spacing:4,sx:{pl:4,pr:4,pt:2,mt:5,mb:2},children:[(0,O.jsx)(a.Ay,{item:!0,md:3,xl:3,children:_("name","Rule Name","text",!0,"Rule Name")}),(0,O.jsx)(a.Ay,{item:!0,md:3,xl:3,children:((e,o,t,i,l,d)=>{var n;return(0,O.jsx)(r.A,{children:(0,O.jsx)(w.eu,{name:e,placeholder:l,label:o,disable:"fromAttribute"==e&&(null===M||void 0===M||null===(n=M.form_attribute)||void 0===n?void 0:n.id),onChange:d,InputLabelProps:{shrink:!0},menus:t,...i&&{required:!0}})})})("fromAttribute","Primary Column",Y,!0,"Select Primary Column",(e=>{var o;N(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value)}))}),(0,O.jsx)(a.Ay,{item:!0,md:3,xl:3,children:_("message","Error Message","text",!0,"Custom Error Message")}),(0,O.jsx)(a.Ay,{item:!0,md:3,xl:3,children:(0,O.jsx)(w.eu,{name:"type",placeholder:"Select Condition Type",label:"Condition Type",menus:[{id:"and",name:"AND ( Match all of below )"},{id:"or",name:"OR ( Match any of below )"}],required:!0})})]})]}),(0,O.jsx)(W,{blockData:M,setConditionsArray:F,conditionsArray:E,columnData:Y,dropdownLOVs:P,setDropdownLOVs:H,formId:b}),(0,O.jsx)(a.Ay,{sx:{width:"95%",pl:4,pr:4,pt:2,mb:4},children:(0,O.jsx)(V.default,{hidePagination:!0,hideHistoryIcon:!0,hideViewIcon:!0,hideEditIcon:!0,hideEmptyTable:!0,hideHeader:!0,data:E.filter((e=>0!=(null===e||void 0===e?void 0:e.isActive))),columns:le,count:E.filter((e=>0!=(null===e||void 0===e?void 0:e.isActive))).length,handleRowDelete:async e=>{B(e),K(!0)}})}),(0,O.jsx)(S.A,{open:R,handleClose:()=>K(!1),handleConfirm:()=>{const e=E.findIndex((e=>(null===e||void 0===e?void 0:e.id)===z||(null===e||void 0===e?void 0:e.fromAttributeId)===(null===z||void 0===z?void 0:z.fromAttributeId)&&(null===e||void 0===e?void 0:e.operatorKey)===(null===z||void 0===z?void 0:z.operatorKey)&&(null===e||void 0===e?void 0:e.compareWithFormAttributeId)===(null===z||void 0===z?void 0:z.compareWithFormAttributeId)&&(null===e||void 0===e?void 0:e.compareWithValue)===(null===z||void 0===z?void 0:z.compareWithValue)&&!("isActive"in e)));if(-1!==e){const o={...E[e]};o.isActive=0,E[e]=o}K(!1)},title:"Delete Condition",message:"Are you sure you want to delete?",confirmBtnTitle:"Delete"})]})}}}]);