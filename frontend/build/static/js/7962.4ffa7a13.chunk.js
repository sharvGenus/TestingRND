"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[7962],{67962:(e,t,l)=>{l.r(t),l.d(t,{default:()=>A});var i=l(9950),o=l(27081),n=l(4139),a=l(87233),r=l(67535),d=l(60666),s=l(9449),u=l(26473),c=l(28429),v=l(29024),m=l(80415),p=l(88848),h=l(96951),g=l(14351),S=l(99635),x=l(71826),I=l(62054),f=l(47501),y=l(52351),b=l(52867),j=l(44414);const A=()=>{var e,t,l,A;const[_,L]=(0,i.useState)([]),[k,C]=(0,i.useState)(!1),[T,N]=(0,i.useState)(m.j7.pageIndex),[w,z]=(0,i.useState)(m.j7.pageSize),[q,O]=(0,i.useState)(),[R,E]=(0,i.useState)(),[D,H]=(0,i.useState)(!1),[M,P]=(0,i.useState)(null),[F,G]=(0,i.useState)(""),V=(0,c.Zp)(),$=(0,s.mN)({resolver:(0,u.t)(d.Ik().shape({})),defaultValues:{},mode:"all"}),B=(0,o.wA)();(0,i.useEffect)((()=>{B((0,v._G1)()),B((0,v.uiG)())}),[B]);const{masterMakerLovs:Q}=(0,p.$)(),U=((e,t)=>{const l=e&&e.filter((e=>e.name===t));return l&&l.length?l[0].id:void 0})(Q.masterMakerLovsObject.rows,"CANCELSRCTS"),{handleSubmit:Z,setValue:J}=$,K=null===_||void 0===_||null===(e=_[0])||void 0===e||null===(t=e.organization)||void 0===t?void 0:t.name,W=null===_||void 0===_||null===(l=_[0])||void 0===l||null===(A=l.organization_store)||void 0===A?void 0:A.name;(0,i.useEffect)((()=>{null!==W&&void 0!==W&&W.length&&J("fromStore",W)}),[W,J]),(0,i.useEffect)((()=>{null!==K&&void 0!==K&&K.length&&J("customerId",K)}),[K,J]),(0,i.useEffect)((()=>{var e;_&&(e=_,Object.entries(e).forEach((e=>{let[t,l]=e;J(t,l)})))}),[_,J]);const X=(0,i.useMemo)((()=>[{Header:"Name",accessor:"material.name"},{Header:"Code",accessor:"material.code"},{Header:"Quantity",accessor:"quantity"},{Header:"UOM",accessor:"uom.name"}]),[]),Y=e=>{if(e&&e.length>0){return e.map((e=>e.serialNumber))}return[]},ee=e=>{let t=[];return e&&e.length>0&&e.map((e=>t.push(e.id))),t};return(0,i.useEffect)((()=>{null!==q&&void 0!==q&&q.length&&(L(q.filter((e=>e.quantity>0&&e.otherStoreId===M))),E(q.filter((e=>e.quantity<0&&e.storeId===M)).map((e=>({...e,quantity:Math.abs(e.quantity)})))))}),[q,M]),(0,i.useEffect)((()=>{var e,t,l,i,o,n,a,r,d,s,u,c;q&&(G((0,b.ns)(null===q||void 0===q||null===(e=q[0])||void 0===e||null===(t=e.stock_ledger_detail)||void 0===t?void 0:t.supplier)),J("supplierId",null===q||void 0===q||null===(l=q[0])||void 0===l||null===(i=l.stock_ledger_detail)||void 0===i||null===(o=i.supplier)||void 0===o?void 0:o.id),J("supplier",null===q||void 0===q||null===(n=q[0])||void 0===n||null===(a=n.stock_ledger_detail)||void 0===a||null===(r=a.supplier)||void 0===r?void 0:r.name),J("receivingStoreLocationId",null===q||void 0===q||null===(d=q[0])||void 0===d||null===(s=d.other_store_location)||void 0===s?void 0:s.id),J("receivingStoreLocationName",null===q||void 0===q||null===(u=q[0])||void 0===u||null===(c=u.other_store_location)||void 0===c?void 0:c.name))}),[q,J]),(0,j.jsxs)(j.Fragment,{children:[D&&(0,j.jsx)(y.A,{}),(0,j.jsx)(h.Op,{methods:$,onSubmit:Z((async e=>{var t,l,i;H(!0);const o=(()=>{var e,t,l,i,o,n,a;const r=[];return R.map((e=>{r.push({transactionTypeId:U,projectId:e.projectId,requestNumber:e.referenceDocumentNumber,organizationId:null===e||void 0===e?void 0:e.organizationId,storeId:null===e||void 0===e?void 0:e.storeId,storeLocationId:null===e||void 0===e?void 0:e.storeLocationId,otherStoreId:null===e||void 0===e?void 0:e.otherStoreId,otherStoreLocationId:null===e||void 0===e?void 0:e.otherStoreLocationId,materialId:e.materialId,uomId:e.uomId,quantity:Math.abs(e.quantity),rate:e.rate,value:e.value,tax:e.tax,serialNumber:Y(e.material_serial_numbers)})})),{transactionTypeId:U,transactionCreatedAt:null===(e=_[0])||void 0===e?void 0:e.createdAt,fromStoreLocationId:null===(t=_[0])||void 0===t?void 0:t.storeLocationId,ltlIds:ee(q),ltlLedgerDetailId:null===_||void 0===_||null===(l=_[0])||void 0===l||null===(i=l.stock_ledger_detail)||void 0===i?void 0:i.id,supplierId:null===_||void 0===_||null===(o=_[0])||void 0===o||null===(n=o.stock_ledger_detail)||void 0===n||null===(a=n.supplier)||void 0===a?void 0:a.id,stock_ledgers:r}})(),n=await(0,x.default)("/cancel-ltl-transaction-create",{method:"POST",body:o,timeoutOverride:12e4});var a;if(!n.success)return(0,I.A)((null===n||void 0===n||null===(a=n.error)||void 0===a?void 0:a.message)||"Operation failed. Please try again!",{variant:"error"}),void H(!1);const r=null!==(t=null===(l=n.data)||void 0===l?void 0:l.data)&&void 0!==t?t:{},d=r.referenceDocumentNumber||(null===(i=r[0])||void 0===i?void 0:i.referenceDocumentNumber);(0,I.A)(d?`Transaction cancelled with reference number: ${d}`:"Transaction cancelled successfully!",{variant:"success",autoHideDuration:1e4}),H(!1),V("/stock-ledger")})),children:(0,j.jsxs)(g.A,{title:"Cancel SRCTS(Supplier Repair Center to Store)",sx:{mb:2},children:[(0,j.jsx)(f.A,{type:"stockLedger",transactionType:"SRCTS",fromStoreLabel:"Organization Store",fromStoreType:"",showFromStoreAddress:!0,showOrgType:!0,disableAll:!(null===q||void 0===q||!q.length),setReqData:O,setFromStoreId:P}),q&&q.length>0&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(n.Ay,{container:!0,spacing:4,alignItems:"center",sx:{mb:4,mt:1},children:[(0,j.jsx)(n.Ay,{item:!0,md:3,xl:2,sx:{display:"none"},children:(0,j.jsx)(h.o3,{name:"supplierId",label:"SupplierId",disabled:!0})}),(0,j.jsx)(n.Ay,{item:!0,md:3,xl:2,children:(0,j.jsx)(h.o3,{name:"supplier",label:"Supplier",disabled:!0})}),(0,j.jsxs)(n.Ay,{item:!0,md:9,xl:10,children:[(0,j.jsx)(a.A,{children:"Address: "}),(0,j.jsx)(a.A,{mt:2,children:F})]}),(0,j.jsx)(n.Ay,{item:!0,md:3,xl:2,sx:{display:"none"},children:(0,j.jsx)(h.o3,{name:"receivingStoreLocationId",label:"Receiving Store Location Id",disabled:!0})}),(0,j.jsx)(n.Ay,{item:!0,md:3,xl:2,children:(0,j.jsx)(h.o3,{name:"receivingStoreLocationName",label:"Receiving Store Location",disabled:!0})})]}),(0,j.jsx)(S.default,{title:"Cancel SRCTS",hideHeader:!0,hidePagination:!0,data:_,count:_.length,columns:X,hideActions:!0,setPageIndex:N,setPageSize:z,pageIndex:T,pageSize:w}),(0,j.jsx)(n.Ay,{item:!0,md:12,xl:2,sx:{mt:4},children:(0,j.jsxs)(n.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px"},children:[(0,j.jsx)(r.A,{onClick:()=>{C(!k),L([]),E([]),O(void 0),V("/cancel-srcts")},size:"small",variant:"outlined",color:"primary",children:"Back"}),(0,j.jsx)(r.A,{disabled:D,size:"small",type:"submit",variant:"contained",color:"primary",children:"Reverse"})]})})]})]})})]})}}}]);