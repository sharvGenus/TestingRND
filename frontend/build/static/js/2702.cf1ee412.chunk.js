"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[2702],{32702:(e,t,a)=>{a.r(t),a.d(t,{default:()=>S});var r=a(9950),n=a(27081),s=a(95537),o=a(4139),i=a(67535),d=a(60666),l=a(9449),c=a(26473),u=a(28429),m=a(29024),v=a(80415),p=a(88848),g=a(96951),f=a(14351),h=a(99635),I=a(71826),x=a(62054),y=a(47501),j=a(52351),b=a(44414);const A=[{Header:"Name",accessor:"material.name"},{Header:"Code",accessor:"material.code"},{Header:"Quantity",accessor:"quantity"},{Header:"UOM",accessor:"uom.name"}],S=()=>{const[e,t]=(0,r.useState)(null),[a,S]=(0,r.useState)([]),[N,k]=(0,r.useState)(!1),[C,O]=(0,r.useState)(v.j7.pageIndex),[z,T]=(0,r.useState)(v.j7.pageSize),[w,q]=(0,r.useState)(""),[G,L]=(0,r.useState)(),[R,D]=(0,r.useState)(!1),P=(0,u.Zp)(),E=(0,l.mN)({resolver:(0,c.t)(d.Ik().shape({})),defaultValues:{},mode:"all"}),H=(0,n.wA)();(0,r.useEffect)((()=>{H((0,m._G1)()),H((0,m.uiG)())}),[H]);const{masterMakerLovs:_}=(0,p.$)(),M=(e,t)=>{const a=e&&e.filter((e=>e.name===t));return a&&a.length?a[0].id:void 0},F=_.masterMakerLovsObject.rows,V=M(F,"CANCELGRN"),$=M(F,"GRN"),Y=M(F,"COMPANY");(0,r.useEffect)((()=>{Y&&H((0,m.qV$)({organizationType:Y}))}),[H,Y]);const{handleSubmit:B,setValue:Q}=E;(0,r.useEffect)((()=>{var e;a&&(e=a,Object.entries(e).forEach((e=>{let[t,a]=e;Q(t,a)})))}),[a,Q]);return(0,r.useEffect)((()=>{null!==G&&void 0!==G&&G.length&&S(G)}),[G]),(0,b.jsxs)(b.Fragment,{children:[R&&(0,b.jsx)(j.A,{}),(0,b.jsx)(g.Op,{methods:E,onSubmit:B((async()=>{var t,r,n;D(!0);const s=(()=>{var t,r,n;const s=[],o=[];return a.map((t=>{o.push(t.id),s.push({transactionTypeId:V,projectId:t.projectId,requestNumber:t.referenceDocumentNumber,organizationId:null===t||void 0===t?void 0:t.organizationId,storeId:e,storeLocationId:null===t||void 0===t?void 0:t.storeLocationId,materialId:t.materialId,uomId:t.uomId,quantity:t.quantity,rate:t.rate,value:t.value,tax:t.tax})})),{transactionTypeId:V,requestTransactionTypeId:$,toOrganizationId:w,requestNumber:null===(t=a[0])||void 0===t?void 0:t.referenceDocumentNumber,projectId:a[0].projectId,storeId:e,transactionCreatedAt:a[0].createdAt,remarks:a[0].remarks,grnLedgerDetailId:null===(r=a[0])||void 0===r||null===(n=r.stock_ledger_detail)||void 0===n?void 0:n.id,grnIds:o,stock_ledgers:s}})(),o=await(0,I.default)("/cancel-grn-transaction-create",{method:"POST",body:s,timeoutOverride:12e4});var i;if(!o.success)return(0,x.A)((null===o||void 0===o||null===(i=o.error)||void 0===i?void 0:i.message)||"Operation failed. Please try again!",{variant:"error"}),void D(!1);const d=null!==(t=null===(r=o.data)||void 0===r?void 0:r.data)&&void 0!==t?t:{},l=d.referenceDocumentNumber||(null===(n=d[0])||void 0===n?void 0:n.referenceDocumentNumber);(0,x.A)(l?`Transaction cancelled with reference number: ${l}`:"Transaction cancelled successfully!",{variant:"success",autoHideDuration:1e4}),D(!1),P("/stock-ledger")})),children:(0,b.jsxs)(f.A,{title:"Cancel GRN(Goods Receive Note)",sx:{mb:2},children:[(0,b.jsx)(y.A,{type:"stockLedger",transactionType:"GRN",fromStoreLabel:"Company Store",fromStoreType:"COMPANY",showFromStoreAddress:!0,setFromStoreId:t,setFromOrganizationId:q,disableAll:!(null===G||void 0===G||!G.length),setReqData:L}),G&&G.length>0&&(0,b.jsxs)(s.A,{sx:{mt:4},children:[(0,b.jsx)(h.default,{title:"Cancel GRN",hideHeader:!0,hidePagination:!0,data:a,count:a.length,columns:A,hideActions:!0,setPageIndex:O,setPageSize:T,pageIndex:C,pageSize:z}),(0,b.jsx)(o.Ay,{item:!0,md:12,xl:2,sx:{mt:4},children:(0,b.jsxs)(o.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px"},children:[(0,b.jsx)(i.A,{onClick:()=>{k(!N),S([]),L(void 0),P("/cancel-grn")},size:"small",variant:"outlined",color:"primary",children:"Back"}),(0,b.jsx)(i.A,{disabled:R,size:"small",type:"submit",variant:"contained",color:"primary",children:"Reverse"})]})})]})]})})]})}}}]);