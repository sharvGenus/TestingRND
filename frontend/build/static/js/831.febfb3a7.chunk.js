"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[831],{30831:(e,t,r)=>{r.r(t),r.d(t,{default:()=>j});var o=r(9950),n=r(27081),a=r(95537),d=r(4139),i=r(67535),l=r(60666),u=r(9449),s=r(26473),c=r(28429),v=r(29024),m=r(80415),I=r(88848),h=r(62605),p=r(96951),f=r(14351),N=r(99635),g=r(71826),y=r(62054),b=r(47501),x=r(52351),S=r(44414);const j=()=>{const[e,t]=(0,o.useState)(null),[r,j]=(0,o.useState)([]),[R,A]=(0,o.useState)(!1),[T,M]=(0,o.useState)(m.j7.pageIndex),[C,q]=(0,o.useState)(m.j7.pageSize),[_,k]=(0,o.useState)(!1),L=(0,c.Zp)(),D=(0,u.mN)({resolver:(0,s.t)(l.Ik().shape()),defaultValues:{},mode:"all"}),E=(0,n.wA)();(0,o.useEffect)((()=>{E((0,v._G1)())}),[E]);const{masterMakerLovs:w}=(0,I.$)(),z=(e,t)=>{const r=e&&e.filter((e=>e.name===t));return r&&r.length?r[0].id:null},O=w.masterMakerLovsObject.rows,P=z(O,"CANCELMRN"),H=z(O,"CANCELRETURNMRN"),U=z(O,"MRN"),{refDataThird:$}=(0,h.t)(),{responseReq:F}=(0,o.useMemo)((()=>{var e,t;return{responseReq:(null===$||void 0===$||null===(e=$.refDataThirdObject)||void 0===e?void 0:e.rows)||[],count:(null===$||void 0===$||null===(t=$.refDataThirdObject)||void 0===t?void 0:t.count)||0}}),[$]),{handleSubmit:B}=D,G=(0,o.useMemo)((()=>[{Header:"Name",accessor:"material.name"},{Header:"Code",accessor:"material.code"},{Header:"Quantity",accessor:"quantity"},{Header:"UOM",accessor:"uom.name"}]),[]),Q=e=>{if(e&&e.length>0){return e.map((e=>e.serialNumber))}return[]};(0,o.useEffect)((()=>{var e,t,o,n,a,d,i;r&&r.length>0&&E((0,v.Trr)({transactionTypeId:U,referenceDocumentNumber:null===r||void 0===r||null===(e=r[0])||void 0===e?void 0:e.requestNumber,storeId:null!==(t=r[0])&&void 0!==t&&t.otherStoreId&&null!==(null===(o=r[0])||void 0===o?void 0:o.otherStoreId)?null===(n=r[0])||void 0===n?void 0:n.otherStoreId:null===(a=r[0])||void 0===a||null===(d=a.stock_ledger_detail)||void 0===d?void 0:d.toStoreId,projectId:null===(i=r[0])||void 0===i?void 0:i.projectId}))}),[r,E,U]);const V=F,Y=e=>{let t=[];return e&&e.length>0&&e.map((e=>t.push(e.id))),t},Z=r.map((e=>({...e,quantity:Math.abs(e.quantity)})));return(0,o.useEffect)((()=>{null!==e&&void 0!==e&&e.length&&j(e)}),[e]),(0,S.jsxs)(S.Fragment,{children:[_&&(0,S.jsx)(x.A,{}),(0,S.jsx)(p.Op,{methods:D,onSubmit:B((async()=>{var e,t,o,n;k(!0);const a=(()=>{var e,t,o,n,a;const d=[],i=[];return r.map((e=>{d.push({transactionTypeId:H,projectId:null===e||void 0===e?void 0:e.projectId,requestNumber:null===e||void 0===e?void 0:e.referenceDocumentNumber,organizationId:null===e||void 0===e?void 0:e.organizationId,storeId:null===e||void 0===e?void 0:e.storeId,storeLocationId:null===e||void 0===e?void 0:e.storeLocationId,otherStoreId:null===e||void 0===e?void 0:e.otherStoreId,otherStoreLocationId:null===e||void 0===e?void 0:e.otherStoreLocationId,materialId:e.materialId,uomId:e.uomId,quantity:e.quantity>0?-e.quantity:e.quantity,rate:e.rate,value:e.value,tax:e.tax,serialNumber:Q(e.material_serial_numbers)})})),V.map((e=>{i.push({transactionTypeId:P,projectId:null===e||void 0===e?void 0:e.projectId,requestNumber:null===e||void 0===e?void 0:e.referenceDocumentNumber,organizationId:null===e||void 0===e?void 0:e.organizationId,storeId:null===e||void 0===e?void 0:e.storeId,storeLocationId:null===e||void 0===e?void 0:e.storeLocationId,otherStoreId:null===e||void 0===e?void 0:e.otherStoreId,otherStoreLocationId:null===e||void 0===e?void 0:e.otherStoreLocationId,materialId:e.materialId,uomId:e.uomId,quantity:e.quantity<0?-e.quantity:e.quantity,rate:e.rate,value:e.value,tax:e.tax,serialNumber:Q(e.material_serial_numbers)})})),{transactionTypeId:H,returnMrnTxnCreatedAt:null===r||void 0===r||null===(e=r[0])||void 0===e?void 0:e.createdAt,returnMrnIds:[...Y(r)],returnMrnDetailId:null===(t=r[0])||void 0===t||null===(o=t.stock_ledger_detail)||void 0===o?void 0:o.id,mrnIds:[...Y(V)],mrnDetailId:null===(n=V[0])||void 0===n||null===(a=n.stock_ledger_detail)||void 0===a?void 0:a.id,mrn_stock_ledgers:i,returnmrn_stock_ledgers:d}})(),d=await(0,g.default)("/cancel-return-mrn",{method:"POST",body:a,timeoutOverride:12e4});var i;if(!d.success)return(0,y.A)((null===d||void 0===d||null===(i=d.error)||void 0===i?void 0:i.message)||"Operation failed. Please try again!",{variant:"error"}),void k(!1);const l=null!==(e=null===(t=d.data)||void 0===t?void 0:t.data)&&void 0!==e?e:{},u=l.referenceDocumentNumber||(null===(o=l[0])||void 0===o?void 0:o.referenceDocumentNumber),s=null===d||void 0===d||null===(n=d.data)||void 0===n?void 0:n.referenceDocNo;(0,y.A)(u?`Transaction cancelled with reference number: ${u}`:s&&`Transaction cancelled with reference numbers ${s.CANCELMRN} and ${s.CANCELRETURNMRN}`||"Transaction cancelled successfully!",{variant:"success",autoHideDuration:1e4}),k(!1),L("/stock-ledger")})),children:(0,S.jsxs)(f.A,{title:"Cancel RETURN MRN(Return Material Return Note)",sx:{mb:2},children:[(0,S.jsx)(b.A,{type:"stockLedger",transactionType:"RETURNMRN",fromStoreLabel:"Company Store",fromStoreType:"COMPANY",showFromStoreAddress:!0,disableAll:!(null===e||void 0===e||!e.length),setReqData:t,setProjectId:()=>{}}),e&&e.length>0&&(0,S.jsxs)(a.A,{sx:{mt:4},children:[(0,S.jsx)(N.default,{title:"Cancel RETURNMRN",hideHeader:!0,hidePagination:!0,data:Z,count:r.length,columns:G,hideActions:!0,setPageIndex:M,setPageSize:q,pageIndex:T,pageSize:C}),(0,S.jsx)(d.Ay,{item:!0,md:12,xl:2,sx:{mt:4},children:(0,S.jsxs)(d.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px"},children:[(0,S.jsx)(i.A,{onClick:()=>{A(!R),j([]),t(null),L("/cancel-mrn")},size:"small",variant:"outlined",color:"primary",children:"Back"}),(0,S.jsx)(i.A,{disabled:_,size:"small",type:"submit",variant:"contained",color:"primary",children:"Reverse"})]})})]})]})})]})}}}]);