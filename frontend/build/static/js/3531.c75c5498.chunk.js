"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[3531],{60209:(e,s,t)=>{t.d(s,{k:()=>r});var a=t(9950),i=t(27081);const r=()=>{const[e,s]=(0,a.useState)({projectMasterMakerLovsObject:{},error:"",loading:!0}),[t,r]=(0,a.useState)({projectMasterMakersListObject:[],error:"",loading:!0}),[l,d]=(0,a.useState)({projectMasterMakerLovHistoryObject:{},error:"",loading:!0}),o=(0,i.d4)((e=>e.projectMasterMakerLov||{})),n=(0,i.d4)((e=>e.masterMakersLovsList||{})),u=(0,i.d4)((e=>e.projectMasterMakerLovHistory||{}));return(0,a.useEffect)((()=>{s((e=>({...e,...o})))}),[o]),(0,a.useEffect)((()=>{r((e=>({...e,...n})))}),[n]),(0,a.useEffect)((()=>{d((e=>({...e,...u})))}),[u]),{projectMasterMakerLovs:e,masterMakersLovsList:t,projectMasterMakerLovHistory:l}}},22663:(e,s,t)=>{t.d(s,{Y:()=>r});var a=t(9950),i=t(27081);const r=()=>{const[e,s]=(0,a.useState)({smtpObject:{},error:"",loading:!0}),t=(0,i.d4)((e=>e.smtp));return(0,a.useEffect)((()=>{s((e=>({...e,...t})))}),[t]),{smtp:e}}},13531:(e,s,t)=>{t.r(s),t.d(s,{default:()=>N});var a=t(9950),i=t(27081),r=t(31656),l=t(9449),d=t(26473),o=t(60666),n=t(59254),u=t(4139),c=t(87233),p=t(67535),m=t(48048),v=t(96951),j=t(84601),b=t(71826),x=t(62054),y=t(14351),h=t(80733),I=t(29024),k=t(60209),f=t(22663),g=t(44414);const A=(0,n.Ay)(m.G)((e=>{let{theme:s}=e;return{minHeight:200,"& textarea":{borderRadius:s.spacing(.5),borderColor:s.palette.grey[400],outline:0,padding:s.spacing(1)}}})),S=[{id:"ticketNumber",display:"Ticket Number"},{id:"ticketStatus",display:"Ticket Status"},{id:"issueType",display:"Issue Name"},{id:"subIssueType",display:"Sub-Issue Name"},{id:"remarks",display:"Remarks"},{id:"createdAt",display:"Created On"},{id:"updatedAt",display:"Updated On"},{id:"supervisor",display:"Supervisor Name"},{id:"ticketPriority",display:"Ticket Priority"},{id:"installer",display:"Installer Name"},{id:"description",display:"Description"}],M=e=>{var s,t,n,M;let{edit:T,data:w,onClose:L}=e;const C=(0,i.wA)(),[N,P]=(0,a.useState)(""),[E,O]=(0,a.useState)(!1),{projectsDropdown:q}=(0,h.Y)(),D=null===q||void 0===q?void 0:q.projectsDropdownObject,{projectWiseTicketMapping:H}=(0,r.C)(),F=(null===H||void 0===H||null===(s=H.projectWiseTicketMappingObject)||void 0===s?void 0:s.rows)||[],{projectMasterMakerLovs:z}=(0,k.k)(),R=(null===z||void 0===z||null===(t=z.projectMasterMakerLovsObject)||void 0===t?void 0:t.rows)||[],{smtp:_}=(0,f.Y)(),B=(null===(n=_.smtpObject)||void 0===n?void 0:n.rows)||[];(0,a.useEffect)((()=>{C((0,I.uiG)()),C((0,I.XkI)({all:!0}))}),[C]);const U=(0,l.mN)({resolver:(0,d.t)(o.Ik().shape({projectId:j.A.required,displayName:j.A.required,templateName:j.A.required,from:j.A.required,subject:j.A.required,issueIds:j.A.otherArray,subIssueIds:j.A.otherArray})),defaultValues:{projectId:(null===w||void 0===w?void 0:w.projectId)||"",displayName:(null===w||void 0===w?void 0:w.displayName)||"",templateName:(null===w||void 0===w?void 0:w.templateName)||"",from:(null===w||void 0===w?void 0:w.from)||"",subject:(null===w||void 0===w?void 0:w.subject)||"",issueIds:(null===w||void 0===w?void 0:w.issueIds)||[],subIssueIds:(null===w||void 0===w?void 0:w.subIssueIds)||[]},mode:"all"}),{handleSubmit:V,setValue:W}=U;(0,a.useEffect)((()=>{w&&P((null===w||void 0===w?void 0:w.body)||"")}),[W,w]);return(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(v.Op,{methods:U,onSubmit:V((async e=>{if(!N)return;const s={...e,body:N.replace(/[<>]/g,"")},t=await(0,b.default)(T?"/ticket-email-template-update":"/ticket-email-template-create",{method:T?"PUT":"POST",params:T?w.id:"",body:s});var a;t.success?((0,x.A)(`Successfully ${T?"updated":"created"} email template.`,{variant:"success",autoHideDuration:1e4}),L(!0)):(0,x.A)((null===t||void 0===t||null===(a=t.error)||void 0===a?void 0:a.message)||"Operation failed. Please try again.",{variant:"error"})})),children:(0,g.jsx)(y.A,{title:T?"Edit Template":w?"View Template":"Create Template",children:(0,g.jsxs)(u.Ay,{container:!0,spacing:2,children:[(0,g.jsx)(u.Ay,{item:!0,xs:12,children:(0,g.jsx)(c.A,{color:"error",children:"Note: Ticket Issue and Sub-Issue types will come from Project Wise Ticket Configurator"})}),(0,g.jsx)(u.Ay,{item:!0,xs:3,children:(0,g.jsx)(v.eu,{disable:w,name:"projectId",label:"Project",InputLabelProps:{shrink:!0},menus:D,required:!0})}),(0,g.jsx)(u.Ay,{item:!0,xs:3,children:(0,g.jsx)(v.o3,{disabled:w&&!T,name:"templateName",type:"text",label:"Template Name",InputLabelProps:{shrink:!0},required:!0})}),(0,g.jsx)(u.Ay,{item:!0,xs:3,children:(0,g.jsx)(v.o3,{disabled:w&&!T,name:"displayName",type:"text",label:"From Display Name",InputLabelProps:{shrink:!0},required:!0})}),(0,g.jsx)(u.Ay,{item:!0,xs:3,children:(0,g.jsx)(v.eu,{name:"from",label:"From",disable:w&&!T,multiple:!1,InputLabelProps:{shrink:!0},required:!0,menus:(null===B||void 0===B?void 0:B.map((e=>({id:null===e||void 0===e?void 0:e.username,name:null===e||void 0===e?void 0:e.username}))))||[]})}),(0,g.jsx)(u.Ay,{item:!0,xs:6,children:(0,g.jsx)(v.o3,{disabled:w&&!T,name:"subject",type:"text",label:"Subject",InputLabelProps:{shrink:!0},required:!0})}),(0,g.jsx)(u.Ay,{item:!0,xs:6,children:(0,g.jsx)(v.Yq,{name:"issueIds",label:"Ticket Issues",disable:w&&!T,InputLabelProps:{shrink:!0},menus:(null===(M=F.filter((e=>e.projectId===U.watch("projectId")))[0])||void 0===M?void 0:M.issueFields)||[],onChange:e=>{const s=R.filter((s=>null===e||void 0===e?void 0:e.includes(s.masterId))).map((e=>e.id));U.setValue("subIssueIds",U.watch("subIssueIds").filter((e=>s.includes(e))))},required:!0})}),(0,g.jsx)(u.Ay,{item:!0,xs:6,children:(0,g.jsx)(v.Yq,{name:"subIssueIds",label:"Ticket Sub-Issues",disable:w&&!T,menus:R.filter((e=>{var s;return null===(s=U.watch("issueIds"))||void 0===s?void 0:s.includes(e.masterId)})).map((e=>({name:e.name,id:e.id}))),required:!0})}),(0,g.jsxs)(u.Ay,{item:!0,xs:12,sm:12,children:[(0,g.jsx)(c.A,{mb:1,children:"Body*"}),(0,g.jsx)(A,{"aria-multiline":!0,rows:6,value:N,disabled:w&&!T,onChange:e=>{var s;P(null===e||void 0===e||null===(s=e.target)||void 0===s?void 0:s.value),e.target.value?E&&O(!1):O(!0)},children:(0,g.jsx)(m.P,{displayTransform:(e,s)=>"@["+s+"]",data:S,markup:"@[__display__]"})}),E&&(0,g.jsx)(c.A,{color:"error",sx:{fontSize:13},children:"Body is required"})]}),(0,g.jsxs)(u.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px"},children:[(0,g.jsx)(p.A,{size:"small",variant:"outlined",onClick:L,children:"Back"}),(0,g.jsx)(p.A,{size:"small",variant:"contained",type:"submit",children:T?"Update":"Submit"})]})]})})})})};var T=t(41137),w=t(99635),L=t(64499),C=t(89649);const N=()=>{var e,s;const t=[{Header:"Template Name",accessor:"templateName"},{Header:"Project",accessor:"project.name"},{Header:"Subject",accessor:"subject"},{Header:"Issue",accessor:e=>{var s;return null===e||void 0===e||null===(s=e.issueIds)||void 0===s?void 0:s.map(((s,t)=>{var i,r,l;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.Fragment,{children:null===(i=E.filter((s=>s.projectId===e.projectId))[0])||void 0===i||null===(r=i.issueFields)||void 0===r||null===(l=r.filter((e=>e.id===s))[0])||void 0===l?void 0:l.name},s),t<e.issueIds.length-1&&(0,g.jsx)("br",{})]})}))}},{Header:"Sub Issues",accessor:e=>{var s;return null===e||void 0===e||null===(s=e.subIssueIds)||void 0===s?void 0:s.map(((s,t)=>{var i;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.Fragment,{children:null===(i=N.filter((e=>e.id===s))[0])||void 0===i?void 0:i.name},s),t<e.subIssueIds.length-1&&(0,g.jsx)("br",{})]})}))}}],{paginations:{pageSize:l,pageIndex:d},setPageIndex:o,setPageSize:n}=(0,C.A)(),u=(0,i.wA)(),[c,p]=(0,a.useState)(!1),[m,v]=(0,a.useState)(!1),[j,y]=(0,a.useState)(null),[h,f]=(0,a.useState)(!1),A=(0,a.useRef)(null),{projectMasterMakerLovs:S}=(0,k.k)(),N=(null===S||void 0===S||null===(e=S.projectMasterMakerLovsObject)||void 0===e?void 0:e.rows)||[],{projectWiseTicketMapping:P}=(0,r.C)(),E=(null===P||void 0===P||null===(s=P.projectWiseTicketMappingObject)||void 0===s?void 0:s.rows)||[],{templateList:O}=(0,T.c)(),{templateData:q,templateCount:D}=(0,a.useMemo)((()=>{var e,s;return{templateData:(null===O||void 0===O||null===(e=O.ticketEmailTemplates)||void 0===e?void 0:e.rows)||[],templateCount:(null===O||void 0===O||null===(s=O.ticketEmailTemplates)||void 0===s?void 0:s.count)||0}}),[O]),H=(0,a.useCallback)((()=>{u((0,I.Uhy)({pageIndex:d,pageSize:l}))}),[u,d,l]);(0,a.useEffect)((()=>{H()}),[H]),(0,a.useEffect)((()=>{u((0,I.TS7)()),u((0,I.ORy)())}),[u]);return(0,g.jsxs)(g.Fragment,{children:[c?(0,g.jsx)(M,{edit:m,data:j,onClose:e=>{p(!1),v(!1),y(),e&&H()}}):(0,g.jsx)(w.default,{title:"Email Templates",setPageIndex:o,setPageSize:n,pageIndex:d,pageSize:l,hideHistoryIcon:!0,hideExportButton:!0,onClick:()=>{p(!0)},handleRowDelete:e=>{A.current=e,f(!0)},handleRowUpdate:e=>{p(!0),y(e),v(!0)},handleRowView:e=>{p(!0),y(e),v(!1)},data:q,columns:t,count:D}),(0,g.jsx)(L.A,{open:h,handleClose:()=>f(!1),handleConfirm:async()=>{const e=await(0,b.default)("/ticket-email-template-delete",{method:"DELETE",params:A.current});var s;e.success?((0,x.A)("Successfully deleted email template.",{variant:"success",autoHideDuration:1e4}),A.current=null,f(!1),H()):(0,x.A)((null===e||void 0===e||null===(s=e.error)||void 0===s?void 0:s.message)||"Operation failed. Please try again.",{variant:"error"})},title:"Confirm Delete",message:"Are you sure you want to delete?",confirmBtnTitle:"Delete"})]})}},41137:(e,s,t)=>{t.d(s,{c:()=>r});var a=t(9950),i=t(27081);const r=()=>{const[e,s]=(0,a.useState)({ticketEmailTemplates:{},error:"",loading:!0}),t=(0,i.d4)((e=>e.ticketEmailTemplates||{}));return(0,a.useEffect)((()=>{s((e=>({...e,...t})))}),[t]),{templateList:e}}}}]);