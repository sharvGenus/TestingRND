"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[930],{70930:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Q});var r=o(9950),l=o(27081),a=o(53065),i=o(57073),n=o(4139),s=o(67535),d=o(36089),u=o(26592),c=o(28429),v=o(62375),m=o(62605),S=o(26473),g=o(60666),f=o(12257),p=o(87233),x=o(9449),I=o(80733),j=o(29024),y=o(88848),h=o(3147),b=o(55519),A=o(66004),L=o(12952),k=o(79033),O=o(96951),T=o(14351),w=o(84601),C=o(60845),M=o(52867),N=o(62054),z=o(90376),E=o(44414);const q=e=>{var t,o,a,i,d;let{disableAll:u,saveData:c}=e;const[v,m]=(0,r.useState)(""),[q,_]=(0,r.useState)(null),[D,F]=(0,r.useState)(null),[P,H]=(0,r.useState)(null),V=(0,x.mN)({resolver:(0,S.t)(g.Ik().shape({projectId:w.A.project,orgTypeId:w.A.organizationType,contractorStoreId:w.A.organizationStoreId,contractor:w.A.organizationId,roleId:w.A.requiredWithLabel("Role"),installerId:w.A.requiredWithLabel("Installer"),installerStoreLocationId:w.A.installerStoreLocationId})),defaultValues:{},mode:"all"}),{handleSubmit:B,watch:$,setValue:R}=V,[G]=$(["projectId"]),U=(0,l.wA)();(0,r.useEffect)((()=>{U((0,j._G1)()),U((0,j.uiG)())}),[U]);const{projectsDropdown:Q}=(0,I.Y)(),{masterMakerLovs:W}=(0,y.$)(),Y=((e,t)=>{const o=e&&e.filter((e=>e.name===t));return o&&o.length?o[0].id:void 0})(W.masterMakerLovsObject.rows,"CTI"),[J,Z]=(0,r.useState)(!1),X=e=>{"projectId"===e&&(R("orgTypeId",null),R("contractor",null),R("contractorBranch",null),R("contractorStoreId",null),R("roleId",null),R("installerId",null),R("installerStoreLocationId",null),m("")),"orgTypeId"===e&&(R("contractor",null),R("contractorBranch",null),R("contractorStoreId",null),R("roleId",null),R("installerId",null),R("installerStoreLocationId",null),m("")),"contractor"===e&&(R("contractorBranch",null),R("contractorStoreId",null),R("roleId",null),R("installerId",null),R("installerStoreLocationId",null),m("")),"contractorBranch"===e&&(R("contractorStoreId",null),R("roleId",null),R("installerId",null),R("installerStoreLocationId",null),m("")),"contractorStoreId"===e&&(R("roleId",null),R("installerId",null),R("installerStoreLocationId",null)),"roleId"===e&&(R("installerId",null),R("installerStoreLocationId",null)),"installerId"===e&&R("installerStoreLocationId",null)},{organizationsDropdown:K,organizationsLocationDropdown:ee}=(0,b.G)(),{roleProjects:te}=(0,k.z)(),oe=(null===te||void 0===te||null===(t=te.roleProjectsObject)||void 0===t?void 0:t.rows)||[],re=null===Q||void 0===Q?void 0:Q.projectsDropdownObject,{organizationStores:le}=(0,h.E)(),{firmStoreLocations:ae,companyStoreLocations:ie}=(0,L.V)(),ne=[...(null===(o=le.organizationStoreObject)||void 0===o?void 0:o.rows)||[]],{users:se}=(0,A.k)(),de=(null===K||void 0===K?void 0:K.organizationDropdownObject)||[],ue=(null===ee||void 0===ee?void 0:ee.organizationLocationDropdownObject)||[],ce=[...de],[ve,me]=(0,r.useState)([]),Se=(null===ae||void 0===ae||null===(a=ae.firmStoreLocationsObject)||void 0===a?void 0:a.rows)||[],ge=(null===ie||void 0===ie||null===(i=ie.companyStoreLocationsObject)||void 0===i?void 0:i.rows)||[],fe=J?ge:Se,pe=(null===(d=se.usersObject)||void 0===d?void 0:d.rows)||[],xe=(e,t,o,r,l)=>(0,E.jsx)(f.A,{children:(0,E.jsx)(O.eu,{name:e,label:t,..."function"===typeof l&&{onChange:l},InputLabelProps:{shrink:!0},menus:o,...u&&{disable:!0},...r&&{required:!0}})});(0,r.useEffect)((()=>{G&&U((0,j.PBN)({selectedProject:G}))}),[U,G]);const{masterMakerOrgTypeSecond:{masterObject:Ie}}=(0,y.$)();return(0,r.useEffect)((()=>{U((0,j.rHZ)("ORGANIZATION TYPE"))}),[U]),(0,E.jsx)(E.Fragment,{children:(0,E.jsx)(T.A,{title:"Material Transfer to Installer",sx:{mb:2},children:(0,E.jsx)(O.Op,{methods:V,children:(0,E.jsxs)(n.Ay,{container:!0,spacing:4,children:[(0,E.jsx)(n.Ay,{item:!0,xs:12,sx:{textAlign:"right"},mt:-9,children:(0,E.jsx)(z.ON,{tableName:"cti",apipath:"/import-cti-transaction",forTraxns:!0})}),(0,E.jsx)(n.Ay,{item:!0,md:3,xl:2,children:xe("projectId","Project",re,!0,(()=>{X("projectId")}))}),(0,E.jsx)(n.Ay,{item:!0,md:3,xl:2,children:xe("orgTypeId","Organization Type",Ie.filter((e=>"420e7b13-25fd-4d23-9959-af1c07c7e94b"===e.id||"decb6c57-6d85-4f83-9cc2-50e0630003df"===e.id)),!0,(e=>{var t,o,r,l,a,i,n;(X("orgTypeId"),null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value)&&(U((0,j.d8s)(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value)),U((0,j.Ywh)(null===e||void 0===e||null===(r=e.target)||void 0===r?void 0:r.value)),U((0,j.qV$)({organizationType:null===e||void 0===e||null===(l=e.target)||void 0===l?void 0:l.value})),"420e7b13-25fd-4d23-9959-af1c07c7e94b"===(null===e||void 0===e||null===(a=e.target)||void 0===a?void 0:a.value)?(R("isCompany",!0),Z(!0),U((0,C.Ru)({organizationType:null===e||void 0===e||null===(i=e.target)||void 0===i?void 0:i.value}))):(R("isCompany",!1),Z(!1),U((0,C.c1)({organizationType:null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value}))))}))}),(0,E.jsx)(n.Ay,{item:!0,md:3,xl:2,children:xe("contractor","Organization",(0,M.HF)(ce),!0,(e=>{var t;if(X("contractor"),null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value){var o;F(e.target.value),_(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value);let t=ue.filter((t=>t.parent&&null!==t.parent&&t.parent.id===e.target.value));me(t)}}))}),(0,E.jsx)(n.Ay,{item:!0,md:3,xl:2,children:xe("contractorBranch","Organization Branch",(0,M.HF)(ve),!1,(e=>{var t;if(X("contractorBranch"),null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value){var o,r,l;let t=null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.row;F(t&&t.parent&&null!==t.parent?null===t||void 0===t||null===(r=t.parent)||void 0===r?void 0:r.id:e.target.value),_(null===e||void 0===e||null===(l=e.target)||void 0===l?void 0:l.value)}}))}),(0,E.jsx)(n.Ay,{item:!0,md:3,xl:2,children:xe("contractorStoreId","Organization Store",ne.filter((e=>e.organizationId===q)),!0,(e=>{var t;if(X("contractorStoreId"),null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value){var o,r;const t=((e,t)=>{const o=e&&e.filter((e=>e.id===t));return o&&o.length?o[0]:{}})(ne,e.target.value),l=t.city,a=(t.address,t.address),i=t.pincode?t.pincode:t.pinCode;let n;m(`${a}, ${l.name}, ${l.state.name}, ${l.state.country.name}, ${i}`),H(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value),n=fe.filter((t=>{var o,r,l;return t.organizationStoreId===(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value)&&(null===t||void 0===t||null===(r=t.name)||void 0===r||null===(l=r.toLowerCase())||void 0===l?void 0:l.includes("receiving"))})),n&&0===n.length&&J&&(n=fe.filter((t=>{var o,r,l;return t.organizationStoreId===(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value)&&(null===t||void 0===t||null===(r=t.name)||void 0===r||null===(l=r.toLowerCase())||void 0===l?void 0:l.includes("brought out"))})),n&&0===n.length&&(n=fe.filter((t=>{var o,r,l;return t.organizationStoreId===(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value)&&(null===t||void 0===t||null===(r=t.name)||void 0===r||null===(l=r.toLowerCase())||void 0===l?void 0:l.includes("genus supply"))})))),R("receivingStore",n&&n.length?null===(r=n[0])||void 0===r?void 0:r.id:null)}}))}),(0,E.jsxs)(n.Ay,{item:!0,md:3,xl:2,children:[(0,E.jsx)(p.A,{children:"Address: "}),(0,E.jsx)(p.A,{mt:2,children:v})]}),(0,E.jsx)(n.Ay,{item:!0,md:3,xl:2,children:xe("roleId","Role",oe,!0,(e=>{var t,o;(X("roleId"),null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value)&&U((0,j.loF)({organizationId:D,roleId:null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value,lockType:1}))}))}),(0,E.jsx)(n.Ay,{item:!0,md:3,xl:2,children:xe("installerId","Installer",pe,!0,(()=>{var e,t;X("installerId");const o=fe.filter((e=>{var t,o;return e.organizationStoreId===P&&(null===e||void 0===e||null===(t=e.name)||void 0===t||null===(o=t.toLowerCase())||void 0===o?void 0:o.includes("installer"))}));R("installerStoreLocationId",o&&o.length?null===(e=o[0])||void 0===e?void 0:e.id:null),R("installerStoreLocationName",o&&o.length?null===(t=o[0])||void 0===t?void 0:t.name:null)}))}),(0,E.jsx)(n.Ay,{item:!0,md:3,xl:2,children:xe("installerStoreLocationId","Installer Store Location",fe.filter((e=>{var t,o;return e.organizationStoreId===P&&(null===e||void 0===e||null===(t=e.name)||void 0===t||null===(o=t.toLowerCase())||void 0===o?void 0:o.includes("installer"))})),!0)}),(0,E.jsx)(n.Ay,{item:!0,md:3,xl:2,children:function(e,t,o,r){let l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(0,E.jsx)(f.A,{spacing:1,children:(0,E.jsx)(O.o3,{name:e,type:o,label:t,InputLabelProps:{shrink:l},...u&&{disabled:!0},...r&&{required:!0}})})}("remarks","Remarks","text",!1)}),!u&&(0,E.jsx)(n.Ay,{container:!0,spacing:4,children:(0,E.jsx)(n.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px"},mt:4,children:(0,E.jsx)(s.A,{size:"small",variant:"contained",onClick:B((e=>{null===e.receivingStore?(0,N.A)("Receiving store location not found for selected store.",{variant:"error",autoHideDuration:2e3}):(e.orgId=D,e.contractorId=D,e.transactionTypeId=Y,c(e))})),color:"primary",children:"Next"})})})]})})})})};var _=o(65669),D=o(14563),F=o(95615),P=o(71826),H=o(94826);const V={cursor:"pointer",fontSize:24},B=e=>{let{materials:t,onMaterailsInput:o,formData:a,selectedItems:i,view:d,update:u,showData:c,hideTaxDetails:v=!1}=e;const[f,I]=(0,r.useState)(!1),[h,b]=(0,r.useState)(null),[A,k]=(0,r.useState)(null),[C,z]=(0,r.useState)(c&&c.rate?null===c||void 0===c?void 0:c.rate:null),[q,B]=(0,r.useState)([]),[$,R]=(0,r.useState)(null),[G,U]=(0,r.useState)(""),[Q,W]=(0,r.useState)(""),[Y,J]=(0,r.useState)(null),[Z,X]=(0,r.useState)([]),[K,ee]=(0,r.useState)(!1),[te,oe]=(0,r.useState)(!1),[re,le]=(0,r.useState)(!1),ae=(0,l.wA)();(0,r.useEffect)((()=>{ae((0,j._G1)())}),[ae]);const{masterMakerLovs:ie}=(0,y.$)(),ne=ie.masterMakerLovsObject.rows,{firmStoreLocations:se,companyStoreLocations:de}=(0,L.V)(),ue=(0,M.x)(ne,"CONTRACTOR"),ce=(0,M.x)(ne,"COMPANY");(0,r.useEffect)((()=>{ue&&ae((0,j.c1B)({organizationType:ue})),ce&&ae((0,j.Ru7)({organizationType:ce}))}),[ae,ue,ce]),(0,r.useEffect)((()=>{I(!!d)}),[d,u]);const ve=(0,x.mN)({resolver:(0,S.t)(g.Ik().shape({materialId:w.A.requiredWithLabel("Material"),quantity:te?w.A.checkForInteger("Quantity",A):w.A.maxQuantity(A,!0),fromStoreLocationId:w.A.fromStoreLocationId})),defaultValues:{},mode:"all"}),{handleSubmit:me,setValue:Se,reset:ge,watch:fe}=ve,pe=fe("uom");(0,r.useEffect)((()=>{var e;(d||u)&&c&&(ee(!0),R(c),ae((0,j.a2o)({project:null===a||void 0===a?void 0:a.projectId,store:null===a||void 0===a?void 0:a.contractorStoreId,storeLocation:null===c||void 0===c?void 0:c.fromStoreLocationId,material:null===c||void 0===c?void 0:c.materialId})),ae((0,j.J9T)({project:null===a||void 0===a?void 0:a.projectId,store:null===a||void 0===a?void 0:a.contractorStoreId,storeLocation:null===c||void 0===c?void 0:c.fromStoreLocationId,material:null===c||void 0===c?void 0:c.materialId})),e=c,Object.entries(e).forEach((e=>{let[t,o]=e;"actions"!==t&&Se(t,o),"uom"===t&&Se(t,"string"===typeof o?o:o.name)})))}),[d,u,c,ge,Se,ae,a]);const xe=(0,r.useMemo)((()=>{var e;return(null===se||void 0===se||null===(e=se.firmStoreLocationsObject)||void 0===e?void 0:e.rows)||[]}),[se]),Ie=(0,r.useMemo)((()=>{var e;return(null===de||void 0===de||null===(e=de.companyStoreLocationsObject)||void 0===e?void 0:e.rows)||[]}),[de]),je=(0,r.useMemo)((()=>[...xe,...Ie]||[]),[xe,Ie]);(0,r.useEffect)((()=>{if(je){const e=je.filter((e=>{var t,o,r,l,i,n,s,d;return e.id!==c.StoreLocationId&&e.organizationStoreId===a.contractorStoreId&&("420e7b13-25fd-4d23-9959-af1c07c7e94b"===a.orgTypeId&&((null===e||void 0===e||null===(t=e.name)||void 0===t||null===(o=t.toLowerCase())||void 0===o?void 0:o.includes("receiving"))||(null===e||void 0===e||null===(r=e.name)||void 0===r||null===(l=r.toLowerCase())||void 0===l?void 0:l.includes("brought out"))||(null===e||void 0===e||null===(i=e.name)||void 0===i||null===(n=i.toLowerCase())||void 0===n?void 0:n.includes("genus supply")))||"decb6c57-6d85-4f83-9cc2-50e0630003df"===a.orgTypeId&&(null===e||void 0===e||null===(s=e.name)||void 0===s||null===(d=s.toLowerCase())||void 0===d?void 0:d.includes("receiving")))}));B(e)}}),[je,a,c]);const ye=(e,t,o,r,l,a)=>(0,E.jsx)(O.eu,{name:e,label:t,onChange:l,InputLabelProps:{shrink:!0},menus:o,...a&&{disable:!0},...r&&{required:!0}}),he=function(e,t,o,r,l){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return(0,E.jsx)(O.o3,{name:e,type:o,label:t,..."function"===typeof l&&{handleChange:l},InputLabelProps:{shrink:i},...(a||f)&&{disabled:!0},...r&&{required:!0}})},[be,Ae]=(0,r.useState)([]),[Le,ke]=(0,r.useState)([]),[Oe,Te]=(0,r.useState)(!1),[we,Ce]=(0,r.useState)(!1),Me=e=>{Ae(e)},Ne=()=>{Te(!1)},{txnByLocationMaterial:ze,serialNumbers:Ee}=(0,m.t)();let{projectSLData:qe}=(0,r.useMemo)((()=>({projectSLData:(null===ze||void 0===ze?void 0:ze.stocksObject)||[],isLoading:ze.loading||!1})),[ze]);(0,r.useEffect)((()=>{qe&&X(qe)}),[qe]),(0,r.useEffect)((()=>{if(le(!1),(null===Z||void 0===Z?void 0:Z.length)>0&&null!==Y){const e=null===Z||void 0===Z?void 0:Z[0],t=(null===$||void 0===$?void 0:$.id)+Y,o=(null===i||void 0===i?void 0:i[t])||{},r=(0,M.$G)(e.quantity),l=o.quantity||u&&(null===c||void 0===c?void 0:c.quantity)||0,a=o.material_serial_numbers||u&&(null===c||void 0===c?void 0:c.material_serial_numbers)||[];Se("qtyStk",r),Se("quantity",l),Se("rate",parseFloat(e.rate).toFixed(2)),Se("tax",e.tax),Se("value",null!==c&&void 0!==c&&c.quantity?parseFloat(e.rate*c.quantity).toFixed(2):"0"),Ae(a),k(r),z(parseFloat(e.rate).toFixed(2))}else Se("qtyStk",null!==Y?0:null),Se("rate","0"),z(0),Se("tax","0"),Se("value","0"),k(null)}),[Z,Se,i,u,$,Y,c]);const{serialNumbersData:_e}=(0,r.useMemo)((()=>{var e;return{serialNumbersData:(null===Ee||void 0===Ee?void 0:Ee.data)||[],countSN:(null===Ee||void 0===Ee||null===(e=Ee.data)||void 0===e?void 0:e.count)||0}}),[Ee]);return(0,E.jsx)(E.Fragment,{children:(0,E.jsx)(T.A,{sx:{mb:2,pb:4},children:(0,E.jsxs)(O.Op,{methods:ve,children:[re&&(0,E.jsx)(H.A,{}),(0,E.jsxs)(n.Ay,{container:!0,spacing:2,sx:{mt:2},children:[(0,E.jsx)(n.Ay,{item:!0,xs:12,sm:4,children:ye("materialId","Material",(0,M.Jw)(t),!0,(e=>{var t;if(null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value){var o;let t=null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.row;Se("code",null===t||void 0===t?void 0:t.code),Se("uom",null===t||void 0===t?void 0:t.uomName),Se("fromStoreLocationId",null),J(null),Se("quantity",null),k(null),Se("qtyStk",null),R(t)}}),!!u)}),(0,E.jsx)(n.Ay,{item:!0,xs:12,sm:4,children:he("code","Code","text",!0,void 0,!0)}),(0,E.jsx)(n.Ay,{item:!0,xs:12,sm:4,children:ye("fromStoreLocationId","Receiving Store Location",q,!0,(e=>{var t,o,r,l,i;null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value&&(le(!0),Ae([]),ke([]),c.material_serial_numbers=[],Se("qtyStk","0"),k("0"),W(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.name),J(null===e||void 0===e||null===(r=e.target)||void 0===r?void 0:r.value),ae((0,j.a2o)({project:null===a||void 0===a?void 0:a.projectId,store:null===a||void 0===a?void 0:a.contractorStoreId,storeLocation:null===e||void 0===e||null===(l=e.target)||void 0===l?void 0:l.value,material:null===$||void 0===$?void 0:$.id})),ae((0,j.J9T)({project:null===a||void 0===a?void 0:a.projectId,store:null===a||void 0===a?void 0:a.contractorStoreId,storeLocation:null===e||void 0===e||null===(i=e.target)||void 0===i?void 0:i.value,material:null===$||void 0===$?void 0:$.id})))}),!1)}),(0,E.jsx)(n.Ay,{item:!0,xs:12,sm:2,children:he("quantity","Quantity",(0,M.VF)(pe)?"text":"number",!0,(e=>{var t,o;(0,M.VF)(pe)?oe(!1):oe(!0),b(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value),Se("value",((null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value)*C).toFixed(2))}))}),(0,E.jsx)(n.Ay,{item:!0,xs:12,sm:2,children:he("qtyStk","Qty In Stock","number",!1,void 0,!0)}),(0,E.jsx)(n.Ay,{item:!0,xs:12,sm:2,children:he("uom","UOM","text",!0,void 0,!0)}),(0,E.jsx)(n.Ay,{item:!0,xs:12,sm:2,style:{display:"none"},children:he("uomId","UOMId","text",!0)}),(0,E.jsx)(n.Ay,{item:!0,xs:12,sm:2,...v&&{display:"none"},children:he("rate","Rate","text",!0,(e=>{var t;z(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value)}),!0)}),(0,E.jsx)(n.Ay,{item:!0,xs:12,sm:2,...v&&{display:"none"},children:he("tax","Tax%","text",!0,void 0,!0)}),(0,E.jsx)(n.Ay,{item:!0,xs:12,sm:2,...v&&{display:"none"},children:he("value","Value","number",!0,void 0,!0)}),(0,E.jsxs)(n.Ay,{item:!0,xs:12,sm:2,sx:{textAlign:"center"},children:[((null===$||void 0===$?void 0:$.isSerialNumber)||u&&(null===c||void 0===c?void 0:c.isSerialNumber))&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(p.A,{mb:-1,children:"SerialNumber"})," ",(0,E.jsx)("br",{})," ",(0,E.jsx)(s.A,{size:"small",onClick:()=>{ke(_e[(null===$||void 0===$?void 0:$.id)||(null===c||void 0===c?void 0:c.materialId)]),Ce(!0)},variant:"contained",color:"primary",children:"View"})]}),G&&""!==G&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("br",{}),(0,E.jsx)(p.A,{color:"error",sx:{fontSize:12,marginTop:2},children:G})]})]}),(0,E.jsx)(n.Ay,{item:!0,xs:12,sm:2,mt:4,textAlign:"right",children:!d&&(0,E.jsx)(s.A,{size:"small",onClick:me((async e=>{if($&&null!==$&&void 0!==$&&$.isSerialNumber&&0===be.length)U("Serial Number is required");else if($&&null!==$&&void 0!==$&&$.isSerialNumber&&be.length!==e.quantity)U(`Please select a total of ${e.quantity} serial numbers`);else{U(!1),be&&(e.material_serial_numbers=be),e.tax=0===e.tax?"0":e.tax,e.fromStoreLocationName=Q;const r=await(0,P.default)("/installation-check",{method:"POST",body:{projectId:a.projectId,installerOrgId:a.orgId,installerStoreId:a.contractorStoreId,isCompany:a.isCompany,materialId:e.materialId,...$.isSerialNumber&&{serialNumber:e.material_serial_numbers}}});var t;if(r.success&&(o(e,null===$||void 0===$?void 0:$.id,(null===$||void 0===$?void 0:$.id)+Y),Ae([]),ke([]),R(null),X([]),Se("qtyStk",null),k(null),ee(!1),ge()),r.error&&r.error.message)(0,N.A)((null===r||void 0===r||null===(t=r.error)||void 0===t?void 0:t.message)||"Operation failed. Please try again!",{variant:"error"})}})),variant:"contained",color:"primary",children:K?"Update":"Add"})})]}),(0,E.jsx)(_.A,{open:Oe,onClose:Ne,"aria-labelledby":"modal-modal-title",children:(0,E.jsx)(D.default,{handleCloseSerial:Ne,closeCss:V,quantity:h,setSerialNumbers:Me})}),we&&(0,E.jsx)(F.default,{open:we,onClose:()=>{Ce(!1)},maxQuantity:h,serialNumberData:Le,showCheckboxes:!0,onSave:e=>{Me(e)},selectedSerials:be})]})})})};var $=o(99635),R=o(52351),G=o(68388);const U=e=>{let{values:t,onEdit:o,onDelete:r,onView:l}=e;return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(a.A,{title:"Edit",placement:"bottom",children:(0,E.jsx)(i.A,{color:"secondary",onClick:()=>o(t),children:(0,E.jsx)(d.A,{})})}),(0,E.jsx)(a.A,{title:"Delete",placement:"bottom",children:(0,E.jsx)(i.A,{color:"secondary",onClick:()=>r(t),children:(0,E.jsx)(u.A,{})})}),(null===t||void 0===t?void 0:t.isSerialNumber)&&(0,E.jsx)(a.A,{title:"View Serial Number",placement:"bottom",children:(0,E.jsx)(i.A,{color:"secondary",onClick:()=>l(t),children:(0,E.jsx)(v.A,{})})})]})},Q=()=>{const e=(0,c.Zp)(),[t,o]=(0,r.useState)([]),[a,i]=(0,r.useState)(!1),[d,u]=(0,r.useState)([]),[v,S]=(0,r.useState)([]),[g,f]=(0,r.useState)({}),[p,x]=(0,r.useState)({}),[I,y]=(0,r.useState)(!1),[h,b]=(0,r.useState)(!1),[A,L]=(0,r.useState)(null),[k,T]=(0,r.useState)(!1),[w,C]=(0,r.useState)(null),[M,z]=(0,r.useState)(!1),[_,D]=(0,r.useState)(null),H=(0,l.wA)(),V=(0,r.useMemo)((()=>[{Header:"Actions",accessor:"actions"},{Header:"Name",accessor:"name"},{Header:"Code",accessor:"code"},{Header:"Quantity",accessor:"quantity"},{Header:"UOM",accessor:"uomName"},{Header:"From Store Location",accessor:"fromStoreLocationName"}]),[]),Q=()=>{u([]),x({}),f({}),b(!1),L(null)},W=(0,r.useCallback)((e=>{y(!1),b(!0),f({...e,StoreLocationId:null===A||void 0===A?void 0:A.contractorStoreLocationId})}),[A]),Y=e=>{D(e),z(!0),null!==e&&void 0!==e&&e.material_serial_numbers||C([])};(0,r.useEffect)((()=>{null!==_&&void 0!==_&&_.material_serial_numbers&&C(null===_||void 0===_?void 0:_.material_serial_numbers)}),[_]);const{transactionMaterialList:J,serialNumbers:Z}=(0,m.t)(),{materials:X}=(0,r.useMemo)((()=>{var e;return{materials:(null===J||void 0===J?void 0:J.stocksObject)||[],count:(null===J||void 0===J||null===(e=J.stocksObject)||void 0===e?void 0:e.count)||0}}),[J]),{serialNumbersData:K}=(0,r.useMemo)((()=>{var e;return{serialNumbersData:(null===Z||void 0===Z?void 0:Z.data)||[],countSN:(null===Z||void 0===Z||null===(e=Z.data)||void 0===e?void 0:e.count)||0}}),[Z]);(0,r.useEffect)((()=>{if(a&&X){const e=(e=>{const t=[];return e&&e.length>0&&e.map((e=>{t.push({id:e.id,name:e.name,isSerialNumber:e.is_serial_number,tax:e.tax>0?e.tax:"0",value:e.value,uomName:e.uom_name,uomId:e.uom_id,rate:parseFloat(e.rate).toFixed(2),code:e.code,hsnCode:e.hsn_code,material_serial_numbers:K[e.id]?K[e.id]:[]})})),t})(X);o(e.filter((e=>"84b473e1-62bb-4afe-af56-1691bdffbc55"!==e.id)))}}),[X,K,a,W]);const ee=(0,G.A)({dataObject:J,key:"stocksObject",resetTrigger:null===A});return(0,r.useEffect)((()=>{Array.isArray(ee)&&0===ee.length&&(Q(),(0,N.A)("There are no available materials for your selected combination",{variant:"error"}))}),[ee]),(0,E.jsxs)(E.Fragment,{children:[k&&(0,E.jsx)(R.A,{}),(0,E.jsx)(q,{disableAll:!!A,onClick:Q,saveData:e=>{e&&e.projectId&&e.contractorStoreId&&(L(e),i(!0),H((0,j.UjX)({project:e.projectId,store:e.contractorStoreId})))}}),A&&t&&t.length>0&&(0,E.jsx)(B,{materials:t,onMaterailsInput:(e,o,r)=>{((e,o)=>{o&&(t.map((t=>{let r={};if(t.id===e.materialId){r={...structuredClone(t),...e},r.uomId=null===t||void 0===t?void 0:t.uomId;let l=v;l.push(r.fromStoreLocationId),S(l);const a=d.findIndex((t=>t.id===o&&(null===e||void 0===e?void 0:e.fromStoreLocationId)===(null===t||void 0===t?void 0:t.fromStoreLocationId)));if(a>=0){const e=structuredClone(d);e[a]=r,u(e)}else u(d.concat(r))}})),b(!1))})(e,o);const l=p;l[r]||(l[r]={}),l[r]=e,x(l)},hideTaxDetails:!0,formData:A,view:I,update:h,showData:g,selectedLocations:v,selectedItems:p}),A&&d&&d.length>0&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)($.default,{title:"Material Transfer Contractor To Store",hideHeader:!0,hidePagination:!0,data:(e=>{const t=[];return e&&e.length>0&&e.map(((e,o)=>{t.push({...e,actions:(0,E.jsx)(U,{values:e,onEdit:W,onDelete:e=>{((e,t)=>{if(d){const o=d.filter(((t,o)=>o!==e));let r=[];o.map((e=>r.push(e.fromStoreLocationId))),u(o),S(r),delete p[t.materialId+t.fromStoreLocationId]}})(o,e)},onView:Y})})})),t})(d),count:d.length,columns:V,hideActions:!0}),M&&_&&w&&(0,E.jsx)(F.default,{open:M,onClose:()=>{z(!1)},serialNumberData:w})]}),(0,E.jsx)(O.Op,{children:(0,E.jsx)(n.Ay,{container:!0,spacing:4,children:(0,E.jsxs)(n.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px",mt:2},children:[A&&(0,E.jsx)(s.A,{onClick:Q,size:"small",variant:"outlined",color:"primary",children:"Back"}),A&&t&&t.length>0&&(0,E.jsx)(s.A,{disabled:h||k,onClick:async()=>{var t,o,r,l;T(!0);const a={transactionTypeId:A.transactionTypeId,stock_ledgers:(i=d,n=A,i.filter((e=>parseFloat(e.quantity)>0)).map((e=>({transactionTypeId:n.transactionTypeId,organizationId:n.contractorId,projectId:n.projectId,fromStoreLocationId:e.fromStoreLocationId,storeId:n.contractorStoreId,storeLocationId:n.installerStoreLocationId,installerId:n.installerId,materialId:e.id,uomId:e.uomId,quantity:e.quantity,rate:e.rate,value:e.value,tax:e.tax,remarks:n.remarks,serialNumber:e.material_serial_numbers}))))};var i,n;if(0===(null===(t=a.stock_ledgers)||void 0===t?void 0:t.length))return(0,N.A)("Please have atleast one material with some quantity",{variant:"error"}),void T(!1);const s=await(0,P.default)("/cti-transaction-create",{method:"POST",body:a,timeoutOverride:12e4});var u;if(!s.success)return(0,N.A)((null===s||void 0===s||null===(u=s.error)||void 0===u?void 0:u.message)||"Operation failed. Please try again!",{variant:"error"}),void T(!1);const c=null!==(o=null===(r=s.data)||void 0===r?void 0:r.data)&&void 0!==o?o:{},v=c.referenceDocumentNumber||(null===(l=c[0])||void 0===l?void 0:l.referenceDocumentNumber);(0,N.A)(v?`Transaction created with reference number: ${v}`:"Transaction created successfully!",{variant:"success",autoHideDuration:1e4}),T(!1),e("/stock-ledger")},size:"small",variant:"contained",color:"primary",children:"Submit"})]})})})]})}},88848:(e,t,o)=>{o.d(t,{$:()=>a});var r=o(9950),l=o(27081);const a=()=>{const[e,t]=(0,r.useState)({masterMakerLovsObject:{},error:"",loading:!0}),[o,a]=(0,r.useState)({masterMakerLovsObject:{},error:"",loading:!0}),[i,n]=(0,r.useState)({masterObject:[],error:"",loading:!0}),[s,d]=(0,r.useState)({masterObject:[],error:"",loading:!0}),[u,c]=(0,r.useState)({masterObject:[],error:"",loading:!0}),[v,m]=(0,r.useState)({currencyObject:[],error:"",loading:!0}),[S,g]=(0,r.useState)({gstStatusObject:[],error:"",loading:!0}),[f,p]=(0,r.useState)({paymentTermObject:[],error:"",loading:!0}),[x,I]=(0,r.useState)({incotermsObject:[],error:"",loading:!0}),[j,y]=(0,r.useState)({titleObject:[],error:"",loading:!0}),[h,b]=(0,r.useState)({masterMakerLovHistoryObject:{},error:"",loading:!0}),A=(0,l.d4)((e=>e.masterMakerLov||{})),L=(0,l.d4)((e=>e.masterMakerLovList||{})),k=(0,l.d4)((e=>e.lovsForMasterName||[])),O=(0,l.d4)((e=>e.lovsForMasterNameSecond||[])),T=(0,l.d4)((e=>e.lovsForMasterNameThird||[])),w=(0,l.d4)((e=>e.currency||[])),C=(0,l.d4)((e=>e.gstStatus||[])),M=(0,l.d4)((e=>e.paymentTerm||[])),N=(0,l.d4)((e=>e.incoterms||[])),z=(0,l.d4)((e=>e.title||[])),E=(0,l.d4)((e=>e.masterMakerLovHistory||{}));return(0,r.useEffect)((()=>{t((e=>({...e,...A})))}),[A]),(0,r.useEffect)((()=>{a((e=>({...e,...L})))}),[L]),(0,r.useEffect)((()=>{n((e=>({...e,...k})))}),[k]),(0,r.useEffect)((()=>{d((e=>({...e,...O})))}),[O]),(0,r.useEffect)((()=>{c((e=>({...e,...T})))}),[T]),(0,r.useEffect)((()=>{m((e=>({...e,...w})))}),[w]),(0,r.useEffect)((()=>{g((e=>({...e,...C})))}),[C]),(0,r.useEffect)((()=>{p((e=>({...e,...M})))}),[M]),(0,r.useEffect)((()=>{I((e=>({...e,...N})))}),[N]),(0,r.useEffect)((()=>{y((e=>({...e,...z})))}),[z]),(0,r.useEffect)((()=>{b((e=>({...e,...E})))}),[E]),{masterMakerLovs:e,masterMakerLovsList:o,masterMakerOrgType:i,masterMakerOrgTypeSecond:s,masterMakerOrgTypeThird:u,masterMakerCurrency:v,masterMakerGstStatus:S,masterMakerIncoterms:x,masterMakerPaymentTerm:f,masterMakerLovHistory:h,masterMakerTitle:j}}},79033:(e,t,o)=>{o.d(t,{z:()=>a});var r=o(9950),l=o(27081);const a=()=>{const[e,t]=(0,r.useState)({rolesObject:{},error:"",loading:!0}),[o,a]=(0,r.useState)({roleProjectsObject:[],error:"",loading:!0}),[i,n]=(0,r.useState)({rolesHistoryObject:{},error:"",loading:!0}),s=(0,l.d4)((e=>e.roles||{})),d=(0,l.d4)((e=>e.roleProjects||[])),u=(0,l.d4)((e=>e.rolesHistory||{}));return(0,r.useEffect)((()=>{t((e=>({...e,...s})))}),[s]),(0,r.useEffect)((()=>{a((e=>({...e,...d})))}),[d]),(0,r.useEffect)((()=>{n((e=>({...e,...u})))}),[u]),{roles:e,roleProjects:o,rolesHistory:i}}},66004:(e,t,o)=>{o.d(t,{k:()=>l});var r=o(27081);const l=()=>({users:(0,r.d4)((e=>e.users)),usersByPermission:(0,r.d4)((e=>e.usersByPermission)),usersWithForms:(0,r.d4)((e=>e.usersWithForms)),usersSecond:(0,r.d4)((e=>e.usersSecond)),usersHistory:(0,r.d4)((e=>e.usersHistory)),supervisorUsers:(0,r.d4)((e=>e.supervisorUsers))})},62375:(e,t,o)=>{var r=o(24994);t.A=void 0;var l=r(o(79526)),a=o(44414);t.A=(0,l.default)((0,a.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")}}]);