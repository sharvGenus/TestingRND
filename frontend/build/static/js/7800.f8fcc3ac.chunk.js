"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[7800],{7800:(e,l,i)=>{i.r(l),i.d(l,{default:()=>B});var o=i(9950),t=i(27081),a=i(53065),n=i(57073),r=i(4139),d=i(67535),s=i(36089),u=i(28429),c=i(12952),v=i(26473),m=i(60666),p=i(74745),x=i(9449),h=i(29024),y=i(96951),b=i(14351),j=i(62472),f=i(44414);const g=e=>{let{saveData:l}=e;const[i,a]=(0,o.useState)([]),[n,s]=(0,o.useState)(),u=(0,x.mN)({resolver:(0,v.t)(m.Ik().shape({})),defaultValues:{},mode:"all"}),{handleSubmit:c,setValue:g}=u,S=(0,t.wA)(),A="420e7b13-25fd-4d23-9959-af1c07c7e94b";(0,o.useEffect)((()=>{A&&S((0,h.qV$)({organizationType:A}))}),[S,A]);return(0,o.useEffect)((()=>{var e,l,i,o,t,r,d,s,u,c,v,m,p,x;n&&n.length>0&&(a(n),g("fromProject",null===n||void 0===n||null===(e=n[0])||void 0===e||null===(l=e.project)||void 0===l?void 0:l.name),g("fromStore",null===n||void 0===n||null===(i=n[0])||void 0===i||null===(o=i.organization_store)||void 0===o?void 0:o.name),g("placeOfSupply",null===n||void 0===n||null===(t=n[0])||void 0===t||null===(r=t.stock_ledger_detail)||void 0===r?void 0:r.placeOfSupply),g("eWayBillNumber",null===n||void 0===n||null===(d=n[0])||void 0===d||null===(s=d.stock_ledger_detail)||void 0===s?void 0:s.eWayBillNumber),g("eWayBillDate",null===n||void 0===n||null===(u=n[0])||void 0===u||null===(c=u.stock_ledger_detail)||void 0===c||null===(v=c.eWayBillDate)||void 0===v||null===(m=v.split("T"))||void 0===m?void 0:m[0]),g("vehicleNumber",null===n||void 0===n||null===(p=n[0])||void 0===p||null===(x=p.stock_ledger_detail)||void 0===x?void 0:x.vehicleNumber))}),[n,g]),(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(b.A,{title:"Material Transfer Project To Project GRN",sx:{mb:2},children:(0,f.jsxs)(y.Op,{methods:u,children:[(0,f.jsx)(j.A,{fromStoreLabel:"Company Store",type:"stockLedger",approvedOnly:!0,transactionType:"PTP",disableAll:!(null===i||void 0===i||!i.length),setReqData:s,showBranchAlso:!0,showFromStoreAddress:!0,withSerial:!0,getFromOtherStore:!0}),n&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(r.Ay,{container:!0,spacing:4,children:[(0,f.jsx)(r.Ay,{item:!0,md:3,xl:2,children:(0,f.jsx)(y.o3,{InputLabelProps:{shrink:!0},name:"fromProject",label:"From Project",type:"text",disabled:!0})}),(0,f.jsx)(r.Ay,{item:!0,md:3,xl:2,children:(0,f.jsx)(y.o3,{InputLabelProps:{shrink:!0},name:"fromStore",label:"From Company Store",type:"text",disabled:!0})}),(0,f.jsx)(r.Ay,{item:!0,md:3,xl:2,children:(0,f.jsx)(y.o3,{InputLabelProps:{shrink:!0},name:"placeOfSupply",label:"Place of Supply",type:"text",disabled:!0})}),(0,f.jsx)(r.Ay,{item:!0,md:3,xl:2,children:(0,f.jsx)(y.o3,{InputLabelProps:{shrink:!0},name:"vehicleNumber",label:"Vehicle No. / LR No.",type:"text",disabled:!0})}),(0,f.jsx)(r.Ay,{item:!0,md:3,xl:2,children:(0,f.jsx)(y.o3,{InputLabelProps:{shrink:!0},name:"eWayBillNumber",label:"E-Way Bill Number",type:"text",disabled:!0})}),(0,f.jsx)(r.Ay,{item:!0,md:3,xl:2,children:(0,f.jsx)(y.o3,{InputLabelProps:{shrink:!0},name:"eWayBillDate",label:"E-Way Bill Date",type:"text",disabled:!0})}),(0,f.jsx)(r.Ay,{item:!0,md:3,xl:2,children:(0,f.jsx)(y.o3,{InputLabelProps:{shrink:!0},name:"remarks",label:"Remarks",type:"text"})})]}),(0,f.jsxs)(r.Ay,{container:!0,spacing:4,children:[(0,f.jsx)(r.Ay,{container:!0,spacing:4,children:(0,f.jsx)(r.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px"},children:(0,f.jsx)(d.A,{size:"small",variant:"contained",onClick:c((e=>{var o,t,a,n,r,d,s,u;l({transactionTypeId:"c384a987-d92c-481f-9223-605dd3d05338",fromProjectId:null===i||void 0===i||null===(o=i[0])||void 0===o||null===(t=o.project)||void 0===t?void 0:t.id,toProjectId:null===i||void 0===i||null===(a=i[0])||void 0===a||null===(n=a.other_project)||void 0===n?void 0:n.id,fromStoreId:null===i||void 0===i||null===(r=i[0])||void 0===r||null===(d=r.organization_store)||void 0===d?void 0:d.id,toStoreId:null===i||void 0===i||null===(s=i[0])||void 0===s||null===(u=s.other_store)||void 0===u?void 0:u.id,placeOfSupply:null===e||void 0===e?void 0:e.placeOfSupply,eWayBillNumber:null===e||void 0===e?void 0:e.eWayBillNumber,eWayBillDate:null===e||void 0===e?void 0:e.eWayBillDate,vehicleNumber:null===e||void 0===e?void 0:e.vehicleNumber,remarks:e.remarks,materials:i})})),color:"primary",children:"Next"})})}),(0,f.jsx)(r.Ay,{container:!0,sx:{mt:3,mb:3},children:(0,f.jsx)(r.Ay,{item:!0,md:12,xl:12,children:(0,f.jsx)(p.A,{})})})]})]})]})})})};var S=i(87233),A=i(84601),I=i(52867),N=i(95615);const k=e=>{let{onMaterailsInput:l,storeLocationData:i,view:t,update:a,showData:n}=e;const[s,u]=(0,o.useState)(!1),[c,p]=(0,o.useState)(n&&n.quantity?null===n||void 0===n?void 0:n.quantity:null),[h,j]=(0,o.useState)(n&&n.rate?null===n||void 0===n?void 0:n.rate:null),[g,k]=(0,o.useState)(!1),[L,_]=(0,o.useState)([]),[P,D]=(0,o.useState)(!1),[C,B]=(0,o.useState)(null),W=(0,x.mN)({resolver:(0,v.t)(m.Ik().shape({storeLocationId:A.A.requiredWithLabel("Store Location")})),defaultValues:{},mode:"all"}),{handleSubmit:w,setValue:q,reset:O,watch:T}=W,F=T("uomName");(0,o.useEffect)((()=>{u(!!t)}),[t,a]),(0,o.useEffect)((()=>{var e,l;(t||a)&&n&&(l=n,Object.entries(l).forEach((e=>{let[l,i]=e;q(l,i)})),B(n),j(n.rate),p(n.quantity),_(null!==(e=null===n||void 0===n?void 0:n.material_serial_numbers)&&void 0!==e?e:[]),D(null===n||void 0===n?void 0:n.isSerialNumber),n&&n.rate&&j(n.rate))}),[t,a,n,q]);(0,o.useEffect)((()=>{c&&h&&q("value",parseFloat(c*h).toFixed(2))}),[c,h,q,O]);const z=function(e,l,i,o,t){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return(0,f.jsx)(y.o3,{name:e,type:i,label:l,handleChange:t,InputLabelProps:{shrink:n},...(a||s)&&{disabled:!0},...o&&{required:!0}})},E=["faulty","scrap","missing","consumed","billing","installed","installer","old","service-center","service center","defective","damage","non-repairable","non repairable"];return(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(b.A,{sx:{mb:2,pb:4},children:(0,f.jsxs)(y.Op,{methods:W,children:[(0,f.jsxs)(r.Ay,{container:!0,spacing:2,sx:{mt:2,mb:2.5},children:[(0,f.jsx)(r.Ay,{item:!0,xs:12,sm:4,children:z("name","Material","text",!0,(()=>{}),!0)}),(0,f.jsx)(r.Ay,{item:!0,xs:12,sm:4,children:z("code","Code","text",!0,(()=>{}),!0)}),(0,f.jsx)(r.Ay,{item:!0,xs:12,sm:1,style:{display:"none"},children:z("name","name","text",!0)}),(0,f.jsx)(r.Ay,{item:!0,xs:12,sm:4,children:(V="storeLocationId",H="Store Location",M=i&&i.filter((e=>E.every((l=>!e.name.toLowerCase().includes(l))))),R=!0,U=()=>{},Q=!1,(0,f.jsx)(y.eu,{name:V,label:H,onChange:U,InputLabelProps:{shrink:!0},menus:M,...Q&&{disable:!0},...R&&{required:!0}}))}),(0,f.jsx)(r.Ay,{item:!0,xs:12,sm:2,children:z("quantity","Quantity",(0,I.VF)(F)?"text":"number",!0,(()=>{}),!0)}),(0,f.jsx)(r.Ay,{item:!0,xs:12,sm:2,children:z("uomName","UOM","text",!0,(()=>{}),!0)}),(0,f.jsx)(r.Ay,{item:!0,md:2,children:z("value","Value","number",!0,void 0,!0)}),(0,f.jsx)(r.Ay,{item:!0,md:1,sx:{textAlign:"center"},children:P&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(S.A,{mb:-1,children:"Serial No"})," ",(0,f.jsx)("br",{}),(0,f.jsx)(d.A,{size:"small",onClick:()=>{var e;(e=>{let l=[];e&&e.length>0&&e.map((e=>{l.push("object"===typeof e?e.serialNumber:e)})),_(l)})(null!==(e=null!==L&&void 0!==L?L:n.material_serial_numbers)&&void 0!==e?e:[]),k(!0)},variant:"contained",color:"primary",children:"View"})]})}),(0,f.jsx)(r.Ay,{item:!0,xs:12,sm:2,mt:3.5,sx:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:!t&&(0,f.jsx)(d.A,{size:"small",onClick:w((e=>{var o;e.storeLocation=(o=e.storeLocationId,i.filter((e=>e.id===o))[0]),l(e,C.id),O()})),variant:"contained",color:"primary",children:a?"Update":"Add"})})]}),g&&(0,f.jsx)(N.default,{open:g,onClose:()=>{k(!1)},serialNumberData:L})]})})});var V,H,M,R,U,Q};var L=i(99635),_=i(60845),P=i(71826),D=i(62054);const C=e=>{let{values:l,onEdit:i}=e;return(0,f.jsx)("div",{children:(0,f.jsx)(a.A,{title:"Edit",placement:"bottom",children:(0,f.jsx)(n.A,{color:"secondary",onClick:()=>i(l),children:(0,f.jsx)(s.A,{})})})})},B=()=>{var e;const l=(0,u.Zp)(),[i,a]=(0,o.useState)([]),[n,s]=(0,o.useState)({}),[v,m]=(0,o.useState)(!1),[p,x]=(0,o.useState)(!1),[h,b]=(0,o.useState)(!1),[j,S]=(0,o.useState)(null),A=(0,t.wA)(),N=(0,o.useMemo)((()=>[{Header:"Actions",accessor:"actions"},{Header:"Name",accessor:"name"},{Header:"Code",accessor:"code"},{Header:"Quantity",accessor:"quantity"},{Header:"UOM",accessor:"uomName"},{Header:"Store Location",accessor:"storeLocation.name"}]),[]),[B,W]=(0,o.useState)(!1),w="420e7b13-25fd-4d23-9959-af1c07c7e94b";(0,o.useEffect)((()=>{w&&A((0,_.Ru)({organizationType:w}))}),[A,w]);const{companyStoreLocations:q}=(0,c.V)(),O=()=>{W(!B),x(!1)},T=((null===q||void 0===q||null===(e=q.companyStoreLocationsObject)||void 0===e?void 0:e.rows)||[]).filter((e=>{var l,i;return(null===(l=e.organization_store)||void 0===l?void 0:l.id)===(null===n||void 0===n||null===(i=n.store)||void 0===i?void 0:i.id)})),F=e=>{let l=[];return e&&e.length>0&&e.map((e=>{l.push("object"===typeof e?e.serialNumber:e)})),l};(0,o.useEffect)((()=>{null!==j&&void 0!==j&&j.materials&&(null===j||void 0===j?void 0:j.materials.length)>0&&a((e=>{const l=[];return e&&e.map((e=>{var i,o,t,a,n,r,d,s;l.push({id:null===e||void 0===e?void 0:e.id,materialId:null===e||void 0===e||null===(i=e.material)||void 0===i?void 0:i.id,name:null===e||void 0===e||null===(o=e.material)||void 0===o?void 0:o.name,isSerialNumber:null===e||void 0===e||null===(t=e.material)||void 0===t?void 0:t.isSerialNumber,quantity:-e.quantity,referenceDocumentNumber:e.referenceDocumentNumber,tax:null===e||void 0===e?void 0:e.tax,value:null===e||void 0===e?void 0:e.value,uomName:null===e||void 0===e||null===(a=e.uom)||void 0===a?void 0:a.name,uomId:null===e||void 0===e||null===(n=e.uom)||void 0===n?void 0:n.id,rate:parseFloat(e.rate).toFixed(2),code:null===e||void 0===e||null===(r=e.material)||void 0===r?void 0:r.code,hsnCode:null===e||void 0===e||null===(d=e.material)||void 0===d?void 0:d.hsnCode,uom:null===e||void 0===e?void 0:e.uom,store:null===e||void 0===e?void 0:e.other_store,project:null===j||void 0===j?void 0:j.projectId,fromStoreLocationId:null===e||void 0===e||null===(s=e.organization_store_location)||void 0===s?void 0:s.id,material_serial_numbers:null===e||void 0===e?void 0:e.material_serial_numbers})})),l})(null===j||void 0===j?void 0:j.materials))}),[j]);const z=e=>{const l=[];return e&&e.length>0&&e.map((e=>l.push(e.id))),l};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(g,{onClick:O,saveData:e=>{S(e),x(!0)}}),h&&(0,f.jsx)(k,{onMaterailsInput:e=>{if(h&&e.index>=0){const l=i;l[e.index]={...e},a(l)}b(!1)},storeLocationData:T,view:v,update:h,showData:n,hideTaxDetails:!0}),i&&p&&i.length>0&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(L.default,{title:"Material Transfer Project To Project",hideHeader:!0,hidePagination:!0,data:(E=i,E.map(((e,l)=>({...e,actions:(0,f.jsx)(C,{values:e,onEdit:e=>{const i=structuredClone(e);var o;i.index=l,o=i,m(!1),b(!0),s(o)}})})))),count:i.length,columns:N,hideActions:!0}),(0,f.jsx)(y.Op,{children:(0,f.jsx)(r.Ay,{container:!0,spacing:4,children:(0,f.jsxs)(r.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px",mt:3},children:[(0,f.jsx)(d.A,{onClick:O,size:"small",variant:"outlined",color:"primary",children:"Back"}),(0,f.jsx)(d.A,{disabled:h,onClick:async()=>{var e,o,t;const a={transactionTypeId:null===j||void 0===j?void 0:j.transactionTypeId,requestIds:z(i),remarks:null===j||void 0===j?void 0:j.remarks,placeOfSupply:null===j||void 0===j?void 0:j.placeOfSupply,...(null===j||void 0===j?void 0:j.eWayBillNumber)&&{eWayBillNumber:null===j||void 0===j?void 0:j.eWayBillNumber},...(null===j||void 0===j?void 0:j.eWayBillDate)&&""!==(null===j||void 0===j?void 0:j.eWayBillDate)&&{eWayBillDate:null===j||void 0===j?void 0:j.eWayBillDate},vehicleNumber:null===j||void 0===j?void 0:j.vehicleNumber,stock_ledgers:i.map((e=>{var l,i,o,t,a;return{transactionTypeId:null===j||void 0===j?void 0:j.transactionTypeId,requestNumber:e.referenceDocumentNumber,organizationId:null!==(l=null===e||void 0===e||null===(i=e.store)||void 0===i||null===(o=i.organization)||void 0===o?void 0:o.parentId)&&void 0!==l?l:null===e||void 0===e||null===(t=e.store)||void 0===t||null===(a=t.organization)||void 0===a?void 0:a.id,projectId:null===j||void 0===j?void 0:j.toProjectId,otherProjectId:null===j||void 0===j?void 0:j.fromProjectId,storeId:null===j||void 0===j?void 0:j.toStoreId,otherStoreId:null===j||void 0===j?void 0:j.fromStoreId,storeLocationId:null===e||void 0===e?void 0:e.storeLocationId,otherStoreLocationId:null===e||void 0===e?void 0:e.fromStoreLocationId,materialId:null===e||void 0===e?void 0:e.materialId,uomId:null===e||void 0===e?void 0:e.uomId,quantity:null===e||void 0===e?void 0:e.quantity,rate:null===e||void 0===e?void 0:e.rate,value:null===e||void 0===e?void 0:e.value,tax:null===e||void 0===e?void 0:e.tax,serialNumber:F(null===e||void 0===e?void 0:e.material_serial_numbers)}}))};if((0,I.Rh)(null===a||void 0===a?void 0:a.stock_ledgers,"storeLocationId"))return;const n=await(0,P.default)("/project-to-project-grn-create",{method:"POST",body:{...a}});var r;if(!n.success)return void(0,D.A)((null===n||void 0===n||null===(r=n.error)||void 0===r?void 0:r.message)||"Operation failed. Please try again!",{variant:"error"});const d=null!==(e=null===(o=n.data)||void 0===o?void 0:o.data)&&void 0!==e?e:{},s=d.referenceDocumentNumber||(null===(t=d[0])||void 0===t?void 0:t.referenceDocumentNumber);(0,D.A)(s?`Request created with reference number: ${s}`:"Request created successfully!",{variant:"success",autoHideDuration:1e4}),l("/ptp-grn-receipt")},size:"small",variant:"contained",color:"primary",children:"Submit"})]})})})]})]});var E}}}]);