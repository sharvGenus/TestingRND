"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[6439],{46439:(e,t,n)=>{n.r(t),n.d(t,{default:()=>w});var r=n(9950),o=n(72179),a=n(95537),i=n(71826),s=n(62054);const d=e=>{let{handleClose:t,fetchFromRoute:n,previewAction:o,apiParams:a,apiQuery:d,fileNameForDownload:l}=e;const[c,p]=(0,r.useState)(!1),[u,h]=(0,r.useState)(!1),[m,w]=(0,r.useState)(!1),[f,y]=(0,r.useState)("<div></div>"),v=(0,r.useCallback)((async()=>{if(!a&&!d)return;w(!0);const e=await(0,i.default)(n,{method:"GET",params:a,query:d});if(!e.success)return(0,s.A)("There was an error fetching the receipt",{variant:"error"}),w(!1),void t();y(e.data.renderedTemplate),w(!1)}),[n,t,d,a]);(0,r.useEffect)((()=>{"view"===o&&v()}),[v,o,a]);const b=(0,r.useCallback)((async()=>{if(!a&&!d||u)return;h(!0);const e=await(0,i.default)(n,{method:"GET",query:{...d,pdf:1},params:a,responseType:"blob"});if(!e.success)return(0,s.A)("There was an error printing the receipt",{variant:"error"}),h(!1),void t();const r=e.data,o=document.createElement("iframe");o.style.display="none",document.body.appendChild(o),o.src=URL.createObjectURL(r),o.onload=()=>{o.contentWindow.print(),h(!1),t(),window.onfocus=()=>{o.remove(),URL.revokeObjectURL(o.src)}}}),[n,t,u,d,a]),x=(0,r.useCallback)((async()=>{if(!a&&!d||c)return;p(!0);const e=await(0,i.default)(n,{method:"GET",query:{...d,pdf:1},params:a,responseType:"blob"});if(!e.success)return(0,s.A)("There was an error while downloading the receipt",{variant:"error"}),p(!1),void t();const r=e.data,o=window.URL.createObjectURL(r),u=document.createElement("a");u.href=o,u.setAttribute("download",l||"receipt.pdf"),document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(o),p(!1),t()}),[a,d,n,l,t,c]);return(0,r.useEffect)((()=>{"print"===o?b():"download"===o&&x()}),[o,t,b,x]),{renderedHTML:f,isLoadingTemplate:m,isPrinting:u,isDownloading:c}};var l=n(88694),c=n(93951),p=n(52351),u=n(44414);const h=(0,r.lazy)((()=>Promise.resolve().then(n.bind(n,22852)))),m=e=>{let{htmlContent:t}=e;const n=`data:text/html;charset=utf-8,${encodeURIComponent(t)}`;return(0,u.jsx)("iframe",{title:"Receipt Preview",src:n,style:{padding:"48px 21px 21px 10px",border:"none"},width:"100%",height:"100%"})},w=e=>{let{onClose:t,fetchFromRoute:n,previewAction:i,apiParams:s,apiQuery:w,fileNameForDownload:f}=e;const{renderedHTML:y,isDownloading:v,isPrinting:b,isLoadingTemplate:x}=d({handleClose:t,previewAction:i,fetchFromRoute:n,apiParams:s,apiQuery:w,fileNameForDownload:f}),C=v||b||x,g=`\n<style type="text/css" media="print">\n  body {\n    display:none;\n    visibility:hidden;\n  }\n</style>\n${y}`,k=(0,r.useCallback)((e=>{var n;"Escape"===e.key?t():e.ctrlKey&&"p"===(null===(n=e.key)||void 0===n?void 0:n.toLowerCase())&&e.preventDefault()}),[t]);return(0,r.useEffect)((()=>(document.addEventListener("keydown",k,!1),()=>document.removeEventListener("keydown",k,!1))),[k]),(0,u.jsxs)(u.Fragment,{children:[C&&(0,u.jsx)(p.A,{}),(0,u.jsx)(r.Suspense,{fallback:(0,u.jsx)(p.A,{}),children:"view"===i&&(0,u.jsx)(h,{onClose:t,open:!0,style:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(a.A,{style:{width:"85%",height:"80%",backgroundColor:"white"},children:[(0,u.jsx)(a.A,{style:{position:"relative"},children:(0,u.jsx)(l.A,{style:{position:"absolute",top:"4px",right:"14px",backgroundColor:"white"},onClick:t,children:(0,u.jsx)(c.A,{children:(0,u.jsx)(o.A,{})})})}),(0,u.jsx)(m,{htmlContent:g})]})})})})]})}}}]);