"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[6658],{66658:(e,i,o)=>{o.r(i),o.d(i,{default:()=>M});var t=o(80415),l=o(9950),r=o(12257),n=o(14857),d=o(2683),a=o(4139),s=o(87233),u=o(67535),c=o(74745),m=o(9449),v=o(60666),p=o(28429),h=o(42074),y=o(26473),b=o(27081),f=o(15999),A=o(76300),x=o(29024),w=o(96951),j=o(71826),g=o(84601),C=o(10447),V=o(62054),I=o(99635),S=o(64499),k=o(26059),T=o(44414);const O=function(e,i,o,t,l){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];return(0,T.jsx)(r.A,{spacing:1,children:(0,T.jsx)(w.o3,{name:e,type:o,label:i,placeholder:l,InputLabelProps:{shrink:n},...t&&{required:!0}})})},D=(e,i,o,t,l,n)=>(0,T.jsx)(r.A,{children:(0,T.jsx)(w.eu,{name:e,placeholder:l,label:i,onChange:n,InputLabelProps:{shrink:!0},menus:o,...t&&{required:!0}})}),W=e=>{const[i,o]=(0,l.useState)(),{conditionsArray:r,setConditionsArray:n,columnData:d,dropdownLOVs:s,setDropdownLOVs:c,formId:p}=e,h=(0,m.mN)({resolver:(0,y.t)(v.Ik().shape({fromAttributeId:g.A.other,operatorKey:g.A.other,compareWithValue:g.A.other})),defaultValues:{},mode:"all"}),{handleSubmit:b}=h,[A,x]=(0,l.useState)(),[C,I]=(0,l.useState)();return(0,T.jsx)(w.Op,{methods:h,onSubmit:b((async e=>{const{fromAttributeId:o,operatorKey:t,compareWithValue:l}=e;n([...r,{fromAttributeId:o,operatorKey:t,compareWithValue:l,form_attribute:{name:i}}]),h.reset(),c([])})),children:(0,T.jsx)(a.Ay,{container:!0,alignItems:"center",sx:{pl:4,pr:4},children:(0,T.jsxs)(a.Ay,{container:!0,spacing:4,mt:1,mb:3,direction:"row",children:[(0,T.jsx)(a.Ay,{item:!0,md:3,xl:3,children:D("fromAttributeId","Column",d.filter((e=>{var i;return!["dateOnly","timeOnly"].includes(null===(i=e.properties)||void 0===i?void 0:i.pickerType)})),!0,"Select Column",(async e=>{var i,t,l,r,n,d,a,s,u,m,v,y,b,f;h.resetField("compareWithValue"),o(null===e||void 0===e||null===(i=e.target)||void 0===i?void 0:i.name),I(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value),x(null===e||void 0===e||null===(l=e.target)||void 0===l?void 0:l.type);const A=[{name:null===e||void 0===e||null===(r=e.target)||void 0===r?void 0:r.name,sourceTable:null===e||void 0===e||null===(n=e.target)||void 0===n||null===(d=n.row)||void 0===d||null===(a=d.properties)||void 0===a?void 0:a.sourceTable,sourceColumn:null===e||void 0===e||null===(s=e.target)||void 0===s||null===(u=s.row)||void 0===u||null===(m=u.properties)||void 0===m?void 0:m.sourceColumn,type:"and",conditions:null===e||void 0===e||null===(v=e.target)||void 0===v||null===(y=v.row)||void 0===y||null===(b=y.properties)||void 0===b?void 0:b.conditions}];if("Dropdown"===(null===e||void 0===e||null===(f=e.target)||void 0===f?void 0:f.type)){const i=await(0,j.default)("/form-get-dropdown-field-data",{method:"POST",body:{formId:p,formDropdowns:A}});var w,g,C;if(i.success)c(null===(w=i.data)||void 0===w||null===(g=w.dropdownData[0])||void 0===g?void 0:g[null===(C=e.target)||void 0===C?void 0:C.name]);else(0,V.A)(i.error.message,{variant:"error"})}}))}),(0,T.jsx)(a.Ay,{item:!0,md:2,xl:3,children:D("operatorKey","Operation",t.we,!0,"Select")}),"Chip Select"===A||"Checkbox"===A?(0,T.jsx)(a.Ay,{item:!0,md:3,xl:3,children:D("compareWithValue","Matching Value",h.watch("fromAttributeId")?d.filter((e=>e.id==C)).flatMap((e=>{var i;return null===(i=e.properties)||void 0===i?void 0:i.values.split(",").map((e=>({name:e,id:e})))})):[],!1,"Select  Value")}):"Date Time"===A?(0,T.jsx)(a.Ay,{item:!0,md:2.5,xl:2.5,children:(0,T.jsx)(f.A,{name:"compareWithValue",label:"Matching Value",pickerType:"dateTimeBoth",timeFormat:"24hour",format:"dd/MM/yyyy HH:mm"})}):"Dropdown"===A?(0,T.jsx)(a.Ay,{item:!0,md:2.5,xl:2.5,children:D("compareWithValue","Matching Value",s,!1,"Select Value")}):(0,T.jsx)(a.Ay,{item:!0,md:3,xl:3,children:O("compareWithValue","Matching Value","text",!1,"Enter Value")}),(0,T.jsx)(a.Ay,{item:!0,md:3,sx:{mt:4},children:(0,T.jsx)(u.A,{variant:"contained",size:"small",color:"primary",type:"submit",children:"Add"})})]})})})},M=()=>{var e,i;const o=(0,n.A)(),{formId:t}=(0,p.g)(),r=(0,p.zy)(),f=(0,b.wA)(),D=null===(e=r.state)||void 0===e?void 0:e.blockData,[M,H]=(0,l.useState)([]),[E,R]=(0,l.useState)([]),[P,K]=(0,l.useState)(!1),[N,_]=(0,l.useState)(null),[z,B]=(0,l.useState)((null===D||void 0===D?void 0:D.visibleColumns)||[]),[L,q]=(0,l.useState)((null===D||void 0===D?void 0:D.nonVisibleColumns)||[]),F=(0,p.Zp)(),Q=(0,m.mN)({resolver:(0,y.t)(v.Ik().shape({name:g.A.other,type:g.A.other})),defaultValues:{},mode:"all"});(0,l.useEffect)((()=>(t&&f((0,x.u44)({formId:t,sortBy:"rank",sortOrder:"ASC"})),()=>{f(C.wF.actions.reset()),f(C.Mb.actions.reset())})),[f,t]);const{formAttributes:U}=(0,A.I)(),Y=(0,l.useMemo)((()=>{var e;return(null===U||void 0===U||null===(e=U.formAttributesObject)||void 0===e?void 0:e.rows)||[]}),[null===U||void 0===U||null===(i=U.formAttributesObject)||void 0===i?void 0:i.rows]),[$,Z]=(0,l.useState)({}),G=(0,l.useRef)([]),J=(0,l.useCallback)((async e=>{var i;const o=null===Y||void 0===Y?void 0:Y.find((i=>i.id===e.fromAttributeId));if(o&&"dropdown"===(null===o||void 0===o||null===(i=o.default_attribute)||void 0===i?void 0:i.inputType)){var l,r,n;const i=[{name:"lov",sourceTable:null===o||void 0===o||null===(l=o.properties)||void 0===l?void 0:l.sourceTable,sourceColumn:null===o||void 0===o||null===(r=o.properties)||void 0===r?void 0:r.sourceColumn,type:"and",conditions:[{column:null===k.Q||void 0===k.Q||null===(n=k.Q.find((e=>{var i;return e.id===(null===o||void 0===o||null===(i=o.properties)||void 0===i?void 0:i.sourceTable)})))||void 0===n?void 0:n.tableIdCell,operation:"et",value:e.compareWithValue}]}],u=await(0,j.default)("/form-get-dropdown-field-data",{method:"POST",body:{formId:t,formDropdowns:i}});var d,a,s;return u.success?null===(d=u.data)||void 0===d||null===(a=d.dropdownData[0])||void 0===a||null===(s=a.lov[0])||void 0===s?void 0:s.name:""}return""}),[Y,t]);(0,l.useEffect)((()=>{Y&&Y.length>0&&(async()=>{const e=G.current,i=null===M||void 0===M?void 0:M.filter((i=>!e.includes(i)));if(i.length>0){const e=(await Promise.all(i.map((async e=>({id:e.compareWithValue,name:await J(e)}))))).reduce(((e,i)=>{let{id:o,name:t}=i;return t&&(e[o]=t),e}),{});Z((i=>({...i,...e})))}G.current=M})()}),[M,J,Y]);const X=[{Header:"Column",accessor:"form_attribute.name"},{Header:"Operator",accessor:"operatorKey"},{Header:"Matching Column / Value",accessor:e=>{var i,o;return"dropdown"===(null===Y||void 0===Y||null===(i=Y.find((i=>i.id===e.fromAttributeId)))||void 0===i||null===(o=i.default_attribute)||void 0===o?void 0:o.inputType)?$[e.compareWithValue]:e.compareWithValue}}],{handleSubmit:ee}=Q;(0,l.useEffect)((()=>{(null===D||void 0===D?void 0:D.id)&&f((0,x.kB6)(null===D||void 0===D?void 0:D.id))}),[f,null===D||void 0===D?void 0:D.id]);const{attributeVisibilityCondition:ie}=(0,A.I)(),oe=(0,l.useMemo)((()=>{var e;return(null===ie||void 0===ie||null===(e=ie.formAttributeVisibilityConditionObject)||void 0===e?void 0:e.rows)||[]}),[ie]);(0,l.useEffect)((()=>{H((e=>[...e,...oe]))}),[oe]);(0,l.useEffect)((()=>{Q.reset({name:null===D||void 0===D?void 0:D.name,type:null===D||void 0===D?void 0:D.type,visibleColumns:null===D||void 0===D?void 0:D.visibleColumns,nonVisibleColumns:null===D||void 0===D?void 0:D.nonVisibleColumns})}),[D,Q]);const te=null!==D&&void 0!==D&&D.id?async e=>{e.formId=t,e.conditionsArray=M,e.visibilityBlockId=null===D||void 0===D?void 0:D.id;const i=await(0,j.default)("/attribute-visibility-block-update",{method:"PUT",body:e});i.success?F(`/form-visibility-rules/${t}`):(0,V.A)(i.error.message,{variant:"error"})}:async e=>{e.conditionsArray=M,e.formId=t;const i=await(0,j.default)("/attribute-visibility-block-create",{method:"POST",body:e});i.success?F(`/form-visibility-rules/${t}`):(0,V.A)(i.error.message,{variant:"error"})},le=Y.filter((e=>!z.includes(e.id)&&!e.properties.defaultHide)),re=Y.filter((e=>!L.includes(e.id)&&!e.properties.approval&&!e.properties.verifyAttribute));return(0,T.jsxs)(d.A,{sx:{maxHeight:"85vh",minHeight:"85vh",overflow:"auto",border:"1px solid",borderRadius:1,borderColor:o.palette.grey.A800,boxShadow:"inherit"},children:[(0,T.jsxs)(w.Op,{methods:Q,onSubmit:ee(te),children:[(0,T.jsxs)(a.Ay,{sx:{position:"absolute",top:0,width:"100%",background:"white",zIndex:10,p:2,pb:0},children:[(0,T.jsx)(a.Ay,{container:!0,children:(0,T.jsxs)(a.Ay,{item:!0,md:12,sx:{display:"flex",justifyContent:"space-between"},children:[(0,T.jsx)(s.A,{variant:"h4",children:null!==D&&void 0!==D&&D.id?"Edit Visibility Rule":"Add Visibility Rule"}),(0,T.jsxs)(a.Ay,{item:!0,sx:{display:"flex",gap:2},children:[(0,T.jsx)(u.A,{component:h.N_,to:"/form-visibility-rules/"+t,size:"small",variant:"outlined",color:"primary",children:"Back"}),null!==D&&void 0!==D&&D.id?(0,T.jsx)(u.A,{size:"small",type:"submit",variant:"contained",color:"primary",children:"Update"}):(0,T.jsx)(u.A,{size:"small",type:"submit",variant:"contained",color:"primary",children:"Save"})]})]})}),(0,T.jsx)(c.A,{sx:{mt:2}})]}),(0,T.jsxs)(a.Ay,{container:!0,spacing:4,sx:{pl:4,pr:4,pt:2,mt:5},children:[(0,T.jsx)(a.Ay,{item:!0,md:6,xl:6,children:O("name","Rule Name","text",!0,"Rule Name")}),(0,T.jsx)(a.Ay,{item:!0,md:3,xl:3,children:(0,T.jsx)(w.eu,{name:"type",placeholder:"Select Condition Type",label:"Condition Type",menus:[{id:"and",name:"AND ( Match all of below )"},{id:"or",name:"OR ( Match any of below )"}],required:!0})}),(0,T.jsx)(a.Ay,{item:!0,md:11,xl:11,children:(0,T.jsx)(w.Yq,{name:"visibleColumns",label:"Visible Columns",onChange:e=>{B(e),q((i=>i.filter((i=>!e.includes(i)))))},menus:re,success:!0})}),(0,T.jsx)(a.Ay,{item:!0,md:11,xl:11,children:(0,T.jsx)(w.Yq,{name:"nonVisibleColumns",label:"Non Visible Columns",onChange:e=>{q(e),B((i=>i.filter((i=>!e.includes(i)))))},menus:le,failure:!0})})]})]}),(0,T.jsx)(W,{setConditionsArray:H,conditionsArray:M,columnData:Y,dropdownLOVs:E,setDropdownLOVs:R,formId:t}),(0,T.jsx)(a.Ay,{sx:{width:"95%",pl:4,pr:4,pt:2,mb:4},children:(0,T.jsx)(I.default,{hidePagination:!0,hideHistoryIcon:!0,hideViewIcon:!0,hideEditIcon:!0,hideEmptyTable:!0,hideHeader:!0,data:M.filter((e=>0!=(null===e||void 0===e?void 0:e.isActive))),columns:X,count:M.filter((e=>0!=(null===e||void 0===e?void 0:e.isActive))).length,handleRowDelete:async e=>{_(e),K(!0)},handleRowUpdate:()=>{}})}),(0,T.jsx)(S.A,{open:P,handleClose:()=>K(!1),handleConfirm:()=>{const e=M.findIndex((e=>(null===e||void 0===e?void 0:e.id)===N||(null===e||void 0===e?void 0:e.fromAttributeId)===(null===N||void 0===N?void 0:N.fromAttributeId)&&(null===e||void 0===e?void 0:e.operatorKey)===(null===N||void 0===N?void 0:N.operatorKey)&&(null===e||void 0===e?void 0:e.compareWithValue)===(null===N||void 0===N?void 0:N.compareWithValue)&&!("isActive"in e)));if(-1!==e){const i={...M[e]};i.isActive=0,M[e]=i}K(!1)},title:"Delete Condition",message:"Are you sure you want to delete?",confirmBtnTitle:"Delete"})]})}}}]);