"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[6100],{16100:(e,t,s)=>{s.r(t),s.d(t,{default:()=>P});var a=s(9950),o=s(27081),n=s(96583),r=s(55519),i=s(88848),d=s(4992),l=s(12257),c=s(4139),u=s(67535),m=s(60666),p=s(9449),g=s(26473),h=s(71826),f=s(96951),v=s(14351),y=s(84601),x=s(62054),D=s(44414);const A=e=>{const{setRefresh:t,data:s,view:o,update:n,refreshPagination:r,customerData:i,departmentData:d,setSelectedCustomer:A,setSelectedDepartment:S}=e,j=(0,p.mN)({resolver:(0,g.t)(m.Ik().shape({name:y.A.name,code:y.A.code,customerId:y.A.other,customerDepartmentId:y.A.other})),defaultValues:{},mode:"all"}),{handleSubmit:C,setValue:b,clearErrors:I,getValues:w}=j,O=(0,a.useCallback)((()=>{t();const e=w();j.reset({name:"",code:"",customerId:e.customerId,customerDepartmentId:e.customerDepartmentId})}),[t,j,w]);(0,a.useEffect)((()=>{var e,t,a,r,i,d;(s||O(),o||n)&&(A(null===s||void 0===s||null===(e=s.customer_department)||void 0===e||null===(t=e.organization)||void 0===t?void 0:t.id),b("customerId",null===s||void 0===s||null===(a=s.customer_department)||void 0===a||null===(r=a.organization)||void 0===r?void 0:r.id),b("customerDepartmentId",null===s||void 0===s||null===(i=s.customer_department)||void 0===i?void 0:i.id),d=s,Object.entries(d).forEach((e=>{let[t,s]=e;b(t,s)})))}),[s,n,o,b,I,O,A]);const H=(e,t,s,a,r)=>(0,D.jsx)(l.A,{children:(0,D.jsx)(f.eu,{name:e,label:t,onChange:a,InputLabelProps:{shrink:!0},menus:s,...r&&{required:!0},...o?{disable:!0}:n?{disable:!1}:{}})}),P=function(e,t,s,a){let r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(0,D.jsx)(l.A,{spacing:1,children:(0,D.jsx)(f.o3,{name:e,type:s,label:t,InputLabelProps:{shrink:r},...a&&{required:!0},...o?{disabled:!0}:n?{disabled:!1}:{}})})};return(0,D.jsx)(D.Fragment,{children:(0,D.jsx)(f.Op,{methods:j,onSubmit:C((async e=>{let t;if(t=n?await(0,h.default)("/customer-designation-update",{method:"PUT",body:e,params:s.id}):await(0,h.default)("/customer-designation-form",{method:"POST",body:e}),t.success){const e=n?"Designation updated successfully!":"Designation added successfully!";(0,x.A)(e,{variant:"success",autoHideDuration:1e4}),r(),O()}else{var a,o;(0,x.A)((null===(a=t)||void 0===a||null===(o=a.error)||void 0===o?void 0:o.message)||"Operation failed. Please try again.",{variant:"error"})}})),children:(0,D.jsxs)(v.A,{title:(o?"View ":n?"Update ":"Add ")+"Customer Designation",children:[(0,D.jsxs)(c.Ay,{container:!0,spacing:4,children:[(0,D.jsx)(c.Ay,{item:!0,md:3,xl:2,children:H("customerId","Customer Name",i,(e=>{var t;A(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value)}),!0)}),(0,D.jsx)(c.Ay,{item:!0,md:3,xl:2,children:H("customerDepartmentId","Department Name",d,(e=>{var t;S(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value)}),!0)}),(0,D.jsx)(c.Ay,{item:!0,md:3,xl:2,children:P("name","Designation Name","text",!0)}),(0,D.jsx)(c.Ay,{item:!0,md:3,xl:2,children:P("code","Designation Code","text",!0)}),(0,D.jsx)(c.Ay,{item:!0,md:3,xl:2,children:P("integrationId","Integration ID","text")})]}),(0,D.jsx)(c.Ay,{container:!0,spacing:2,alignItems:"end",sx:{mt:2},children:(0,D.jsx)(c.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px"},children:o?(0,D.jsx)(u.A,{onClick:O,size:"small",variant:"outlined",color:"primary",children:"Back"}):n?(0,D.jsxs)(c.Ay,{item:!0,sx:{display:"flex",gap:"20px"},children:[(0,D.jsx)(u.A,{size:"small",type:"submit",variant:"contained",color:"primary",children:"Update"}),(0,D.jsx)(u.A,{onClick:O,size:"small",variant:"outlined",color:"primary",children:"Back"})]}):(0,D.jsx)(c.Ay,{item:!0,sx:{display:"flex",gap:"20px"},children:(0,D.jsx)(u.A,{size:"small",type:"submit",variant:"contained",color:"primary",children:"Save"})})})})]})})})};var S=s(99635),j=s(64499),C=s(89649),b=s(29024),I=s(39225),w=s(30423),O=s(65920),H=s(52867);const P=()=>{const{paginations:{pageSize:e,pageIndex:t,forceUpdate:s},refreshPagination:l,setPageIndex:c,setPageSize:u}=(0,C.A)(),{searchString:m,setSearchString:p,accessorsRef:g,setAccessors:f,forceSearch:v,searchStringTrimmed:y}=(0,I.A)(),[P,z]=(0,a.useState)(!1),[E,T]=(0,a.useState)(!1),[k,N]=(0,a.useState)(!1),[_,R]=(0,a.useState)(!1),[B,U]=(0,a.useState)(!1),[L,W]=(0,a.useState)(null),[M,V]=(0,a.useState)(null),[F,G]=(0,a.useState)(null),[q,Q]=(0,a.useState)(1),[$,J]=(0,a.useState)(null),[K,Z]=(0,a.useState)(!1),[X,Y]=(0,a.useState)(!1),[ee,te]=(0,a.useState)(null),se=(0,o.wA)(),{filterObjectForApi:ae}=(0,w.bZ)(),oe=(0,O.A)(ae),ne=(0,O.A)(ee);(0,a.useEffect)((()=>{[[oe,ae],[ne,ee]].some(H.$H)?l():B&&se((0,b.H5f)({pageIndex:t,pageSize:e,listType:q,customerDepartmentId:B,...y&&{searchString:y,accessors:JSON.stringify(g.current)},sortBy:null===ee||void 0===ee?void 0:ee[0],sortOrder:null===ee||void 0===ee?void 0:ee[1],filterObject:ae}))}),[se,t,e,q,B,y,ee,g,v,ae,oe,ne,l]),(0,a.useEffect)((()=>{se((0,b._G1)())}),[se]),(0,a.useEffect)((()=>{E&&se((0,b.fQv)(E))}),[se,E]);const{masterMakerLovs:re}=(0,i.$)(),ie=((e,t)=>{const s=e&&e.filter((e=>e.name===t));return s&&s.length?s[0].id:null})(re.masterMakerLovsObject.rows,"CUSTOMER");(0,a.useEffect)((()=>{ie&&se((0,b.d8s)(ie))}),[se,ie]);const{organizationsDropdown:de}=(0,r.G)(),le=null===de||void 0===de?void 0:de.organizationDropdownObject,{customerDepartmentsDropdown:ce}=(0,d.H)(),ue=ce.customerDepartmentsDropdownObject;(0,a.useEffect)((()=>{null!==L&&void 0!==L&&L.id&&se((0,b.GTl)({pageIndex:t,pageSize:e,listType:q,recordId:null===L||void 0===L?void 0:L.id}))}),[se,t,e,s,q,L]);const{departmentWiseCustomerDesignations:me,customerDesignationHistory:pe}=(()=>{const[e,t]=(0,a.useState)({customerDesignationsObject:{},error:"",loading:!0}),[s,n]=(0,a.useState)({customerDesignationHistoryObject:{},error:"",loading:!0}),[r,i]=(0,a.useState)({departmentWiseCustomerDesignationsObject:{},error:"",loading:!0}),d=(0,o.d4)((e=>e.customerDesignations||{})),l=(0,o.d4)((e=>e.customerDesignationHistory||{})),c=(0,o.d4)((e=>e.departmentWiseCustomerDesignations||{}));return(0,a.useEffect)((()=>{t((e=>({...e,...d})))}),[d]),(0,a.useEffect)((()=>{n((e=>({...e,...l})))}),[l]),(0,a.useEffect)((()=>{i((e=>({...e,...c})))}),[c]),{customerDesignations:e,customerDesignationHistory:s,departmentWiseCustomerDesignations:r}})(),{data:ge,count:he}=(0,a.useMemo)((()=>{var e,t;return{data:(null===(e=me.departmentWiseCustomerDesignationsObject)||void 0===e?void 0:e.rows)||[],count:(null===(t=me.departmentWiseCustomerDesignationsObject)||void 0===t?void 0:t.count)||0,isLoading:me.loading||!1}}),[me]),{historyData:fe,historyCounts:ve}=(0,a.useMemo)((()=>{var e,t;return{historyData:(null===(e=pe.customerDesignationHistoryObject)||void 0===e?void 0:e.rows)||[],historyCounts:(null===(t=pe.customerDesignationHistoryObject)||void 0===t?void 0:t.count)||0,isLoading:pe.loading||!1}}),[pe]),ye=(0,a.useMemo)((()=>[{Header:"Customer Name",accessor:"customer_department.organization.name"},{Header:"Department Name",accessor:"customer_department.name"},{Header:"Designation Name",accessor:"name",filterProps:{tableName:"customer_designations",getColumn:"name",customAccessor:"name"}},{Header:"Designation Code",accessor:"code",filterProps:{tableName:"customer_designations",getColumn:"code",customAccessor:"code"}},{Header:"Integration ID",accessor:"integrationId",filterProps:{tableName:"customer_designations",getColumn:"integration_id",customAccessor:"integrationId"}},{Header:"Updated On",accessor:"updatedAt"},{Header:"Updated By",accessor:"updated.name",filterProps:{tableName:"users",getColumn:"name",customAccessor:"updatedBy"}},{Header:"Created On",accessor:"createdAt"},{Header:"Created By",accessor:"created.name",filterProps:{tableName:"users",getColumn:"name",customAccessor:"createdBy"}}]),[]);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(A,{refreshPagination:l,setRefresh:()=>{Z(!1),Y(!1),J(null)},customerData:le,departmentData:ue,setSelectedCustomer:T,setSelectedDepartment:U,...$&&{data:$},...K&&{view:K,update:!1},...X&&{update:X,view:!1}}),B&&(0,D.jsx)(S.default,{title:"Customer Designation",data:ge,columns:ye,count:he,setPageIndex:c,setPageSize:u,pageIndex:t,pageSize:e,handleRowRestore:async e=>{G(e),N(!0)},handleRowDelete:e=>{V(e),z(!0)},handleRowUpdate:e=>{Y(!0),Z(!1),J(e)},handleRowHistory:e=>{W(e),R(!0)},handleRowView:e=>{Z(!0),Y(!1),J(e)},listType:q,setListType:e=>{Q(e)},searchConfig:{searchString:m,searchStringTrimmed:y,setSearchString:p,setAccessors:f},sortConfig:{sort:ee,setSort:te},exportConfig:{tableName:"customer_designations",apiQuery:{listType:q,customerDepartmentId:B,filterObject:ae}}}),(0,D.jsx)(j.A,{open:P,handleClose:()=>z(!1),handleConfirm:async()=>{const e=await(0,h.default)("/delete-customer-designation",{method:"DELETE",params:M});var t;e.success?(l(),z(!1)):(0,x.A)(null===e||void 0===e||null===(t=e.error)||void 0===t?void 0:t.message)},title:"Confirm Delete",message:"Are you sure you want to delete?",confirmBtnTitle:"Delete"}),(0,D.jsx)(j.A,{open:k,handleClose:()=>N(!1),handleConfirm:async()=>{const e={...F,isActive:"1"};(await(0,h.default)("/customer-designation-update",{method:"PUT",body:e,params:e.id})).success&&(l(),N(!1))},title:"Confirm Restore",message:"Are you sure you want to restore?",confirmBtnTitle:"Restore"}),(0,D.jsx)(n.A,{open:_,onClose:()=>R(!1),scroll:"paper",disableEscapeKeyDown:!0,maxWidth:"lg",children:(0,D.jsx)(S.default,{isHistory:!0,title:null===L||void 0===L?void 0:L.name,data:fe,columns:ye,count:ve,hideActions:!0,hideSearch:!0,hideAddButton:!0,hideExportButton:!0,setPageIndex:c,setPageSize:u,pageIndex:t,pageSize:e})})]})}}}]);