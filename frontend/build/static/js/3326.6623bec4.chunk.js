"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[3326],{53326:(e,t,r)=>{r.r(t),r.d(t,{default:()=>j});var o=r(9950),a=r(27081),n=r(95537),d=r(4139),i=r(67535),l=r(60666),s=r(9449),u=r(26473),c=r(28429),v=r(29024),m=r(80415),I=r(88848),h=r(62605),p=r(96951),g=r(14351),f=r(99635),y=r(71826),b=r(62054),x=r(47501),N=r(52351),S=r(44414);const j=()=>{const[e,t]=(0,o.useState)([]),[r,j]=(0,o.useState)(!1),[A,q]=(0,o.useState)(m.j7.pageIndex),[L,C]=(0,o.useState)(m.j7.pageSize),[_,k]=(0,o.useState)(null),[T,M]=(0,o.useState)(!1),D=(0,c.Zp)(),w=(0,s.mN)({resolver:(0,u.t)(l.Ik().shape()),defaultValues:{},mode:"all"}),z=(0,a.wA)();(0,o.useEffect)((()=>{z((0,v._G1)())}),[z]);const{masterMakerLovs:O}=(0,I.$)(),E=(e,t)=>{const r=e&&e.filter((e=>e.name===t));return r&&r.length?r[0].id:null},P=O.masterMakerLovsObject.rows,R=E(P,"CANCELMIN"),H=E(P,"CANCELGRN"),G=E(P,"GRN"),{refDataThird:$}=(0,h.t)(),{responseReq:F}=(0,o.useMemo)((()=>{var e,t;return{responseReq:(null===$||void 0===$||null===(e=$.refDataThirdObject)||void 0===e?void 0:e.rows)||[],count:(null===$||void 0===$||null===(t=$.refDataThirdObject)||void 0===t?void 0:t.count)||0}}),[$]),{handleSubmit:B}=w,Q=(0,o.useMemo)((()=>[{Header:"Name",accessor:"material.name"},{Header:"Code",accessor:"material.code"},{Header:"Quantity",accessor:"quantity"},{Header:"UOM",accessor:"uom.name"}]),[]),U=e=>{if(e&&e.length>0){return e.map((e=>e.serialNumber))}return[]};(0,o.useEffect)((()=>{var t,r,o,a,n,d,i;e&&e.length>0&&z((0,v.Trr)({transactionTypeId:G,requestNumber:null===e||void 0===e||null===(t=e[0])||void 0===t?void 0:t.requestNumber,storeId:null!==(r=e[0])&&void 0!==r&&r.otherStoreId&&null!==(null===(o=e[0])||void 0===o?void 0:o.otherStoreId)?null===(a=e[0])||void 0===a?void 0:a.otherStoreId:null===(n=e[0])||void 0===n||null===(d=n.stock_ledger_detail)||void 0===d?void 0:d.toStoreId,projectId:null===(i=e[0])||void 0===i?void 0:i.projectId}))}),[e,z,G]);const V=F.filter((e=>e.quantity>0)),Y=e=>{let t=[];return e&&e.length>0&&e.map((e=>t.push(e.id))),t},Z=e.map((e=>({...e,quantity:Math.abs(e.quantity)})));return(0,o.useEffect)((()=>{null!==_&&void 0!==_&&_.length&&t(_)}),[_]),(0,S.jsxs)(S.Fragment,{children:[T&&(0,S.jsx)(N.A,{}),(0,S.jsx)(p.Op,{methods:w,onSubmit:B((async()=>{var t,r,o,a;M(!0);const n=(()=>{var t,r,o,a,n;const d=[],i=[];return e.map((e=>{d.push({transactionTypeId:R,projectId:e.projectId,requestNumber:e.referenceDocumentNumber,organizationId:null===e||void 0===e?void 0:e.organizationId,storeId:null===e||void 0===e?void 0:e.storeId,storeLocationId:null===e||void 0===e?void 0:e.storeLocationId,otherStoreId:null===e||void 0===e?void 0:e.otherStoreId,otherStoreLocationId:null===e||void 0===e?void 0:e.otherStoreLocationId,materialId:e.materialId,uomId:e.uomId,quantity:e.quantity<0?-e.quantity:e.quantity,rate:e.rate,value:e.value,tax:e.tax,requestApproverId:e.id,serialNumber:U(e.material_serial_numbers)})})),V.map((e=>{i.push({transactionTypeId:H,projectId:e.projectId,requestNumber:e.referenceDocumentNumber,organizationId:null===e||void 0===e?void 0:e.organizationId,storeId:null===e||void 0===e?void 0:e.storeId,storeLocationId:null===e||void 0===e?void 0:e.storeLocationId,otherStoreId:null===e||void 0===e?void 0:e.otherStoreId,otherStoreLocationId:null===e||void 0===e?void 0:e.otherStoreLocationId,materialId:e.materialId,uomId:e.uomId,quantity:e.quantity>0?-e.quantity:e.quantity,rate:e.rate,value:e.value,tax:e.tax,requestApproverId:e.id,serialNumber:U(e.material_serial_numbers)})})),{transactionTypeId:R,grnTxnCreatedAt:null===(t=V[0])||void 0===t?void 0:t.createdAt,grnLedgerIds:[...Y(V)],grnLedgerDetailId:null===(r=V[0])||void 0===r||null===(o=r.stock_ledger_detail)||void 0===o?void 0:o.id,minLedgerIds:[...Y(e)],minLedgerDetailId:null===(a=e[0])||void 0===a||null===(n=a.stock_ledger_detail)||void 0===n?void 0:n.id,min_stock_ledgers:d,grn_stock_ledgers:i}})(),d=await(0,y.default)("/cancel-min-transaction-create",{method:"POST",body:n,timeoutOverride:12e4});var i;if(!d.success)return(0,b.A)((null===d||void 0===d||null===(i=d.error)||void 0===i?void 0:i.message)||"Operation failed. Please try again!",{variant:"error"}),void M(!1);const l=null!==(t=null===(r=d.data)||void 0===r?void 0:r.data)&&void 0!==t?t:{},s=l.referenceDocumentNumber||(null===(o=l[0])||void 0===o?void 0:o.referenceDocumentNumber),u=null===d||void 0===d||null===(a=d.data)||void 0===a?void 0:a.referenceDocNo;(0,b.A)(s?`Transaction cancelled with reference number: ${s}`:u&&`Transaction cancelled with reference numbers ${u.CANCELMIN} and ${u.CANCELGRN}`||"Transaction cancelled successfully!",{variant:"success",autoHideDuration:1e4}),M(!1),D("/stock-ledger")})),children:(0,S.jsxs)(g.A,{title:"Cancel MIN(Material Issue Note)",sx:{mb:2},children:[(0,S.jsx)(x.A,{type:"stockLedger",transactionType:"MIN",fromStoreLabel:"Company Store",fromStoreType:"COMPANY",showFromStoreAddress:!0,disableAll:!(null===_||void 0===_||!_.length),setReqData:k,setProjectId:()=>{}}),_&&_.length>0&&(0,S.jsxs)(n.A,{sx:{mt:4},children:[(0,S.jsx)(f.default,{title:"Cancel MIN",hideHeader:!0,hidePagination:!0,data:Z,count:e.length,columns:Q,hideActions:!0,setPageIndex:q,setPageSize:C,pageIndex:A,pageSize:L}),(0,S.jsx)(d.Ay,{item:!0,md:12,xl:2,sx:{mt:4},children:(0,S.jsxs)(d.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px"},children:[(0,S.jsx)(i.A,{onClick:()=>{j(!r),t([]),k(null),D("/cancel-min")},size:"small",variant:"outlined",color:"primary",children:"Back"}),(0,S.jsx)(i.A,{disabled:T,size:"small",type:"submit",variant:"contained",color:"primary",children:"Reverse"})]})})]})]})})]})}}}]);