"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[9508],{59302:(e,t,a)=>{a.d(t,{A:()=>$});var s=a(9950),n=a(12257),o=a(95537),r=a(87233),i=a(57073),l=a(92089),d=a(27987),c=a(14195),u=a(64661),p=a(35661),x=a(397),h=a(24965),m=a(10371),g=a(68605),j=a(22057),y=a(99624),A=a(77340),f=a(18655),v=a(71201),S=a(55271),b=a(34691),C=a(59019),T=a(81052),D=a.n(T),F=a(74288),w=a(3379),k=a(14351),I=a(33507),E=a(62054),W=a(96951),_=a(44414);const $=e=>{let{data:t,categoryName:a,subCategoryName:T,loadingCondition:$,title:P,backgroundColor:L,dateTimeFrom:O,dateTimeTo:R,setValue:M}=e;const{subCategories:B,processedData:H,categoryRowSpan:N}=((e,t,a)=>{if(!e||0===e.length)return{categories:[],subCategories:a,processedData:[],categoryRowSpan:{}};const s=[...new Set(e.map((e=>e[t])))],n=a,o=[],r={};return s.forEach((a=>{const s=e.filter((e=>e[t]===a)),i={};s.forEach((e=>{const t=n.find((t=>isNaN(e[t]))),s=n.indexOf(t),o=e[t];i[o]||(i[o]={category:a,[t]:o,...Object.fromEntries(n.slice(s+1).map((e=>[e,0])))}),n.slice(s+1).forEach((t=>{i[o][t]+=parseInt(e[t],10)}))}));const l=Object.values(i);r[a]=l.length,o.push(...l)})),{categories:s,subCategories:n,processedData:o,categoryRowSpan:r}})(t,a,T);let z=null,U=0;const{user:X}=(0,I.A)(),[Y,G]=(0,s.useState)(null),V=`dashboard-table-${P}`,q=()=>{G(null)},Q=()=>{const e=new Date,t=new Date(e.getTime()+198e5),a=t.getUTCFullYear(),s=String(t.getUTCMonth()+1).padStart(2,"0"),n=String(t.getUTCDate()).padStart(2,"0"),o=String(t.getUTCHours()).padStart(2,"0"),r=String(t.getUTCMinutes()).padStart(2,"0"),i=String(t.getUTCSeconds()).padStart(2,"0");return`${(e=>{const[t,...a]=e.trim().split(" "),s=a.map((e=>{var t;return null===(t=e.charAt(0))||void 0===t?void 0:t.toUpperCase()})).join("");return s?`${t} ${s}`:t})(null===X||void 0===X?void 0:X.name)}_${a}-${s}-${n}_${o}-${r}-${i} IST`};return(0,_.jsxs)(k.A,{children:[P&&(0,_.jsxs)(n.A,{sx:{border:"1px solid #97E7E1"},children:[(0,_.jsxs)(o.A,{sx:{backgroundColor:L,py:.7,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",px:2},children:["none"!==P&&(0,_.jsx)(o.A,{sx:{flex:1,display:"flex",justifyContent:"flex-start",alignItems:"center"},children:(0,_.jsx)(r.A,{variant:"h6",color:"common.white",children:P})}),(0,_.jsxs)(o.A,{sx:{display:"flex",gap:1.5,alignItems:"center",flex:"0 1 auto"},children:[(0,_.jsxs)(o.A,{sx:{display:"flex",gap:.7,alignItems:"center"},children:[(0,_.jsx)(r.A,{variant:"h6",color:"#fff",children:"From:"}),(0,_.jsx)(W.o3,{name:"dateTimeFrom",value:O,onChange:e=>M("dateTimeFrom",e.target.value),type:"date",InputLabelProps:{shrink:!0,style:{padding:"0 4px"}},InputProps:{style:{color:"#fff"}},sx:{borderRadius:1}})]}),(0,_.jsxs)(o.A,{sx:{display:"flex",gap:.7,alignItems:"center"},children:[(0,_.jsx)(r.A,{variant:"h6",color:"#fff",children:"To:"}),(0,_.jsx)(W.o3,{name:"dateTimeTo",value:R,onChange:e=>M("dateTimeTo",e.target.value),type:"date",InputLabelProps:{shrink:!0,style:{padding:"0 4px"}},InputProps:{style:{color:"#fff"}},sx:{borderRadius:1}})]})]}),(null===t||void 0===t?void 0:t.length)>0&&(0,_.jsx)(i.A,{"aria-label":"export options","aria-controls":"menu","aria-haspopup":"true",onClick:e=>{G(e.currentTarget)},sx:{color:"white",display:"none"},children:(0,_.jsx)(y.A,{})})]}),(0,_.jsxs)(l.A,{id:"menu",anchorEl:Y,keepMounted:!0,open:Boolean(Y),onClose:q,children:[(0,_.jsxs)(d.A,{onClick:async()=>{const e=Q(),t=document.getElementById(V);if(t)try{const a=await D()(t),s=a.width,n=a.height,o="none"!==P?50:0,r=document.createElement("canvas");r.width=s,r.height=n+o;const i=r.getContext("2d");"none"!==P&&(i.fillStyle="#FFFFFF",i.fillRect(0,0,r.width,o),i.fillStyle="#000000",i.font="bold 24px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText(P,r.width/2,o/2)),i.drawImage(a,0,o);const l=r.toDataURL("image/png"),d=document.createElement("a");d.href=l,d.download="none"===P?`${e}.png`:`${P.replace(/\s+/g,"_")}_${e}.png`,d.click(),(0,E.A)("Table exported as PNG successfully.",{variant:"success",autoHideDuration:1e3})}catch(a){(0,E.A)(a.message||"Can't export as PNG.",{variant:"error",autoHideDuration:1e3})}finally{q()}},children:[(0,_.jsx)(c.A,{children:(0,_.jsx)(A.A,{fontSize:"small"})}),"Export as PNG"]}),(0,_.jsxs)(d.A,{onClick:async()=>{const e=Q(),t=document.getElementById(V);if(t)try{const a=await D()(t),s=a.toDataURL("image/png"),n=new C.jsPDF;"none"!==P&&(n.setFontSize(24),n.setFont("Arial","bold"),n.text(P,n.internal.pageSize.getWidth()/2,20,{align:"center"})),n.addImage(s,"PNG",10,30,190,190*a.height/a.width),n.save("none"===P?`${e}.pdf`:`${P.replace(/\s+/g,"_")}_${e}.pdf`),(0,E.A)("Table exported as PDF successfully.",{variant:"success",autoHideDuration:1e3})}catch(a){(0,E.A)(a.message||"Can't export as PDF.",{variant:"error",autoHideDuration:1e3})}finally{q()}},children:[(0,_.jsx)(c.A,{children:(0,_.jsx)(f.A,{fontSize:"small"})}),"Export as PDF"]}),(0,_.jsxs)(d.A,{onClick:()=>{const e=Q(),t=S.Wp.json_to_sheet([]),s=S.Wp.book_new();let n=0;if("none"!==P){S.Wp.sheet_add_aoa(t,[[P]],{origin:"A1"});const e=B.length;t["!merges"]=[{s:{r:n,c:0},e:{r:n,c:e}}],n+=1}S.Wp.sheet_add_aoa(t,[[a,...B]],{origin:`A${n+1}`}),n+=1,H.forEach(((e,a)=>{const s=[];0===a||e.category!==H[a-1].category?s.push(e.category):s.push(""),B.forEach((t=>{s.push(e[t]||"")})),S.Wp.sheet_add_aoa(t,[s],{origin:`A${n+a+1}`})})),S.Wp.book_append_sheet(s,t,"Pivot Table Data");const o=S.M9(s,{bookType:"xlsx",type:"array"}),r=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});(0,b.saveAs)(r,"none"===P?`${e}.xlsx`:`${P.replace(/\s+/g,"_")}_${e}.xlsx`),(0,E.A)("Table exported as XLSX successfully.",{variant:"success",autoHideDuration:1e3}),q()},children:[(0,_.jsx)(c.A,{children:(0,_.jsx)(v.A,{fontSize:"small"})}),"Export as Excel"]})]})]}),(0,_.jsx)(u.A,{id:V,component:p.A,sx:{maxWidth:"100%",overflowX:"auto"},children:(0,_.jsxs)(x.A,{stickyHeader:!0,"aria-label":"pivot table",sx:{minWidth:750},children:[(0,_.jsx)(h.A,{children:(0,_.jsxs)(m.A,{children:[(0,_.jsx)(g.A,{sx:{backgroundColor:"#C6E0B4",paddingX:"6px",paddingY:"6px",fontSize:"0.6rem",fontWeight:"bold",lineHeight:"1.2"},children:a}),B.map((e=>(0,_.jsx)(g.A,{sx:{backgroundColor:"#C6E0B4",paddingX:"6px",paddingY:"6px",fontSize:"0.6rem",fontWeight:"bold",lineHeight:"1.2"},children:e},e)))]})}),(0,_.jsx)(j.A,{children:$?(0,_.jsx)(F.Q,{columns:[a,...B]}):H.length>0?H.map(((e,t)=>{const a=e.category!==z;return a&&(z=e.category,U=N[z]),(0,_.jsxs)(m.A,{sx:{height:"24px"},children:[a?(0,_.jsx)(g.A,{rowSpan:U,sx:{paddingX:"6px",paddingY:"4px",fontSize:"0.7rem",backgroundColor:"#FFF2CC",border:"1px solid #e2e2e2"},children:e.category}):(0,_.jsx)(g.A,{sx:{display:"none"}}),B.map((t=>(0,_.jsx)(g.A,{sx:{paddingX:"6px",paddingY:"4px",fontSize:"0.7rem"},children:e[t]},t)))]},t)})):(0,_.jsx)(m.A,{sx:{height:300},children:(0,_.jsx)(w.A,{})})})]})})]})}},89508:(e,t,a)=>{a.r(t),a.d(t,{dashboardSummaryPalette:()=>C,default:()=>F,transformDurationWiseSummary:()=>T});var s=a(9950),n=a(4139),o=a(95537),r=a(9449),i=a(26473),l=a(60666),d=a(27081),c=a(2043),u=a(53984),p=a(78581),x=a(94826),h=a(73961),m=a(29024),g=a(80733),j=a(84601),y=a(96951),A=a(40761),f=a(59302),v=a(6944),S=a(43997),b=a(44414);const C=["#D9D9D9","#EBF1DE","#FDE9D9","#DAEEF3","#F2F2F2","#F2DCDB"],T=e=>{let{data:t,sumByColumn:a}=e;if(null===t||void 0===t||!t.length)return[];const s=t.reduce(((e,t)=>{for(let s in t)s!==a&&(e[s]=(e[s]||0)+parseInt(t[s]));return e}),{}),n=Object.entries(s).map((e=>{let[t,a]=e;return{id:t,title:t.replace(/Tasks Completed|Tasks Completed At/gi,""),value:a}})),o="Total Tasks Completed";return[{id:o,title:o}].concat(n)},D="1px solid lightgray",F=()=>{var e,t,a,F,w,k,I,E,W,_,$,P,L,O,R,M,B;const H=(0,d.wA)(),N=(0,r.mN)({resolver:(0,i.t)(l.Ik().shape({projectId:j.A.project})),defaultValues:{},mode:"all"}),{setValue:z,watch:U}=N,[X,Y,G]=U(["projectId","dateTimeFrom","dateTimeTo"]),[V,q]=[null===(e=(0,g.Y)())||void 0===e||null===(t=e.projectsDropdown)||void 0===t?void 0:t.projectsDropdownObject,null===(a=(0,g.Y)())||void 0===a||null===(F=a.projectsDropdown)||void 0===F?void 0:F.loading],[Q,J,K]=[null===(w=(0,A.r)())||void 0===w||null===(k=w.projectSummaryDashboard)||void 0===k?void 0:k.projectSummaryDashboardObject,null===(I=(0,A.r)())||void 0===I||null===(E=I.projectSummaryDashboard)||void 0===E?void 0:E.loading,null===(W=(0,A.r)())||void 0===W||null===(_=W.projectSummaryDashboard)||void 0===_?void 0:_.error],[Z,ee,te]=[null===($=(0,A.r)())||void 0===$||null===(P=$.projectSummaryCumulativeStatus)||void 0===P||null===(L=P.projectSummaryCumulativeStatusObject)||void 0===L?void 0:L.cumulativeStatus,null===(O=(0,A.r)())||void 0===O||null===(R=O.projectSummaryCumulativeStatus)||void 0===R?void 0:R.loading,null===(M=(0,A.r)())||void 0===M||null===(B=M.projectSummaryCumulativeStatus)||void 0===B?void 0:B.error];(0,S.i)(K),(0,S.i)(te);const{taskTypeWiseStatus:ae,cumulativeStatus:se,dayWiseSurveyStatus:ne,dayWiseInstallationStatus:oe,dayWiseOMStatus:re,monthWiseSurveyStatus:ie,monthWiseInstallationStatus:le,monthWiseOMStatus:de}=Q,ce=T({data:ae,sumByColumn:"Response Type"}),ue=!q&&0===V.length,pe=(0,s.useCallback)((async()=>{X&&H((0,m.q41)({projectId:X}))}),[H,X]);(0,s.useEffect)((()=>{V.length>0&&z("projectId",V[0].id)}),[V,z]),(0,s.useEffect)((()=>{pe()}),[pe]);const xe=(0,c.useAsyncDebounce)((()=>{X&&(Y||G)&&H((0,m.zxB)({projectId:X,dateTimeFrom:Y,dateTimeTo:G}))}),1200);return(0,s.useEffect)((()=>{xe({projectId:X,dateTimeFrom:Y,dateTimeTo:G})}),[Y,G,H,xe,X]),(0,s.useEffect)((()=>{H((0,m.uiG)())}),[H]),(0,b.jsxs)(b.Fragment,{children:[(V&&V.length>1||ue)&&(0,b.jsx)(u.CustomMainCard,{title:(0,u.CenteredMainCardTitle)({title:"Project Summary Dashboard"}),sx:{mb:2,pb:1},children:(0,b.jsx)(y.Op,{methods:N,children:(0,b.jsx)(n.Ay,{container:!0,spacing:2,children:(0,b.jsx)(n.Ay,{item:!0,xs:12,md:3,children:(0,b.jsx)(y.eu,{name:"projectId",label:"Project",menus:V,required:!0})})})})}),!X&&J&&(0,b.jsx)(o.A,{sx:{height:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,b.jsx)(x.A,{})}),X&&(0,b.jsxs)(u.CustomMainCard,{title:(0,u.CenteredMainCardTitle)({title:"Project Summary Dashboard"}),sx:{mb:2},children:[(0,b.jsxs)(o.A,{sx:{mb:2},children:[(0,b.jsx)(o.A,{sx:{borderTop:D,borderLeft:D,borderRight:D},children:(0,b.jsx)(v.A,{palette:C,valueColor:"#000",data:ce,loadingCondition:J,expectedLength:6})}),ae&&ae.length>0&&ae.map(((e,t)=>(0,b.jsx)(o.A,{sx:{borderTop:D,borderLeft:D,borderRight:D,...t===ae.length-1&&{borderBottom:D}},children:(0,b.jsx)(v.A,{reducedHeight:!0,palette:C,valueColor:"#000",data:Object.entries(e).map(((e,t)=>{let[a,s]=e;return{id:a,...0===t?{title:s}:{value:s}}})),loadingCondition:J,expectedLength:6},e["Response Type"])},e["Response Type"])))]}),(0,b.jsxs)(n.Ay,{container:!0,spacing:2,children:[(0,b.jsx)(n.Ay,{item:!0,xs:12,children:(0,b.jsx)(o.A,{children:(0,b.jsx)(y.Op,{methods:N,children:(0,b.jsx)(f.A,{data:Y||G?Z:se,loadingCondition:ee||J,categoryName:"Response Type",subCategoryName:["Form Name","Task Completed","L1 Approval Pending","L1 Approved","L1 Rejected","L1 On-Hold","L2 Approval Pending","L2 Approved","L2 Rejected","L2 On-Hold"],title:"Cumulative Summary Status",backgroundColor:p.H_,dateTimeFrom:Y,dateTimeTo:G,setValue:z})})})}),(0,b.jsx)(n.Ay,{item:!0,xs:12,children:(0,b.jsx)(h.A,{chartData:ne,xAxis:"date",title:"Day Wise Survey Status",height:480})}),(0,b.jsx)(n.Ay,{item:!0,xs:12,children:(0,b.jsx)(h.A,{chartData:oe,xAxis:"date",title:"Day Wise Installation Status",height:480})}),(0,b.jsx)(n.Ay,{item:!0,xs:12,children:(0,b.jsx)(h.A,{chartData:re,xAxis:"date",title:"Day Wise O&M Status",height:520})}),(0,b.jsx)(n.Ay,{item:!0,xs:12,children:(0,b.jsx)(h.A,{chartData:ie,xAxis:"date",title:"Month Wise Survey Status",height:520})}),(0,b.jsx)(n.Ay,{item:!0,xs:12,children:(0,b.jsx)(h.A,{chartData:le,xAxis:"date",title:"Month Wise Installation Status",height:520})}),(0,b.jsx)(n.Ay,{item:!0,xs:12,children:(0,b.jsx)(h.A,{chartData:de,xAxis:"date",title:"Month Wise O&M Status",height:520})})]})]})]})}}}]);