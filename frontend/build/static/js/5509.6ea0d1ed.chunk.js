"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[5509],{65509:(e,t,r)=>{r.r(t),r.d(t,{default:()=>N});var a=r(9950),n=r(27081),o=r(12257),s=r(4139),i=r(87233),d=r(67535),l=r(60666),u=r(9449),c=r(26473),m=r(28429),v=r(29024),h=r(80415),p=r(88848),g=r(96951),x=r(14351),f=r(99635),I=r(62054),S=r(71826),y=r(52867),A=r(47501),b=r(52351),j=r(44414);const N=()=>{var e;const[t,r]=(0,a.useState)([]),[N,k]=(0,a.useState)(!1),[C,T]=(0,a.useState)(h.j7.pageIndex),[O,L]=(0,a.useState)(h.j7.pageSize),[q,w]=(0,a.useState)([]),[z,_]=(0,a.useState)(!1),G=(0,m.Zp)(),P=(0,u.mN)({resolver:(0,c.t)(l.Ik().shape({})),defaultValues:{},mode:"all"}),D=(0,n.wA)();(0,a.useEffect)((()=>{D((0,v._G1)()),D((0,v.uiG)())}),[D]);const{masterMakerLovs:M}=(0,p.$)(),R=(e,t)=>{const r=e&&e.filter((e=>e.name===t));return r&&r.length?r[0].id:void 0},H=M.masterMakerLovsObject.rows,E=R(H,"CANCELSTOGRN"),F=R(H,"COMPANY");(0,a.useEffect)((()=>{F&&D((0,v.qV$)({organizationType:F}))}),[D,F]);const{handleSubmit:V,setValue:$}=P,Y=null===q||void 0===q||null===(e=q.find((e=>e.quantity>0)))||void 0===e?void 0:e.organization_store,B=(0,a.useMemo)((()=>Y?[Y]:[]),[Y]),Q=(0,a.useMemo)((()=>[{Header:"Name",accessor:"material.name"},{Header:"Code",accessor:"material.code"},{Header:"Quantity",accessor:"quantity"},{Header:"UOM",accessor:"uom.name"}]),[]),U=e=>{if(e&&e.length>0){return e.map((e=>e.serialNumber))}return[]},Z=e=>{let t=[];return e&&e.length>0&&e.map((e=>t.push(e.id))),t};(0,a.useEffect)((()=>{null!==q&&void 0!==q&&q.length&&r(q)}),[q]),(0,a.useEffect)((()=>{var e;null!==B&&void 0!==B&&B.length&&$("toStoreId",null===B||void 0===B||null===(e=B[0])||void 0===e?void 0:e.id)}),[$,B]);const J=(0,y.ns)(Y);return(0,j.jsxs)(j.Fragment,{children:[z&&(0,j.jsx)(b.A,{}),(0,j.jsx)(g.Op,{methods:P,onSubmit:V((async()=>{var e,r,a;_(!0);const n=(()=>{var e,r,a;const n=[];return t.map((e=>{n.push({transactionTypeId:E,projectId:e.projectId,requestNumber:e.referenceDocumentNumber,stoRefDocNo:e.requestNumber,organizationId:null===e||void 0===e?void 0:e.organizationId,storeId:null===e||void 0===e?void 0:e.storeId,storeLocationId:null===e||void 0===e?void 0:e.storeLocationId,otherStoreId:null===e||void 0===e?void 0:e.otherStoreId,otherStoreLocationId:null===e||void 0===e?void 0:e.otherStoreLocationId,materialId:e.materialId,uomId:e.uomId,quantity:-e.quantity,rate:e.rate,value:e.value,tax:e.tax,serialNumber:U(e.material_serial_numbers)})})),{transactionTypeId:E,transactionCreatedAt:null===(e=t[0])||void 0===e?void 0:e.createdAt,stoGrnIds:Z(t),stoGrnLedgerDetailId:null===t||void 0===t||null===(r=t[0])||void 0===r||null===(a=r.stock_ledger_detail)||void 0===a?void 0:a.id,stock_ledgers:n}})(),o=await(0,S.default)("/cancel-sto-grn-transaction-create",{method:"POST",body:n,timeoutOverride:12e4});var s;if(!o.success)return(0,I.A)((null===o||void 0===o||null===(s=o.error)||void 0===s?void 0:s.message)||"Operation failed. Please try again!",{variant:"error"}),void _(!1);const i=null!==(e=null===(r=o.data)||void 0===r?void 0:r.data)&&void 0!==e?e:{},d=i.referenceDocumentNumber||(null===(a=i[0])||void 0===a?void 0:a.referenceDocumentNumber);(0,I.A)(d?`Transaction cancelled with reference number: ${d}`:"Transaction cancelled successfully!",{variant:"success",autoHideDuration:1e4}),_(!1),G("/stock-ledger")})),children:(0,j.jsxs)(x.A,{title:"Cancel STOGRN(Stock Transfer Order GRN)",sx:{mb:2},children:[(0,j.jsx)(A.A,{type:"stockLedger",transactionType:"STOGRN",fromStoreLabel:"Company Store",fromStoreType:"COMPANY",showFromStoreAddress:!0,setFromStoreId:()=>{},disableAll:!(null===q||void 0===q||!q.length),setReqData:w}),q&&q.length>0&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(s.Ay,{container:!0,spacing:4,alignItems:"center",sx:{mb:2,mt:1},children:[(0,j.jsx)(s.Ay,{item:!0,md:3,xl:3,children:(K="toStoreId",W="To Company Store",X=B,ee=!0,(0,j.jsx)(o.A,{children:(0,j.jsx)(g.eu,{name:K,label:W,..."function"===typeof te&&{onChange:te},InputLabelProps:{shrink:!0},menus:X,disable:!0,...ee&&{required:!0}})}))}),(0,j.jsxs)(s.Ay,{item:!0,md:6,xl:6,children:[(0,j.jsx)(i.A,{children:"Address: "}),(0,j.jsx)(i.A,{mt:2,children:J})]})]}),(0,j.jsx)(f.default,{title:"Cancel STO",hideHeader:!0,hidePagination:!0,data:t,count:t.length,columns:Q,hideActions:!0,setPageIndex:T,setPageSize:L,pageIndex:C,pageSize:O}),(0,j.jsx)(s.Ay,{item:!0,md:12,xl:2,sx:{mt:4},children:(0,j.jsxs)(s.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px"},children:[(0,j.jsx)(d.A,{onClick:()=>{k(!N),r([]),w(void 0),G("/cancel-sto-grn")},size:"small",variant:"outlined",color:"primary",children:"Back"}),(0,j.jsx)(d.A,{disabled:z,size:"small",type:"submit",variant:"contained",color:"primary",children:"Reverse"})]})})]})]})})]});var K,W,X,ee,te}}}]);