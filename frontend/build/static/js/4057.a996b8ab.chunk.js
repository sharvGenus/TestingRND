"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[4057,5406],{76243:(e,l,o)=>{o.r(l),o.d(l,{default:()=>U});var t=o(95537),s=o(4139),n=o(17808),i=o(13081),r=o(9950),d=o(27081),a=o(28429),c=o(94889),u=o(79843),m=o(59254),v=o(87233),h=o(44414);const f=(0,m.Ay)("div")((()=>({marginLeft:-10,paddingLeft:10,paddingTop:5,paddingBottom:5,cursor:"pointer",":hover":{background:"rgba(0, 0, 0, 0.06)",borderRadius:5}}))),x=e=>{let{setShowHide:l,onClickForm:o,level:t,val:n,selected:i,setSelected:d}=e;const[a,m]=(0,r.useState)(!1);return(0,h.jsx)(f,{style:{marginTop:5},onClick:()=>{var e;m(e=!a),l(e),n&&!n.child&&(o(n),d(n.name))},children:(0,h.jsxs)(s.Ay,{container:!0,spacing:1,pl:.1,pt:.3,pb:.3,children:[t>0&&(0,h.jsx)(s.Ay,{item:!0,xs:1,children:"\xa0\xa0"}),(0,h.jsx)(s.Ay,{item:!0,xs:1,children:n&&n.child&&n.child.length>0&&(0,h.jsx)(h.Fragment,{children:a?(0,h.jsx)(c.A,{}):(0,h.jsx)(u.A,{})})}),(0,h.jsx)(s.Ay,{item:!0,xs:10,children:(0,h.jsx)(v.A,{sx:{color:2==t?"purple":1==t?"green":"blue",fontWeight:i===n.name?700:400},children:n.name})})]})})},p=e=>{let{val:l,onClickForm:o,level:t,selected:s,setSelected:n}=e;const[i,d]=(0,r.useState)(!1);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(x,{setShowHide:d,val:l,level:t,selected:s,setSelected:n,onClickForm:()=>{l&&!l.child&&(o(l),n(l.name))}}),i&&(0,h.jsx)(A,{data:l.child,onClickForm:o,level:t+1,selected:s,setSelected:n})]})},A=e=>{let{data:l,onClickForm:o,level:t,selected:s,setSelected:n}=e;return(0,h.jsx)(h.Fragment,{children:l&&l.length>0&&l.map((e=>(0,h.jsx)(h.Fragment,{children:e&&e.id&&(0,h.jsx)(p,{val:e,level:t,onClickForm:o,selected:s,setSelected:n},null===e||void 0===e?void 0:e.id)})))})},j=e=>{let{data:l,showFormDetails:o}=e;const[t,s]=(0,r.useState)([]),[n,i]=(0,r.useState)("");(0,r.useEffect)((()=>{s(l)}),[l]);return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(A,{data:t,onClickForm:e=>{o(e.id,e.name)},level:0,selected:n,setSelected:i})})};var g=o(53065),b=o(57073),y=o(65669),C=o(36089),S=o(7999),_=o(26592),w=o(57988),k=o(79378),I=o(57560),L=o(49985),z=o(62375),F=o(99635),R=o(14351),E=o(29024),H=o(17663),D=o(71826),W=o(94826),M=o(62054);const O=e=>{let{values:l,deleteAndAddAccess:o,obj:t,onAction:s}=e;const[n,i]=(0,r.useState)(null),[d,a]=(0,r.useState)(null);return(0,r.useEffect)((()=>{i(l)}),[l]),(0,r.useEffect)((()=>{a(t)}),[t]),(0,h.jsxs)("div",{children:[(0,h.jsx)(g.A,{title:"View",placement:"bottom",children:"l1all"===d||"l2all"===d||d&&d.view||"all"===d?(0,h.jsx)(b.A,{color:null!==n&&void 0!==n&&n.view?"primary":"secondary",onClick:()=>{s("view")},children:(0,h.jsx)(z.A,{sx:{fontSize:18}})}):(0,h.jsx)(b.A,{color:null!==n&&void 0!==n&&n.view?"primary":"secondary",children:(0,h.jsx)(L.A,{sx:{fontSize:18}})})}),(0,h.jsx)(g.A,{title:"Edit",placement:"bottom",children:"l1all"===d||"l2all"===d||d&&d.update||"all"===d?(0,h.jsx)(b.A,{color:null!==n&&void 0!==n&&n.update?"primary":"secondary",onClick:()=>{s("update")},children:(0,h.jsx)(S.A,{sx:{fontSize:18}})}):(0,h.jsx)(b.A,{color:null!==n&&void 0!==n&&n.update?"primary":"secondary",children:(0,h.jsx)(C.A,{sx:{fontSize:18}})})}),o&&(0,h.jsx)(g.A,{title:"Delete",placement:"bottom",children:"l1all"===d||"l2all"===d||d&&d.deleteRecord||"all"===d?(0,h.jsx)(b.A,{color:null!==n&&void 0!==n&&n.deleteRecord?"primary":"secondary",onClick:()=>{s("deleteRecord")},children:(0,h.jsx)(w.A,{sx:{fontSize:18}})}):(0,h.jsx)(b.A,{color:null!==n&&void 0!==n&&n.deleteRecord?"primary":"secondary",children:(0,h.jsx)(_.A,{sx:{fontSize:18}})})})]})},N=e=>{let{details:l,name:o,id:t}=e;const n=(0,d.wA)(),[i,c]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),[v,f]=(0,r.useState)(""),[x,p]=(0,r.useState)([]),[A,j]=(0,r.useState)([]),[C,S]=(0,r.useState)(null),[_,w]=(0,r.useState)(!1),{pathname:L}=(0,a.zy)(),z=(0,r.useCallback)((()=>["is_resurvey","resurveyor_org_type","resurveyor_org_id","resurvey_by"]),[]),N=async function(e,l,o,t,s,n,i,r){let d=arguments.length>8&&void 0!==arguments[8]&&arguments[8],a={};if("stage1"===e?a=await(0,D.default)("/update-role-default-permissions",{method:"PUT",body:{formId:o,roleId:t,isL1L2:d,notColumnId:i,addColumnId:r,...l}}):"stage2"===e?a=await(0,D.default)("/update-role-column-permissions",{method:"PUT",body:{formId:o,roleId:t,columnId:n,...l}}):"stage3"===e?a=await(0,D.default)("/update-user-default-permissions",{method:"PUT",body:{formId:o,roleId:t,userId:s,isL1L2:d,notColumnId:i,addColumnId:r,...l}}):"stage4"===e&&(a=await(0,D.default)("/update-user-column-permissions",{method:"PUT",body:{formId:o,roleId:t,userId:s,columnId:n,...l}})),a)return!!a.success},P=e=>({view:e&&e.length>0&&e.some((e=>!0===(null===e||void 0===e?void 0:e.view))),update:e&&e.length>0&&e.some((e=>!0===(null===e||void 0===e?void 0:e.update)))}),T=function(e,l,o,t,s,n,i,r,d){var a,c;let u=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],m=!1,v=u?!n[e]:!P(n["l1all"===l?"l1":"l2"])[e];if("all"!==l&&"l1all"!==l&&"l2all"!==l&&null!==o?m=N("stage4",{[e]:!n[e]},t,s,o,null===n||void 0===n||null===(a=n.form_attribute)||void 0===a?void 0:a.id,i,r):"all"!==l&&"l1all"!==l&&"l2all"!==l&&null===o?m=N("stage2",{[e]:!n[e]},t,s,o,null===n||void 0===n||null===(c=n.form_attribute)||void 0===c?void 0:c.id,i,r):"all"!==l&&"l1all"!==l&&"l2all"!==l||null===o?("l1all"!==l&&"l2all"!==l||!v||"update"!==e||N("stage1",{[e]:!v},t,s,o,null,"l1all"===l?[...d.formsCols,...d.l1]:[...d.formsCols,...d.l2],"l1all"===l?d.l2:d.l1,"l1all"===l||"l2all"===l),m=N("stage1",{[e]:v},t,s,o,null,i,r,"l1all"===l||"l2all"===l)):m=N("stage3",{[e]:v},t,s,o,null,i,r,"l1all"===l||"l2all"===l),m){let l={...n};return u&&(l[e]=!n[e]),l}},U=(e,l,o)=>{let t=e&&e.length>0&&e[0]&&e[0].l1&&e[0].l1.length>0,s=e&&e.length>0&&e[0]&&e[0].l2&&e[0].l2.length>0,n=o?[{Header:" ",accessor:"userIcon",className:"userIcon"}]:[];if(n=[...n,{Header:l,accessor:o?"role.name":"user.name"}],t&&(n=[...n,{Header:"L1",accessor:"l1Actions"}]),s&&(n=[...n,{Header:"L2",accessor:"l2Actions"}]),n=[...n,{Header:"Forms Columns",accessor:"actions",className:"cell-center"}],e&&e.length>0){let l=e[0].formsCols;return l&&l.length>0&&l.map(((e,l)=>{var o;n=[...n,{Header:null===e||void 0===e||null===(o=e.form_attribute)||void 0===o?void 0:o.name,accessor:`formsCols[${l}].actions`,className:"cell-center"}]})),n}return[]},{formWithUsers:B}=(0,H.y)(),{formsData:V}=(0,r.useMemo)((()=>{var e;return{formsData:B.formsObject||[],count:(null===(e=B.formsObject)||void 0===e?void 0:e.count)||0,isLoading:B.loading||!1}}),[B]),$=(0,r.useCallback)(((e,l)=>e.map((e=>({...e,l1:e[l]&&e[l].length>0&&e[l].filter((e=>{var l,o,t;return(null===e||void 0===e||null===(l=e.form_attribute)||void 0===l||null===(o=l.columnName)||void 0===o?void 0:o.startsWith("l_a"))||z().includes(null===e||void 0===e||null===(t=e.form_attribute)||void 0===t?void 0:t.columnName)})),l2:e[l]&&e[l].length>0&&e[l].filter((e=>{var l,o;return null===e||void 0===e||null===(l=e.form_attribute)||void 0===l||null===(o=l.columnName)||void 0===o?void 0:o.startsWith("l_b")})),formsCols:e[l]&&e[l].length>0&&e[l].filter((e=>{var l,o,t,s,n;return!(null!==e&&void 0!==e&&null!==(l=e.form_attribute)&&void 0!==l&&null!==(o=l.columnName)&&void 0!==o&&o.startsWith("l_a"))&&!z().includes(null===e||void 0===e||null===(t=e.form_attribute)||void 0===t?void 0:t.columnName)&&!(null!==e&&void 0!==e&&null!==(s=e.form_attribute)&&void 0!==s&&null!==(n=s.columnName)&&void 0!==n&&n.startsWith("l_b"))}))})))),[z]);(0,r.useEffect)((()=>{if(w(!0),l&&Array.isArray(l)){w(!1);let e=$(l,"role_column_wise_permissions");j(e)}}),[l,$]),(0,r.useEffect)((()=>{if(V&&Array.isArray(V)){w(!1);let e=$(V,"user_column_wise_permissions");p(e)}}),[V,$]),(0,r.useEffect)((()=>{x&&u&&c(!0)}),[x,u]);const q=e=>e&&e.length>0&&e.map((e=>{var l;return null===e||void 0===e||null===(l=e.form_attribute)||void 0===l?void 0:l.id})),Z=(e,l)=>{let o=[];l?([...A].map((l=>{l.id===e.id&&(l={...e}),o.push(l)})),j(o)):([...x].map((l=>{l.id===e.id&&(l={...e}),o.push(l)})),p(o))},G=(e,l,o,t,s,n,i)=>e&&e.length>0&&e.map(((e,r)=>({...e,actions:(0,h.jsx)(O,{values:e,deleteAndAddAccess:!1,obj:l,onAction:d=>{let a={...l};a[o][r]=T(d,l,i,s,n,e,[],[],{}),Z(a,t)}})}))),J=function(e,l,o){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=null===e||void 0===e?void 0:e[l];return{...e,[l]:s&&s.length>0&&s.map((l=>({...l,[o]:t?!(null!==l&&void 0!==l&&l[o]):null===e||void 0===e?void 0:e[o]})))}},K=(e,l)=>{let o="rolesData"===e?A:x;return o&&o.length>0&&o.map((e=>{var o,s;return{...e,userIcon:(0,h.jsx)(g.A,{title:"Users",placement:"bottom",children:(0,h.jsx)(b.A,{color:"secondary",sx:{fontSize:20,marginLeft:-1,cursor:"pointer"},onClick:()=>{var o,s,i;l&&(w(!0),n((0,E.Nf5)({formId:t,roleId:null===e||void 0===e||null===(o=e.role)||void 0===o?void 0:o.id})),f(null===e||void 0===e||null===(s=e.role)||void 0===s?void 0:s.name),S(null===e||void 0===e||null===(i=e.role)||void 0===i?void 0:i.id),m(!0))},children:(0,h.jsx)(k.A,{})})}),l1Actions:(0,h.jsx)(O,{values:P(null===e||void 0===e?void 0:e.l1),deleteAndAddAccess:!1,obj:"l1all",onAction:o=>{if(P(null===e||void 0===e?void 0:e.l2)[o]&&!P(null===e||void 0===e?void 0:e.l1)[o]&&"update"===o)(0,M.A)("Only one level of approver (either L1 or L2) can be enabled at a time.",{variant:"error"});else{var s,n;let i=T(o,"l1all",l?null:null===e||void 0===e||null===(s=e.user)||void 0===s?void 0:s.id,t,l?null===e||void 0===e||null===(n=e.role)||void 0===n?void 0:n.id:C,e,q([...e.formsCols,...e.l2]),q([...e.l1]),{formsCols:q([...e.formsCols]),l1:q([...e.l1]),l2:q([...e.l2])},!1);Z(J({...i},"l1",o,!0),l)}}}),l2Actions:(0,h.jsx)(O,{values:P(null===e||void 0===e?void 0:e.l2),deleteAndAddAccess:!1,obj:"l2all",onAction:o=>{if(P(null===e||void 0===e?void 0:e.l1)[o]&&!P(null===e||void 0===e?void 0:e.l2)[o]&&"update"===o)(0,M.A)("Only one level of approver (either L1 or L2) can be enabled at a time.",{variant:"error"});else{var s,n;let i=T(o,"l2all",l?null:null===e||void 0===e||null===(s=e.user)||void 0===s?void 0:s.id,t,l?null===e||void 0===e||null===(n=e.role)||void 0===n?void 0:n.id:C,e,q([...e.l1,...e.formsCols]),q([...e.l2]),{formsCols:q([...e.formsCols]),l1:q([...e.l1]),l2:q([...e.l2])},!1);Z(J({...i},"l2",o,!0),l)}}}),actions:(0,h.jsx)(O,{values:e,deleteAndAddAccess:!0,obj:"all",onAction:o=>{var s,n;let i=T(o,"all",l?null:null===e||void 0===e||null===(s=e.user)||void 0===s?void 0:s.id,t,l?null===e||void 0===e||null===(n=e.role)||void 0===n?void 0:n.id:C,e,q([...e.l1,...e.l2]),q([...e.formsCols]),{});Z(J({...i},"formsCols",o),l)}}),formsCols:G(e.formsCols,e,"formsCols",l,t,l?null===e||void 0===e||null===(o=e.role)||void 0===o?void 0:o.id:C,l?null:null===e||void 0===e||null===(s=e.user)||void 0===s?void 0:s.id)}}))},Q=()=>{c(!1),p([]),m(!1)};return(0,r.useEffect)((()=>{j([]),p([])}),[L]),(0,h.jsxs)(h.Fragment,{children:[_&&(0,h.jsx)(W.A,{}),A&&(0,h.jsx)(F.default,{title:o,accessTableOnly:!0,hideActions:!0,hideExportButton:!0,hideAddButton:!0,hidePagination:!0,forColumnAccess:!0,data:K("rolesData",!0)||[],count:A.length||0,columns:U(A,"Role",!0)}),(0,h.jsx)(y.A,{open:i,onClose:Q,"aria-labelledby":"modal-modal-title",children:(0,h.jsxs)(R.A,{sx:{width:1020},modal:!0,darkTitle:!0,content:!1,children:[(0,h.jsx)(s.Ay,{container:!0,spacing:2,alignItems:"center",sx:{mt:-1,mb:-1},children:(0,h.jsx)(s.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",padding:"20px"},children:(0,h.jsx)(I.A,{onClick:Q,style:{cursor:"pointer",fontSize:20}})})}),(0,h.jsx)("div",{children:x&&(0,h.jsx)(F.default,{title:v,accessTableOnly:!0,hideActions:!0,hideExportButton:!0,hideAddButton:!0,hidePagination:!0,forColumnAccess:!0,data:K("formDetails",!1)||[],count:x.length||0,columns:U(x,"Users",!1)})})]})})]})},P=()=>{const e=(0,d.wA)(),[l,o]=(0,r.useState)([]),[t,n]=(0,r.useState)(""),[i,c]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),[v,f]=(0,r.useState)(null),{pathname:x}=(0,a.zy)();(0,r.useEffect)((()=>{o([]),n(""),f(null),m(!1)}),[x]);const{formProjectWise:p}=(0,H.y)(),{formsData:A}=(0,r.useMemo)((()=>{var e;return{formsData:p.formsObject||[],count:(null===(e=p.formsObject)||void 0===e?void 0:e.count)||0,isLoading:p.loading||!1}}),[p]),{formWithRoles:g}=(0,H.y)(),{formsRspData:b}=(0,r.useMemo)((()=>{var e;return{formsRspData:g.formsObject||[],count:(null===(e=g.formsObject)||void 0===e?void 0:e.count)||0,isLoading:g.loading||!1}}),[g]);return(0,r.useEffect)((()=>{b&&(o(b),c(!1))}),[b]),(0,r.useEffect)((()=>{e((0,E.qZH)())}),[e]),(0,h.jsxs)(s.Ay,{container:!0,spacing:1,children:[i&&(0,h.jsx)(W.A,{}),(0,h.jsx)(s.Ay,{item:!0,xs:12,md:3,children:(0,h.jsx)(j,{data:A,showFormDetails:(l,t)=>{o([]),c(!0),m(!0),e((0,E.mlC)(l)),n(t),f(l)}})}),(0,h.jsx)(s.Ay,{item:!0,xs:12,md:9,children:(0,h.jsx)(N,{details:u?l:[],name:t,id:v})})]})};function T(e){let{children:l,value:o,index:s,...n}=e;return(0,h.jsx)("div",{role:"tabpanel",hidden:o!==s,id:`simple-tabpanel-${s}`,"aria-labelledby":`simple-tab-${s}`,...n,children:o===s&&(0,h.jsx)(t.A,{sx:{pt:2},children:l})})}const U=()=>{const[e,l]=(0,r.useState)(0),o=(0,h.jsx)(R.A,{title:"",children:(0,h.jsx)(s.Ay,{container:!0,spacing:1,children:(0,h.jsx)(s.Ay,{item:!0,xs:12,children:(0,h.jsx)(P,{})})})});return(0,h.jsx)(s.Ay,{container:!0,spacing:1,children:(0,h.jsx)(s.Ay,{item:!0,xs:12,children:(0,h.jsxs)(t.A,{sx:{width:"100%"},children:[(0,h.jsx)(t.A,{sx:{borderBottom:1,borderColor:"divider"},children:(0,h.jsx)(n.A,{value:e,onChange:(e,o)=>{l(o)},"aria-label":"basic tabs example",children:(0,h.jsx)(i.A,{label:"Form Responses",...(d=0,{id:`simple-tab-${d}`,"aria-controls":`simple-tabpanel-${d}`})})})}),(0,h.jsx)(T,{value:e,index:0,children:o})]})})});var d}},17663:(e,l,o)=>{o.d(l,{y:()=>s});var t=o(27081);const s=()=>{const e=(0,t.d4)((e=>e.formResponses)),l=(0,t.d4)((e=>e.secondFormResponses));return{formResponse:e,formProjectWise:(0,t.d4)((e=>e.formsProjectWise)),formWithRoles:(0,t.d4)((e=>e.formsWithRoles)),formWithUsers:(0,t.d4)((e=>e.formsWithUsers)),secondFormResponse:l}}},13239:(e,l,o)=>{o.d(l,{A:()=>d});var t=o(89379),s=o(9950);const n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z"}}]},name:"check",theme:"outlined"};var i=o(14840),r=function(e,l){return s.createElement(i.A,(0,t.A)((0,t.A)({},e),{},{ref:l,icon:n}))};const d=s.forwardRef(r)},57988:(e,l,o)=>{var t=o(24994);l.A=void 0;var s=t(o(79526)),n=o(44414);l.A=(0,s.default)((0,n.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},26592:(e,l,o)=>{var t=o(24994);l.A=void 0;var s=t(o(79526)),n=o(44414);l.A=(0,s.default)((0,n.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutline")},7999:(e,l,o)=>{var t=o(24994);l.A=void 0;var s=t(o(79526)),n=o(44414);l.A=(0,s.default)((0,n.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit")},36089:(e,l,o)=>{var t=o(24994);l.A=void 0;var s=t(o(79526)),n=o(44414);l.A=(0,s.default)((0,n.jsx)("path",{d:"m14.06 9.02.92.92L5.92 19H5v-.92zM17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29m-3.6 3.19L3 17.25V21h3.75L17.81 9.94z"}),"EditOutlined")},62375:(e,l,o)=>{var t=o(24994);l.A=void 0;var s=t(o(79526)),n=o(44414);l.A=(0,s.default)((0,n.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")}}]);