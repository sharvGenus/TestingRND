"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[4354],{74354:(e,t,o)=>{o.r(t),o.d(t,{default:()=>W});var r=o(9950),l=o(27081),a=o(53065),n=o(57073),i=o(4139),s=o(67535),d=o(36089),u=o(26592),c=o(28429),v=o(62375),m=o(62605),I=o(26473),f=o(60666),S=o(12257),x=o(87233),g=o(9449),j=o(80733),p=o(29024),h=o(88848),y=o(3147),b=o(55519),A=o(66004),L=o(12952),k=o(79033),O=o(96951),T=o(14351),w=o(84601),M=o(60845),C=o(52867),N=o(62054),z=o(90376),E=o(44414);const q=e=>{var t,o,a,n,d;let{disableAll:u,saveData:c}=e;const[v,m]=(0,r.useState)(""),[q,_]=(0,r.useState)(null),[D,F]=(0,r.useState)(null),[P,H]=(0,r.useState)(null),[V,$]=(0,r.useState)(null),[B,R]=(0,r.useState)(!1),U=(0,g.mN)({resolver:(0,I.t)(f.Ik().shape({projectId:w.A.project,orgTypeId:w.A.organizationType,contractorStoreId:w.A.organizationStoreId,contractor:w.A.organizationId,roleId:w.A.requiredWithLabel("Role"),fromInstallerId:w.A.fromInstaller,toInstallerId:w.A.toInstaller,toInstallerStoreLocationId:w.A.toStoreLocationId})),defaultValues:{},mode:"all"}),{handleSubmit:G,watch:Q,setValue:W}=U,[Y]=Q(["projectId"]),J=(0,l.wA)();(0,r.useEffect)((()=>{J((0,p._G1)()),J((0,p.uiG)())}),[J]);const{projectsDropdown:Z}=(0,j.Y)(),{masterMakerLovs:X}=(0,h.$)(),K=e=>{"projectId"===e&&(W("orgTypeId",null),W("contractor",null),W("contractorBranch",null),W("contractorStoreId",null),W("roleId",null),W("fromInstallerId",null),W("toInstallerId",null),W("toInstallerStoreLocationId",null),m("")),"orgTypeId"===e&&(W("contractor",null),W("contractorBranch",null),W("contractorStoreId",null),W("roleId",null),W("fromInstallerId",null),W("toInstallerId",null),W("toInstallerStoreLocationId",null),m("")),"contractor"===e&&(W("contractorBranch",null),W("contractorStoreId",null),W("roleId",null),W("fromInstallerId",null),W("toInstallerId",null),W("toInstallerStoreLocationId",null),m("")),"contractorBranch"===e&&(W("contractorStoreId",null),W("roleId",null),W("fromInstallerId",null),W("toInstallerId",null),W("toInstallerStoreLocationId",null),m("")),"contractorStoreId"===e&&(W("roleId",null),W("fromInstallerId",null),W("toInstallerId",null),W("toInstallerStoreLocationId",null)),"roleId"===e&&(W("fromInstallerId",null),W("toInstallerId",null),W("toInstallerStoreLocationId",null)),"fromInstallerId"===e&&(W("toInstallerId",null),W("toInstallerStoreLocationId",null)),"toInstallerId"===e&&W("toInstallerStoreLocationId",null)},ee=((e,t)=>{const o=e&&e.filter((e=>e.name===t));return o&&o.length?o[0].id:void 0})(X.masterMakerLovsObject.rows,"ITI"),{organizationsDropdown:te,organizationsLocationDropdown:oe}=(0,b.G)(),{roleProjects:re}=(0,k.z)(),le=(null===re||void 0===re||null===(t=re.roleProjectsObject)||void 0===t?void 0:t.rows)||[],ae=null===Z||void 0===Z?void 0:Z.projectsDropdownObject,{organizationStores:ne}=(0,y.E)(),{firmStoreLocations:ie,companyStoreLocations:se}=(0,L.V)(),de=[...(null===(o=ne.organizationStoreObject)||void 0===o?void 0:o.rows)||[]],{users:ue}=(0,A.k)(),ce=(null===te||void 0===te?void 0:te.organizationDropdownObject)||[],ve=(null===oe||void 0===oe?void 0:oe.organizationLocationDropdownObject)||[],me=[...ce],[Ie,fe]=(0,r.useState)([]),Se=(null===ie||void 0===ie||null===(a=ie.firmStoreLocationsObject)||void 0===a?void 0:a.rows)||[],xe=(null===se||void 0===se||null===(n=se.companyStoreLocationsObject)||void 0===n?void 0:n.rows)||[],ge=B?xe:Se,je=(null===(d=ue.usersObject)||void 0===d?void 0:d.rows)||[],pe=(e,t,o,r,l)=>(0,E.jsx)(S.A,{children:(0,E.jsx)(O.eu,{name:e,label:t,..."function"===typeof l&&{onChange:l},InputLabelProps:{shrink:!0},menus:o,...u&&{disable:!0},...r&&{required:!0}})});(0,r.useEffect)((()=>{Y&&J((0,p.PBN)({selectedProject:Y}))}),[J,Y]);const{masterMakerOrgTypeSecond:{masterObject:he}}=(0,h.$)();return(0,r.useEffect)((()=>{J((0,p.rHZ)("ORGANIZATION TYPE"))}),[J]),(0,E.jsx)(E.Fragment,{children:(0,E.jsx)(T.A,{title:"Material Transfer Installer to Installer",sx:{mb:2},children:(0,E.jsx)(O.Op,{methods:U,children:(0,E.jsxs)(i.Ay,{container:!0,spacing:4,children:[(0,E.jsx)(i.Ay,{item:!0,xs:12,sx:{textAlign:"right"},mt:-9,children:(0,E.jsx)(z.ON,{tableName:"iti",apipath:"/import-iti-transaction",forTraxns:!0})}),(0,E.jsx)(i.Ay,{item:!0,md:3,xl:2,children:pe("projectId","Project",ae,!0,(()=>{K("projectId")}))}),(0,E.jsx)(i.Ay,{item:!0,md:3,xl:2,children:pe("orgTypeId","Organization Type",he.filter((e=>"420e7b13-25fd-4d23-9959-af1c07c7e94b"===e.id||"decb6c57-6d85-4f83-9cc2-50e0630003df"===e.id)),!0,(e=>{var t,o,r,l,a,n,i;(K("orgTypeId"),null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value)&&(J((0,p.d8s)(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value)),J((0,p.Ywh)(null===e||void 0===e||null===(r=e.target)||void 0===r?void 0:r.value)),J((0,p.qV$)({organizationType:null===e||void 0===e||null===(l=e.target)||void 0===l?void 0:l.value})),"420e7b13-25fd-4d23-9959-af1c07c7e94b"===(null===e||void 0===e||null===(a=e.target)||void 0===a?void 0:a.value)?(W("isCompany",!0),R(!0),J((0,M.Ru)({organizationType:null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value}))):(W("isCompany",!1),R(!1),J((0,M.c1)({organizationType:null===e||void 0===e||null===(i=e.target)||void 0===i?void 0:i.value}))))}))}),(0,E.jsx)(i.Ay,{item:!0,md:3,xl:2,children:pe("contractor","Organization",(0,C.HF)(me),!0,(e=>{var t;if(K("contractor"),null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value){var o;H(e.target.value),F(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value);let t=ve.filter((t=>t.parent&&null!==t.parent&&t.parent.id===e.target.value));fe(t)}}))}),(0,E.jsx)(i.Ay,{item:!0,md:3,xl:2,children:pe("contractorBranch","Organization Branch",(0,C.HF)(Ie),!1,(e=>{var t;if(K("contractorBranch"),null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value){var o,r,l;let t=null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.row;H(t&&t.parent&&null!==t.parent?null===t||void 0===t||null===(r=t.parent)||void 0===r?void 0:r.id:e.target.value),F(null===e||void 0===e||null===(l=e.target)||void 0===l?void 0:l.value)}}))}),(0,E.jsx)(i.Ay,{item:!0,md:3,xl:2,children:pe("contractorStoreId","Organization Store",de.filter((e=>e.organizationId===D)),!0,(e=>{var t;if(null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value){var o,r;const t=((e,t)=>{const o=e&&e.filter((e=>e.id===t));return o&&o.length?o[0]:{}})(de,e.target.value),l=t.city,a=(t.address,t.address),n=t.pincode?t.pincode:t.pinCode;let i;m(`${a}, ${l.name}, ${l.state.name}, ${l.state.country.name}, ${n}`),$(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value),i=ge.filter((t=>{var o,r,l;return t.organizationStoreId===(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value)&&(null===t||void 0===t||null===(r=t.name)||void 0===r||null===(l=r.toLowerCase())||void 0===l?void 0:l.includes("receiving"))})),i&&0===i.length&&B&&(i=ge.filter((t=>{var o,r,l;return t.organizationStoreId===(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value)&&(null===t||void 0===t||null===(r=t.name)||void 0===r||null===(l=r.toLowerCase())||void 0===l?void 0:l.includes("brought out"))})),i&&0===i.length&&(i=ge.filter((t=>{var o,r,l;return t.organizationStoreId===(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value)&&(null===t||void 0===t||null===(r=t.name)||void 0===r||null===(l=r.toLowerCase())||void 0===l?void 0:l.includes("genus supply"))})))),W("receivingStore",i&&i.length?null===(r=i[0])||void 0===r?void 0:r.id:null)}}))}),(0,E.jsxs)(i.Ay,{item:!0,md:3,xl:2,children:[(0,E.jsx)(x.A,{children:"Address: "}),(0,E.jsx)(x.A,{mt:2,children:v})]}),(0,E.jsx)(i.Ay,{item:!0,md:3,xl:2,children:pe("roleId","Role",le,!0,(e=>{var t,o;null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value&&J((0,p.loF)({organizationId:P,roleId:null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value}))}))}),(0,E.jsx)(i.Ay,{item:!0,md:3,xl:2,children:pe("fromInstallerId","From Installer",je,!0,(e=>{var t,o;null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value&&_(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value)}))}),(0,E.jsx)(i.Ay,{item:!0,md:3,xl:2,children:pe("toInstallerId","To Installer",je.filter((e=>e.id!==q&&!1===e.isLocked)),!0,(()=>{var e,t;const o=ge.filter((e=>{var t,o;return e.organizationStoreId===V&&(null===e||void 0===e||null===(t=e.name)||void 0===t||null===(o=t.toLowerCase())||void 0===o?void 0:o.includes("installer"))}));W("toInstallerStoreLocationId",o&&o.length?null===(e=o[0])||void 0===e?void 0:e.id:null),W("toInstallerStoreLocationName",o&&o.length?null===(t=o[0])||void 0===t?void 0:t.name:null)}))}),(0,E.jsx)(i.Ay,{item:!0,md:3,xl:2,children:pe("toInstallerStoreLocationId","To Store Location",ge.filter((e=>{var t,o;return e.organizationStoreId===V&&(null===e||void 0===e||null===(t=e.name)||void 0===t||null===(o=t.toLowerCase())||void 0===o?void 0:o.includes("installer"))})),!0)}),(0,E.jsx)(i.Ay,{item:!0,md:3,xl:2,children:function(e,t,o,r){let l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(0,E.jsx)(S.A,{spacing:1,children:(0,E.jsx)(O.o3,{name:e,type:o,label:t,InputLabelProps:{shrink:l},...u&&{disabled:!0},...r&&{required:!0}})})}("remarks","Remarks","text",!1)}),!u&&(0,E.jsx)(i.Ay,{container:!0,spacing:4,children:(0,E.jsx)(i.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px"},mt:4,children:(0,E.jsx)(s.A,{size:"small",variant:"contained",onClick:G((e=>{null===e.receivingStore?(0,N.A)("Receiving store location not found for selected store.",{variant:"error",autoHideDuration:2e3}):(e.orgId=P,e.contractorId=P,e.transactionTypeId=ee,c(e))})),color:"primary",children:"Next"})})})]})})})})};var _=o(65669),D=o(14563),F=o(95615),P=o(94826);const H={cursor:"pointer",fontSize:24},V=e=>{let{materials:t,onMaterailsInput:o,formData:a,selectedItems:n,view:d,update:u,showData:c,hideTaxDetails:v=!1}=e;const[S,j]=(0,r.useState)(!1),[y,b]=(0,r.useState)(null),[A,k]=(0,r.useState)(null),[M,N]=(0,r.useState)(c&&c.rate?null===c||void 0===c?void 0:c.rate:null),[z,q]=(0,r.useState)([]),[V,$]=(0,r.useState)(null),[B,R]=(0,r.useState)(""),[U,G]=(0,r.useState)(""),[Q,W]=(0,r.useState)(null),[Y,J]=(0,r.useState)([]),[Z,X]=(0,r.useState)(!1),[K,ee]=(0,r.useState)(!1),[te,oe]=(0,r.useState)(!1),re=(0,l.wA)();(0,r.useEffect)((()=>{re((0,p._G1)())}),[re]);const{masterMakerLovs:le}=(0,h.$)(),ae=le.masterMakerLovsObject.rows,{firmStoreLocations:ne,companyStoreLocations:ie}=(0,L.V)(),se=(0,C.x)(ae,"CONTRACTOR"),de=(0,C.x)(ae,"COMPANY");(0,r.useEffect)((()=>{se&&re((0,p.c1B)({organizationType:se})),de&&re((0,p.Ru7)({organizationType:de}))}),[re,se,de]),(0,r.useEffect)((()=>{j(!!d)}),[d,u]);const ue=(0,g.mN)({resolver:(0,I.t)(f.Ik().shape({materialId:w.A.requiredWithLabel("Material"),quantity:K?w.A.checkForInteger("Quantity",A):w.A.maxQuantity(A,!0),fromStoreLocationId:w.A.fromStoreLocationId})),defaultValues:{},mode:"all"}),{handleSubmit:ce,setValue:ve,reset:me,watch:Ie}=ue,fe=Ie("uom");(0,r.useEffect)((()=>{var e;(d||u)&&c&&(X(!0),$(c),re((0,p.a2o)({project:null===a||void 0===a?void 0:a.projectId,store:null===a||void 0===a?void 0:a.contractorStoreId,installerId:null===a||void 0===a?void 0:a.fromInstallerId,storeLocation:null===c||void 0===c?void 0:c.fromStoreLocationId,material:null===c||void 0===c?void 0:c.materialId})),re((0,p.J9T)({project:null===a||void 0===a?void 0:a.projectId,store:null===a||void 0===a?void 0:a.contractorStoreId,installer:null===a||void 0===a?void 0:a.fromInstallerId,storeLocation:null===c||void 0===c?void 0:c.fromStoreLocationId,material:null===c||void 0===c?void 0:c.materialId})),e=c,Object.entries(e).forEach((e=>{let[t,o]=e;"actions"!==t&&ve(t,o),"uom"===t&&ve(t,"string"===typeof o?o:o.name)})))}),[d,u,c,me,ve,re,a]);const Se=(0,r.useMemo)((()=>{var e;return(null===ne||void 0===ne||null===(e=ne.firmStoreLocationsObject)||void 0===e?void 0:e.rows)||[]}),[ne]),xe=(0,r.useMemo)((()=>{var e;return(null===ie||void 0===ie||null===(e=ie.companyStoreLocationsObject)||void 0===e?void 0:e.rows)||[]}),[ie]),ge=(0,r.useMemo)((()=>[...Se,...xe]||[]),[Se,xe]);(0,r.useEffect)((()=>{if(ge){const e=ge.filter((e=>{var t,o;return e.id!==c.StoreLocationId&&(null===e||void 0===e||null===(t=e.name)||void 0===t||null===(o=t.toLowerCase())||void 0===o?void 0:o.includes("installer"))&&e.organizationStoreId===a.contractorStoreId}));q(e)}}),[ge,c,a]);const je=(e,t,o,r,l,a)=>(0,E.jsx)(O.eu,{name:e,label:t,onChange:l,InputLabelProps:{shrink:!0},menus:o,...a&&{disable:!0},...r&&{required:!0}}),pe=function(e,t,o,r,l){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return(0,E.jsx)(O.o3,{name:e,type:o,label:t,..."function"===typeof l&&{handleChange:l},InputLabelProps:{shrink:n},...(a||S)&&{disabled:!0},...r&&{required:!0}})},[he,ye]=(0,r.useState)([]),[be,Ae]=(0,r.useState)([]),[Le,ke]=(0,r.useState)(!1),[Oe,Te]=(0,r.useState)(!1),we=e=>{ye(e)},Me=()=>{ke(!1)},{txnByLocationMaterial:Ce,serialNumbers:Ne}=(0,m.t)();let{projectSLData:ze}=(0,r.useMemo)((()=>({projectSLData:(null===Ce||void 0===Ce?void 0:Ce.stocksObject)||[],isLoading:Ce.loading||!1})),[Ce]);(0,r.useEffect)((()=>{ze&&J(ze)}),[ze]),(0,r.useEffect)((()=>{if(oe(!1),Y&&Y.length>0&&null!==Q){const e=null===Y||void 0===Y?void 0:Y[0],t=(null===V||void 0===V?void 0:V.id)+Q,o=null===n||void 0===n?void 0:n[t],r=(0,C.$G)(e.quantity),l=parseFloat(e.rate).toFixed(2),a=e.tax;ve("qtyStk",r),o?(ve("quantity",o.quantity),ye(o.material_serial_numbers)):(ve("quantity",u&&null!==c&&void 0!==c&&c.quantity?c.quantity:0),ye(u&&null!==c&&void 0!==c&&c.material_serial_numbers?c.material_serial_numbers:[])),k(r),ve("rate",l),N(l),ve("tax",a),null!==c&&void 0!==c&&c.quantity&&ve("value",parseFloat(l*c.quantity).toFixed(2))}else ve("qtyStk",null!==Q?0:null),ve("rate","0"),N(0),ve("tax","0"),ve("value","0"),k(null)}),[Y,ve,n,u,V,Q,c]);const{serialNumbersData:Ee}=(0,r.useMemo)((()=>{var e;return{serialNumbersData:(null===Ne||void 0===Ne?void 0:Ne.data)||[],countSN:(null===Ne||void 0===Ne||null===(e=Ne.data)||void 0===e?void 0:e.count)||0}}),[Ne]);return(0,E.jsx)(E.Fragment,{children:(0,E.jsx)(T.A,{sx:{mb:2,pb:4},children:(0,E.jsxs)(O.Op,{methods:ue,children:[te&&(0,E.jsx)(P.A,{}),(0,E.jsxs)(i.Ay,{container:!0,spacing:2,sx:{mt:2},children:[(0,E.jsx)(i.Ay,{item:!0,xs:12,sm:4,children:je("materialId","Material",(0,C.Jw)(t),!0,(e=>{var t,o,r;if(null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value){var l,n;let t=null===e||void 0===e||null===(l=e.target)||void 0===l?void 0:l.row;ve("code",null===t||void 0===t?void 0:t.code),ve("uom",null===t||void 0===t?void 0:t.uomName),ve("fromStoreLocationId",a.toInstallerStoreLocationId),G(a.toInstallerStoreLocationName),W(a.toInstallerStoreLocationId),o=a.toInstallerStoreLocationId,r=null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value,o&&(oe(!0),ye([]),Ae([]),c.material_serial_numbers=[],ve("qtyStk","0"),k("0"),re((0,p.a2o)({project:null===a||void 0===a?void 0:a.projectId,store:null===a||void 0===a?void 0:a.contractorStoreId,installerId:null===a||void 0===a?void 0:a.fromInstallerId,storeLocation:o,material:r})),re((0,p.J9T)({project:null===a||void 0===a?void 0:a.projectId,store:null===a||void 0===a?void 0:a.contractorStoreId,installer:null===a||void 0===a?void 0:a.fromInstallerId,storeLocation:o,material:r}))),ve("quantity",null),k(null),ve("qtyStk",null),$(t)}}),!!u)}),(0,E.jsx)(i.Ay,{item:!0,xs:12,sm:4,children:pe("code","Code","text",!0,void 0,!0)}),(0,E.jsx)(i.Ay,{item:!0,xs:12,sm:4,children:je("fromStoreLocationId","From Store Location",z,!0,void 0,!0)}),(0,E.jsx)(i.Ay,{item:!0,xs:12,sm:2,children:pe("quantity","Quantity",(0,C.VF)(fe)?"text":"number",!0,(e=>{var t,o;(0,C.VF)(fe)?ee(!1):ee(!0),b(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value),ve("value",((null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value)*M).toFixed(2))}))}),(0,E.jsx)(i.Ay,{item:!0,xs:12,sm:2,children:pe("qtyStk","Qty In Stock","number",!1,void 0,!0)}),(0,E.jsx)(i.Ay,{item:!0,xs:12,sm:2,children:pe("uom","UOM","text",!0,void 0,!0)}),(0,E.jsx)(i.Ay,{item:!0,xs:12,sm:2,style:{display:"none"},children:pe("uomId","UOMId","text",!0)}),(0,E.jsx)(i.Ay,{item:!0,xs:12,sm:2,...v&&{display:"none"},children:pe("rate","Rate","text",!0,(e=>{var t;N(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value)}),!0)}),(0,E.jsx)(i.Ay,{item:!0,xs:12,sm:2,...v&&{display:"none"},children:pe("tax","Tax%","text",!0,void 0,!0)}),(0,E.jsx)(i.Ay,{item:!0,xs:12,sm:2,...v&&{display:"none"},children:pe("value","Value","number",!0,void 0,!0)}),(0,E.jsxs)(i.Ay,{item:!0,xs:12,sm:2,sx:{textAlign:"center"},children:[((null===V||void 0===V?void 0:V.isSerialNumber)||u&&(null===c||void 0===c?void 0:c.isSerialNumber))&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(x.A,{mb:-1,children:"SerialNumber"})," ",(0,E.jsx)("br",{})," ",(0,E.jsx)(s.A,{size:"small",onClick:()=>{Ae(Ee[(null===V||void 0===V?void 0:V.id)||(null===c||void 0===c?void 0:c.materialId)]),Te(!0)},variant:"contained",color:"primary",children:"View"})]}),B&&""!==B&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("br",{}),(0,E.jsx)(x.A,{color:"error",sx:{fontSize:12,marginTop:2},children:B})]})]}),(0,E.jsx)(i.Ay,{item:!0,xs:12,sm:2,mt:4,textAlign:"right",children:!d&&(0,E.jsx)(s.A,{size:"small",onClick:ce((e=>{V&&null!==V&&void 0!==V&&V.isSerialNumber&&0===he.length?R("Serial Number is required"):V&&null!==V&&void 0!==V&&V.isSerialNumber&&he.length!==e.quantity?R(`Please select a total of ${e.quantity} serial numbers`):(R(!1),he&&(e.material_serial_numbers=he),e.tax=0===e.tax?"0":e.tax,e.fromStoreLocationName=U,o(e,null===V||void 0===V?void 0:V.id,(null===V||void 0===V?void 0:V.id)+Q),ye([]),Ae([]),$(null),J([]),ve("qtyStk",null),k(null),X(!1),me())})),variant:"contained",color:"primary",children:Z?"Update":"Add"})})]}),(0,E.jsx)(_.A,{open:Le,onClose:Me,"aria-labelledby":"modal-modal-title",children:(0,E.jsx)(D.default,{handleCloseSerial:Me,closeCss:H,quantity:y,setSerialNumbers:we})}),Oe&&(0,E.jsx)(F.default,{open:Oe,onClose:()=>{Te(!1)},maxQuantity:y,serialNumberData:be,showCheckboxes:!0,onSave:e=>{we(e)},selectedSerials:he})]})})})};var $=o(71826),B=o(52351),R=o(68388),U=o(99635);const G=e=>{let{values:t,onEdit:o,onDelete:r,onView:l}=e;return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(a.A,{title:"Edit",placement:"bottom",children:(0,E.jsx)(n.A,{color:"secondary",onClick:()=>o(t),children:(0,E.jsx)(d.A,{})})}),(0,E.jsx)(a.A,{title:"Delete",placement:"bottom",children:(0,E.jsx)(n.A,{color:"secondary",onClick:()=>r(t),children:(0,E.jsx)(u.A,{})})}),(null===t||void 0===t?void 0:t.isSerialNumber)&&(0,E.jsx)(a.A,{title:"View Serial Number",placement:"bottom",children:(0,E.jsx)(n.A,{color:"secondary",onClick:()=>l(t),children:(0,E.jsx)(v.A,{})})})]})},Q=[{Header:"Actions",accessor:"actions"},{Header:"Name",accessor:"name"},{Header:"Code",accessor:"code"},{Header:"Quantity",accessor:"quantity"},{Header:"UOM",accessor:"uom"},{Header:"From Store Location",accessor:"fromStoreLocationName"}],W=()=>{const[e,t]=(0,r.useState)(null),[o,a]=(0,r.useState)([]),[n,d]=(0,r.useState)([]),[u,v]=(0,r.useState)(null),[I,f]=(0,r.useState)([]),[S,x]=(0,r.useState)(!1),[g,j]=(0,r.useState)(!1),[h,y]=(0,r.useState)({}),[b,A]=(0,r.useState)({}),[L,k]=(0,r.useState)(!1),[O,T]=(0,r.useState)(null),[w,M]=(0,r.useState)(!1),[z,_]=(0,r.useState)(null),D=(0,l.wA)(),P=(0,c.Zp)(),H=()=>{a([]),y({}),x(!1),A({}),v(null),t(null)},W=(0,r.useCallback)((t=>{x(!0),A({...t,StoreLocationId:null===e||void 0===e?void 0:e.contractorStoreLocationId})}),[e]),Y=e=>{_(e),M(!0),null!==e&&void 0!==e&&e.material_serial_numbers||T([])};(0,r.useEffect)((()=>{null!==z&&void 0!==z&&z.material_serial_numbers&&T(null===z||void 0===z?void 0:z.material_serial_numbers)}),[z]);const{transactionMaterialList:J,serialNumbers:Z}=(0,m.t)(),{materials:X}=(0,r.useMemo)((()=>{var e;return{materials:(null===J||void 0===J?void 0:J.stocksObject)||[],count:(null===J||void 0===J||null===(e=J.stocksObject)||void 0===e?void 0:e.count)||0}}),[J]),{serialNumbersData:K}=(0,r.useMemo)((()=>{var e;return{serialNumbersData:(null===Z||void 0===Z?void 0:Z.data)||[],countSN:(null===Z||void 0===Z||null===(e=Z.data)||void 0===e?void 0:e.count)||0}}),[Z]);(0,r.useEffect)((()=>{if(L&&X){const e=(e=>{const t=[];return e&&e.length>0&&e.map((e=>{t.push({id:e.id,name:e.name,isSerialNumber:e.is_serial_number,tax:e.tax>0?e.tax:"0",value:e.value,uomName:e.uom_name,uomId:e.uom_id,rate:parseFloat(e.rate).toFixed(2),code:e.code,hsnCode:e.hsn_code,material_serial_numbers:K[e.id]?K[e.id]:[]})})),t})(X);d(e.filter((e=>"84b473e1-62bb-4afe-af56-1691bdffbc55"!==e.id)))}}),[X,K,L]);(0,r.useEffect)((()=>{e&&D((0,p.UjX)({project:e.projectId,store:e.contractorStoreId}))}),[D,e]);const ee=(0,R.A)({dataObject:J,key:"stocksObject",resetTrigger:null===e});return(0,r.useEffect)((()=>{Array.isArray(ee)&&0===ee.length&&(H(),(0,N.A)("There are no available materials for your selected combination",{variant:"error"}))}),[ee]),(0,E.jsxs)(E.Fragment,{children:[g&&(0,E.jsx)(B.A,{}),(0,E.jsx)(q,{disableAll:!!e,saveData:e=>{e&&e.projectId&&e.contractorStoreId&&(t(e),k(!0),D((0,p.UjX)({project:e.projectId,store:e.contractorStoreId})))}}),e&&(0,E.jsx)(V,{materials:n,onMaterailsInput:(e,t,r)=>{((e,t)=>{t&&(n.map((r=>{let l={};if(r.id===e.materialId){l={...structuredClone(r),...e},l.uomId=null===r||void 0===r?void 0:r.uomId;let n=I;n.push(l.fromStoreLocationId),f(n);const i=o.findIndex((o=>o.id===t&&(null===e||void 0===e?void 0:e.fromStoreLocationId)===(null===o||void 0===o?void 0:o.fromStoreLocationId)));if(i>=0){const e=structuredClone(o);e[i]=l,a(e)}else a(o.concat(l))}})),x(!1))})(e,t);const l=h;l[r]||(l[r]={}),l[r]=e,y(l)},hideTaxDetails:!0,formData:e,update:S,showData:b,selectedLocations:I,selectedItems:h}),e&&Array.isArray(o)&&o.length>0&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(U.default,{title:"Material Transfer Contractor To Store",hideHeader:!0,hidePagination:!0,data:(te=o,te&&te.length>0&&te.map(((e,t)=>({...e,actions:(0,E.jsx)(G,{values:e,onEdit:W,onDelete:e=>{((e,t)=>{if(o){const r=o.filter(((t,o)=>o!==e));let l=[];r.map((e=>l.push(e.fromStoreLocationId))),a(r),f(l),delete h[t.materialId+t.fromStoreLocationId]}})(t,e)},onView:Y})})))),count:o.length,columns:Q,hideActions:!0}),w&&z&&O&&(0,E.jsx)(F.default,{open:w,onClose:()=>{M(!1)},serialNumberData:O})]}),e&&(0,E.jsx)(i.Ay,{container:!0,spacing:4,children:(0,E.jsxs)(i.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px",mt:2},children:[(0,E.jsx)(s.A,{onClick:H,size:"small",variant:"outlined",color:"primary",children:"Back"}),(0,E.jsx)(s.A,{disabled:S||!!u||g,onClick:async()=>{var t,r,l,a;j(!0);const{fromInstallerId:n,toInstallerId:i}=e,s=(()=>{const{projectId:t,contractorId:r,contractorStoreId:l,toInstallerStoreLocationId:a,receivingStore:n}=e,i=[];return null===o||void 0===o||o.filter((e=>parseFloat(e.quantity)>0)).map((o=>{const{fromStoreLocationId:s,materialId:d,uomId:u,quantity:c,rate:v,value:m,tax:I}=o;i.push({transactionTypeId:"5b4e46d5-7bf5-4f42-8c4a-b6337533fdff",organizationId:r,projectId:t,fromStoreLocationId:s,storeId:l,storeLocationId:a,receivingStoreLocationId:n,materialId:d,uomId:u,quantity:c,rate:v,value:m,tax:I,remarks:e.remarks,serialNumber:o.material_serial_numbers})})),i})();if(null===s||void 0===s||!s.length)return(0,N.A)("Please have atleast one material with some quantity",{variant:"error"}),void j(!1);const d={transactionTypeId:"799ee00c-0819-498a-9e47-3ac269f33db8",fromInstallerId:n,toInstallerId:i,stock_ledgers:s};if((0,C.Rh)(d.stock_ledgers,"fromStoreLocationId"))return void j(!1);const u=await(0,$.default)("/iti-transaction-create",{method:"POST",body:d,timeoutOverride:12e4});var c;if(!u.success)return(0,N.A)((null===u||void 0===u||null===(c=u.error)||void 0===c?void 0:c.message)||"Operation failed. Please try again!",{variant:"error"}),void j(!1);const v=null!==(t=null===(r=u.data)||void 0===r?void 0:r.data)&&void 0!==t?t:{},m=v.referenceDocumentNumber||(null===(l=v[0])||void 0===l?void 0:l.referenceDocumentNumber),I=null===u||void 0===u||null===(a=u.data)||void 0===a?void 0:a.referenceDocNo;(0,N.A)(m?`Transaction created with reference number: ${m}`:I&&`Transaction created with reference numbers ${I.ITC} and ${I.CTI}`||"Transaction created successfully!",{variant:"success",autoHideDuration:1e4}),j(!1),P("/stock-ledger")},size:"small",variant:"contained",color:"primary",children:"Submit"})]})})]});var te}},88848:(e,t,o)=>{o.d(t,{$:()=>a});var r=o(9950),l=o(27081);const a=()=>{const[e,t]=(0,r.useState)({masterMakerLovsObject:{},error:"",loading:!0}),[o,a]=(0,r.useState)({masterMakerLovsObject:{},error:"",loading:!0}),[n,i]=(0,r.useState)({masterObject:[],error:"",loading:!0}),[s,d]=(0,r.useState)({masterObject:[],error:"",loading:!0}),[u,c]=(0,r.useState)({masterObject:[],error:"",loading:!0}),[v,m]=(0,r.useState)({currencyObject:[],error:"",loading:!0}),[I,f]=(0,r.useState)({gstStatusObject:[],error:"",loading:!0}),[S,x]=(0,r.useState)({paymentTermObject:[],error:"",loading:!0}),[g,j]=(0,r.useState)({incotermsObject:[],error:"",loading:!0}),[p,h]=(0,r.useState)({titleObject:[],error:"",loading:!0}),[y,b]=(0,r.useState)({masterMakerLovHistoryObject:{},error:"",loading:!0}),A=(0,l.d4)((e=>e.masterMakerLov||{})),L=(0,l.d4)((e=>e.masterMakerLovList||{})),k=(0,l.d4)((e=>e.lovsForMasterName||[])),O=(0,l.d4)((e=>e.lovsForMasterNameSecond||[])),T=(0,l.d4)((e=>e.lovsForMasterNameThird||[])),w=(0,l.d4)((e=>e.currency||[])),M=(0,l.d4)((e=>e.gstStatus||[])),C=(0,l.d4)((e=>e.paymentTerm||[])),N=(0,l.d4)((e=>e.incoterms||[])),z=(0,l.d4)((e=>e.title||[])),E=(0,l.d4)((e=>e.masterMakerLovHistory||{}));return(0,r.useEffect)((()=>{t((e=>({...e,...A})))}),[A]),(0,r.useEffect)((()=>{a((e=>({...e,...L})))}),[L]),(0,r.useEffect)((()=>{i((e=>({...e,...k})))}),[k]),(0,r.useEffect)((()=>{d((e=>({...e,...O})))}),[O]),(0,r.useEffect)((()=>{c((e=>({...e,...T})))}),[T]),(0,r.useEffect)((()=>{m((e=>({...e,...w})))}),[w]),(0,r.useEffect)((()=>{f((e=>({...e,...M})))}),[M]),(0,r.useEffect)((()=>{x((e=>({...e,...C})))}),[C]),(0,r.useEffect)((()=>{j((e=>({...e,...N})))}),[N]),(0,r.useEffect)((()=>{h((e=>({...e,...z})))}),[z]),(0,r.useEffect)((()=>{b((e=>({...e,...E})))}),[E]),{masterMakerLovs:e,masterMakerLovsList:o,masterMakerOrgType:n,masterMakerOrgTypeSecond:s,masterMakerOrgTypeThird:u,masterMakerCurrency:v,masterMakerGstStatus:I,masterMakerIncoterms:g,masterMakerPaymentTerm:S,masterMakerLovHistory:y,masterMakerTitle:p}}},79033:(e,t,o)=>{o.d(t,{z:()=>a});var r=o(9950),l=o(27081);const a=()=>{const[e,t]=(0,r.useState)({rolesObject:{},error:"",loading:!0}),[o,a]=(0,r.useState)({roleProjectsObject:[],error:"",loading:!0}),[n,i]=(0,r.useState)({rolesHistoryObject:{},error:"",loading:!0}),s=(0,l.d4)((e=>e.roles||{})),d=(0,l.d4)((e=>e.roleProjects||[])),u=(0,l.d4)((e=>e.rolesHistory||{}));return(0,r.useEffect)((()=>{t((e=>({...e,...s})))}),[s]),(0,r.useEffect)((()=>{a((e=>({...e,...d})))}),[d]),(0,r.useEffect)((()=>{i((e=>({...e,...u})))}),[u]),{roles:e,roleProjects:o,rolesHistory:n}}},66004:(e,t,o)=>{o.d(t,{k:()=>l});var r=o(27081);const l=()=>({users:(0,r.d4)((e=>e.users)),usersByPermission:(0,r.d4)((e=>e.usersByPermission)),usersWithForms:(0,r.d4)((e=>e.usersWithForms)),usersSecond:(0,r.d4)((e=>e.usersSecond)),usersHistory:(0,r.d4)((e=>e.usersHistory)),supervisorUsers:(0,r.d4)((e=>e.supervisorUsers))})},62375:(e,t,o)=>{var r=o(24994);t.A=void 0;var l=r(o(79526)),a=o(44414);t.A=(0,l.default)((0,a.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")}}]);