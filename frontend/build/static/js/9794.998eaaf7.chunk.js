"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[9794],{7413:(e,t,o)=>{o.r(t),o.d(t,{default:()=>b});var a=o(9950),r=o(27081),i=o(4139),n=o(67535),d=o(60666),l=o(9449),s=o(26473),u=o(28429),c=o(29024),m=o(80415),v=o(88848),I=o(96951),h=o(14351),f=o(99635),p=o(71826),g=o(62054),S=o(47501),y=o(52351),x=o(44414);const b=()=>{var e,t,o,b;const[j,C]=(0,a.useState)([]),[A,T]=(0,a.useState)(!1),[q,k]=(0,a.useState)(m.j7.pageIndex),[L,N]=(0,a.useState)(m.j7.pageSize),[_,z]=(0,a.useState)(),[E,O]=(0,a.useState)(),[M,w]=(0,a.useState)(!1),[D,P]=(0,a.useState)(null),H=(0,u.Zp)(),F=(0,l.mN)({resolver:(0,s.t)(d.Ik().shape({})),defaultValues:{},mode:"all"}),R=(0,r.wA)();(0,a.useEffect)((()=>{R((0,c._G1)()),R((0,c.uiG)())}),[R]);const{masterMakerLovs:U}=(0,v.$)(),V=(e,t)=>{const o=e&&e.filter((e=>e.name===t));return o&&o.length?o[0].id:void 0},$=U.masterMakerLovsObject.rows,G=V($,"CANCELSTC"),Q=V($,"CUSTOMER"),Y=V($,"CUSTOMER"),B=V($,"COMPANY");(0,a.useEffect)((()=>{B&&R((0,c.qV$)({organizationType:B}))}),[R,B]),(0,a.useEffect)((()=>{Q&&R((0,c.d8s)(Q))}),[R,Q]),(0,a.useEffect)((()=>{Y&&R((0,c.QEJ)({organizationType:Y}))}),[R,Y]);const{handleSubmit:J,setValue:Z}=F,K=null===j||void 0===j||null===(e=j[0])||void 0===e||null===(t=e.organization)||void 0===t?void 0:t.name,W=null===j||void 0===j||null===(o=j[0])||void 0===o||null===(b=o.organization_store)||void 0===b?void 0:b.name;(0,a.useEffect)((()=>{null!==W&&void 0!==W&&W.length&&Z("fromStore",W)}),[W,Z]),(0,a.useEffect)((()=>{null!==K&&void 0!==K&&K.length&&Z("customerId",K)}),[K,Z]),(0,a.useEffect)((()=>{var e;j&&(e=j,Object.entries(e).forEach((e=>{let[t,o]=e;Z(t,o)})))}),[j,Z]);const X=(0,a.useMemo)((()=>[{Header:"Name",accessor:"material.name"},{Header:"Code",accessor:"material.code"},{Header:"Quantity",accessor:"quantity"},{Header:"UOM",accessor:"uom.name"}]),[]),ee=e=>{if(e&&e.length>0){return e.map((e=>e.serialNumber))}return[]},te=e=>{let t=[];return e&&e.length>0&&e.map((e=>t.push(e.id))),t};return(0,a.useEffect)((()=>{null!==_&&void 0!==_&&_.length&&(C(_.filter((e=>e.quantity>0&&e.otherStoreId===D))),O(_.filter((e=>e.quantity<0&&e.storeId===D)).map((e=>({...e,quantity:Math.abs(e.quantity)})))))}),[_,D]),(0,x.jsxs)(x.Fragment,{children:[M&&(0,x.jsx)(y.A,{}),(0,x.jsx)(I.Op,{methods:F,onSubmit:J((async e=>{var t,o,a;w(!0);const r=(()=>{var e,t,o;const a=[],r=[];return E.map((e=>{a.push({transactionTypeId:G,requestNumber:null===e||void 0===e?void 0:e.referenceDocumentNumber,projectId:e.projectId,organizationId:null===e||void 0===e?void 0:e.organizationId,storeId:null===e||void 0===e?void 0:e.storeId,storeLocationId:null===e||void 0===e?void 0:e.storeLocationId,otherStoreId:null===e||void 0===e?void 0:e.otherStoreId,otherStoreLocationId:null===e||void 0===e?void 0:e.otherStoreLocationId,materialId:e.materialId,uomId:e.uomId,quantity:Math.abs(e.quantity),rate:e.rate,value:e.value,tax:e.tax,serialNumber:ee(e.material_serial_numbers)})})),j.map((e=>{r.push({transactionTypeId:G,requestNumber:null===e||void 0===e?void 0:e.referenceDocumentNumber,projectId:null===e||void 0===e?void 0:e.projectId,organizationId:null===e||void 0===e?void 0:e.organizationId,storeId:null===e||void 0===e?void 0:e.storeId,storeLocationId:null===e||void 0===e?void 0:e.storeLocationId,otherStoreId:null===e||void 0===e?void 0:e.otherStoreId,otherStoreLocationId:null===e||void 0===e?void 0:e.otherStoreLocationId,materialId:e.materialId,uomId:e.uomId,quantity:e.quantity>0?-e.quantity:e.quantity,rate:e.rate,value:e.value,tax:e.tax,serialNumber:ee(e.material_serial_numbers)})})),{transactionTypeId:G,transactionCreatedAt:null===(e=j[0])||void 0===e?void 0:e.createdAt,stcIds:te(_),stcLedgerDetailId:null===j||void 0===j||null===(t=j[0])||void 0===t||null===(o=t.stock_ledger_detail)||void 0===o?void 0:o.id,credit_stock_ledgers:a,debit_stock_ledgers:r}})(),i=await(0,p.default)("/cancel-utility",{method:"POST",body:r,timeoutOverride:12e4});var n;if(!i.success)return(0,g.A)((null===i||void 0===i||null===(n=i.error)||void 0===n?void 0:n.message)||"Operation failed. Please try again!",{variant:"error"}),void w(!1);const d=null!==(t=null===(o=i.data)||void 0===o?void 0:o.data)&&void 0!==t?t:{},l=d.referenceDocumentNumber||(null===(a=d[0])||void 0===a?void 0:a.referenceDocumentNumber);(0,g.A)(l?`Transaction cancelled with reference number: ${l}`:"Transaction cancelled successfully!",{variant:"success",autoHideDuration:1e4}),w(!1),H("/stock-ledger")})),children:(0,x.jsxs)(h.A,{title:"Cancel STC(Store to Customer)",sx:{mb:2},children:[(0,x.jsx)(S.A,{type:"stockLedger",transactionType:"STC",fromStoreLabel:"Company Store",fromStoreType:"COMPANY",showFromStoreAddress:!0,ignoreStoreId:!0,disableAll:!(null===_||void 0===_||!_.length),setReqData:z,setFromStoreId:P}),_&&_.length>0&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(i.Ay,{container:!0,spacing:4,alignItems:"center",sx:{mb:2,mt:1},children:[(0,x.jsx)(i.Ay,{item:!0,md:3,xl:2,children:(0,x.jsx)(I.o3,{name:"customerId",label:"Customer",disabled:!0})}),(0,x.jsx)(i.Ay,{item:!0,md:3,xl:2,children:(0,x.jsx)(I.o3,{name:"fromStore",label:"Customer Site Store",disabled:!0})})]}),(0,x.jsx)(f.default,{title:"Cancel STC",hideHeader:!0,hidePagination:!0,data:j,count:j.length,columns:X,hideActions:!0,setPageIndex:k,setPageSize:N,pageIndex:q,pageSize:L}),(0,x.jsx)(i.Ay,{item:!0,md:12,xl:2,sx:{mt:4},children:(0,x.jsxs)(i.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px"},children:[(0,x.jsx)(n.A,{onClick:()=>{T(!A),C([]),O([]),z(void 0),H("/cancel-utility")},size:"small",variant:"outlined",color:"primary",children:"Back"}),(0,x.jsx)(n.A,{disabled:M,size:"small",type:"submit",variant:"contained",color:"primary",children:"Reverse"})]})})]})]})})]})}}}]);