"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[3426],{513:(e,s,a)=>{a.d(s,{A:()=>d,y:()=>l});var t=a(9950),i=a(52351),r=a(44414);const o=(0,t.lazy)((()=>a.e(2480).then(a.bind(a,42480)))),n=(0,t.lazy)((()=>Promise.all([a.e(2509),a.e(2564),a.e(6424),a.e(6457),a.e(6643),a.e(839),a.e(5796)]).then(a.bind(a,95796)))),l=(e,s)=>{const a=structuredClone(e);return Object.entries(a).map((e=>{let[t,i]=e;if(!i)return[t,i];t.includes("-paths")&&(a[t]=void 0,a[t.replace("-paths","")]=[...i,...s.filter((e=>e.key===t)).map((e=>({action:e.action,filePath:e.filePath,fileName:e.fileName,fileData:e.fileData})))])})),a},d=e=>{let{view:s,update:a,setValue:l,tasks:d,setTasks:c,data:u,fileFields:m,disabled:v}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.Suspense,{fallback:(0,r.jsx)(r.Fragment,{}),children:!(s||a)&&m.map((e=>(0,r.jsx)(o,{disabled:v,multiple:e.multiple,accept:e.accept,label:e.label,name:e.name,setValue:l},e.name)))}),(0,r.jsx)(t.Suspense,{fallback:i.A,children:(s||a)&&(0,r.jsx)(n,{fileFields:m,setValue:l,tasks:d,setTasks:c,data:u,update:a,view:s})})]})}},39225:(e,s,a)=>{a.d(s,{A:()=>o});var t=a(41397),i=a.n(t),r=a(9950);const o=e=>{const{isFcMode:s}=e||{},[a,t]=(0,r.useState)(void 0),[o,n]=(0,r.useState)(!1),l=(0,r.useRef)([]),d=(0,r.useCallback)((e=>{const t=l.current;l.current=e,a&&(s||i().isEqual(e,t)||n((e=>!e)))}),[s,a]),c=(0,r.useMemo)((()=>null===a||void 0===a?void 0:a.trim()),[a]);return{searchString:a,searchStringTrimmed:c,forceSearch:o,accessorsRef:l,setSearchString:t,setAccessors:d}}},88848:(e,s,a)=>{a.d(s,{$:()=>r});var t=a(9950),i=a(27081);const r=()=>{const[e,s]=(0,t.useState)({masterMakerLovsObject:{},error:"",loading:!0}),[a,r]=(0,t.useState)({masterMakerLovsObject:{},error:"",loading:!0}),[o,n]=(0,t.useState)({masterObject:[],error:"",loading:!0}),[l,d]=(0,t.useState)({masterObject:[],error:"",loading:!0}),[c,u]=(0,t.useState)({masterObject:[],error:"",loading:!0}),[m,v]=(0,t.useState)({currencyObject:[],error:"",loading:!0}),[p,g]=(0,t.useState)({gstStatusObject:[],error:"",loading:!0}),[h,y]=(0,t.useState)({paymentTermObject:[],error:"",loading:!0}),[j,f]=(0,t.useState)({incotermsObject:[],error:"",loading:!0}),[b,x]=(0,t.useState)({titleObject:[],error:"",loading:!0}),[k,A]=(0,t.useState)({masterMakerLovHistoryObject:{},error:"",loading:!0}),S=(0,i.d4)((e=>e.masterMakerLov||{})),I=(0,i.d4)((e=>e.masterMakerLovList||{})),w=(0,i.d4)((e=>e.lovsForMasterName||[])),T=(0,i.d4)((e=>e.lovsForMasterNameSecond||[])),z=(0,i.d4)((e=>e.lovsForMasterNameThird||[])),O=(0,i.d4)((e=>e.currency||[])),C=(0,i.d4)((e=>e.gstStatus||[])),L=(0,i.d4)((e=>e.paymentTerm||[])),M=(0,i.d4)((e=>e.incoterms||[])),E=(0,i.d4)((e=>e.title||[])),H=(0,i.d4)((e=>e.masterMakerLovHistory||{}));return(0,t.useEffect)((()=>{s((e=>({...e,...S})))}),[S]),(0,t.useEffect)((()=>{r((e=>({...e,...I})))}),[I]),(0,t.useEffect)((()=>{n((e=>({...e,...w})))}),[w]),(0,t.useEffect)((()=>{d((e=>({...e,...T})))}),[T]),(0,t.useEffect)((()=>{u((e=>({...e,...z})))}),[z]),(0,t.useEffect)((()=>{v((e=>({...e,...O})))}),[O]),(0,t.useEffect)((()=>{g((e=>({...e,...C})))}),[C]),(0,t.useEffect)((()=>{y((e=>({...e,...L})))}),[L]),(0,t.useEffect)((()=>{f((e=>({...e,...M})))}),[M]),(0,t.useEffect)((()=>{x((e=>({...e,...E})))}),[E]),(0,t.useEffect)((()=>{A((e=>({...e,...H})))}),[H]),{masterMakerLovs:e,masterMakerLovsList:a,masterMakerOrgType:o,masterMakerOrgTypeSecond:l,masterMakerOrgTypeThird:c,masterMakerCurrency:m,masterMakerGstStatus:p,masterMakerIncoterms:j,masterMakerPaymentTerm:h,masterMakerLovHistory:k,masterMakerTitle:b}}},55519:(e,s,a)=>{a.d(s,{G:()=>r});var t=a(9950),i=a(27081);const r=()=>{const[e,s]=(0,t.useState)({organizationObject:{},error:"",loading:!0}),[a,r]=(0,t.useState)({organizationObject:{},error:"",loading:!0}),[o,n]=(0,t.useState)({organizationObject:{},error:"",loading:!0}),[l,d]=(0,t.useState)({organizationObject:{},error:"",loading:!0}),[c,u]=(0,t.useState)({organizationObject:{},error:"",loading:!0}),[m,v]=(0,t.useState)({organizationLocationObject:{},error:"",loading:!0}),[p,g]=(0,t.useState)({organizationGetListObject:{},error:"",loading:!0}),[h,y]=(0,t.useState)({organizationDropdownObject:[],error:"",loading:!0}),[j,f]=(0,t.useState)({organizationLocationDropdownObject:[],error:"",loading:!0}),[b,x]=(0,t.useState)({organizationDropdownSecondObject:[],error:"",loading:!0}),[k,A]=(0,t.useState)({organizationLocationDropdownObject:[],error:"",loading:!0}),[S,I]=(0,t.useState)({organizationObject:{},error:"",loading:!0}),[w,T]=(0,t.useState)({organizationObject:{},error:"",loading:!0}),[z,O]=(0,t.useState)({organizationHistoryObject:{},error:"",loading:!0}),C=(0,i.d4)((e=>e.organization||[])),L=(0,i.d4)((e=>e.organizationAllData||[])),M=(0,i.d4)((e=>e.organizationAllDataSecond||[])),E=(0,i.d4)((e=>e.organizationLocationByParent||[])),H=(0,i.d4)((e=>e.organizationLocationByParentSecond||[])),V=(0,i.d4)((e=>e.organizationLocation||[])),D=(0,i.d4)((e=>e.organizationListData||[])),F=(0,i.d4)((e=>e.organizationList||[])),P=(0,i.d4)((e=>e.organizationDropdown||[])),N=(0,i.d4)((e=>e.organizationLocationDropdown||[])),B=(0,i.d4)((e=>e.organizationLocationDropdownSecond||[])),R=(0,i.d4)((e=>e.organizationDropdownSecond||[])),q=(0,i.d4)((e=>e.organizationListSecond||[])),$=(0,i.d4)((e=>e.organizationHistory||[]));return(0,t.useEffect)((()=>{s((e=>({...e,...C})))}),[C]),(0,t.useEffect)((()=>{r((e=>({...e,...L})))}),[L]),(0,t.useEffect)((()=>{n((e=>({...e,...M})))}),[M]),(0,t.useEffect)((()=>{d((e=>({...e,...E})))}),[E]),(0,t.useEffect)((()=>{u((e=>({...e,...H})))}),[H]),(0,t.useEffect)((()=>{v((e=>({...e,...V})))}),[V]),(0,t.useEffect)((()=>{g((e=>({...e,...D})))}),[D]),(0,t.useEffect)((()=>{y((e=>({...e,...P})))}),[P]),(0,t.useEffect)((()=>{f((e=>({...e,...N})))}),[N]),(0,t.useEffect)((()=>{A((e=>({...e,...B})))}),[B]),(0,t.useEffect)((()=>{x((e=>({...e,...R})))}),[R]),(0,t.useEffect)((()=>{I((e=>({...e,...F})))}),[F]),(0,t.useEffect)((()=>{T((e=>({...e,...q})))}),[q]),(0,t.useEffect)((()=>{O((e=>({...e,...$})))}),[$]),{organizations:e,organizationsAllData:a,organizationsAllDataSecond:o,organizationsLocByParent:l,organizationsLocByParentSecond:c,organizationsGetListData:p,organizationsDropdown:h,organizationsDropdownSecond:b,organizationsList:S,organizationsListSecond:w,organizationHistory:z,organizationsLocation:m,organizationsLocationDropdown:j,organizationsLocationDropdownSecond:k}}},60209:(e,s,a)=>{a.d(s,{k:()=>r});var t=a(9950),i=a(27081);const r=()=>{const[e,s]=(0,t.useState)({projectMasterMakerLovsObject:{},error:"",loading:!0}),[a,r]=(0,t.useState)({projectMasterMakersListObject:[],error:"",loading:!0}),[o,n]=(0,t.useState)({projectMasterMakerLovHistoryObject:{},error:"",loading:!0}),l=(0,i.d4)((e=>e.projectMasterMakerLov||{})),d=(0,i.d4)((e=>e.masterMakersLovsList||{})),c=(0,i.d4)((e=>e.projectMasterMakerLovHistory||{}));return(0,t.useEffect)((()=>{s((e=>({...e,...l})))}),[l]),(0,t.useEffect)((()=>{r((e=>({...e,...d})))}),[d]),(0,t.useEffect)((()=>{n((e=>({...e,...c})))}),[c]),{projectMasterMakerLovs:e,masterMakersLovsList:a,projectMasterMakerLovHistory:o}}},79033:(e,s,a)=>{a.d(s,{z:()=>r});var t=a(9950),i=a(27081);const r=()=>{const[e,s]=(0,t.useState)({rolesObject:{},error:"",loading:!0}),[a,r]=(0,t.useState)({roleProjectsObject:[],error:"",loading:!0}),[o,n]=(0,t.useState)({rolesHistoryObject:{},error:"",loading:!0}),l=(0,i.d4)((e=>e.roles||{})),d=(0,i.d4)((e=>e.roleProjects||[])),c=(0,i.d4)((e=>e.rolesHistory||{}));return(0,t.useEffect)((()=>{s((e=>({...e,...l})))}),[l]),(0,t.useEffect)((()=>{r((e=>({...e,...d})))}),[d]),(0,t.useEffect)((()=>{n((e=>({...e,...c})))}),[c]),{roles:e,roleProjects:a,rolesHistory:o}}},66004:(e,s,a)=>{a.d(s,{k:()=>i});var t=a(27081);const i=()=>({users:(0,t.d4)((e=>e.users)),usersByPermission:(0,t.d4)((e=>e.usersByPermission)),usersWithForms:(0,t.d4)((e=>e.usersWithForms)),usersSecond:(0,t.d4)((e=>e.usersSecond)),usersHistory:(0,t.d4)((e=>e.usersHistory)),supervisorUsers:(0,t.d4)((e=>e.supervisorUsers))})},2606:(e,s,a)=>{a.d(s,{A:()=>y});var t=a(9950),i=a(75989),r=a(79843),o=a(4139),n=a(40821),l=a(12257),d=a(87233),c=a(96395),u=a(39854),m=a(26592),v=a(14351),p=a(86263),g=a(64499),h=a(44414);const y=e=>{let{imageList:s,blockMode:a=!1,base64Image:y=!1,setValue:j,preview:f,type:b,mode:x}=e;const[k,A]=(0,t.useState)();(0,t.useEffect)((()=>{A(0)}),[s]);const[S,I]=(0,t.useState)(!1),[w,T]=(0,t.useState)(null);return(null===s||void 0===s?void 0:s.length)>0?(0,h.jsxs)(o.Ay,{container:!0,children:[(0,h.jsx)(o.Ay,{item:!0,md:12,children:(0,h.jsxs)(v.A,{content:!1,boxShadow:!1,sx:{m:"0 auto",height:"100%",display:"flex",border:"none",alignItems:"center",justifyContent:"center"},children:[(0,h.jsx)(c.GT,{ref:T,children:(0,h.jsx)(c.WZ,{children:(0,h.jsx)(n.A,{component:"img",image:y?"object"===typeof s[k]?URL.createObjectURL(s[k]):s[k]:"object"===typeof s[k]?URL.createObjectURL(s[k]):window.location.origin+s[k],sx:{height:a?"72vh":"90vh",objectFit:"contain"}})})}),(0,h.jsxs)(l.A,{direction:"row",className:"tools",sx:{position:"absolute",bottom:5,zIndex:1,backgroundColor:"white"},children:[s.length>1&&(0,h.jsx)(p.A,{title:"Prev",color:"secondary",disabled:0===k,onClick:()=>{k>0&&(A(k-1),w&&w.resetTransform())},children:(0,h.jsx)(i.A,{})}),s.length>1&&(0,h.jsx)(p.A,{title:"Next",color:"secondary",disabled:k>=(null===s||void 0===s?void 0:s.length)-1,onClick:()=>{k<(null===s||void 0===s?void 0:s.length)-1&&(A(k+1),w&&w.resetTransform())},children:(0,h.jsx)(r.A,{})}),(0,h.jsx)(p.A,{title:"Reset",color:"secondary",onClick:()=>{w&&w.resetTransform()},children:(0,h.jsx)(u.A,{})})]}),a&&"view"!==x&&f.update&&"blob"!==b&&(0,h.jsx)(l.A,{direction:"row",className:"tools",sx:{position:"absolute",top:5,right:5,zIndex:1,backgroundColor:"white"},children:(0,h.jsx)(p.A,{title:"Delete",color:"secondary",onClick:()=>I(!0),children:(0,h.jsx)(m.A,{})})})]})}),(0,h.jsx)(g.A,{open:S,handleClose:()=>I(!1),handleConfirm:()=>{j(f.columnName,"blob"===b?"":null===s||void 0===s?void 0:s.filter(((e,s)=>s!==k))),A(0),I(!1)},title:"Delete Field",message:"Are you sure you want to delete?",confirmBtnTitle:"Delete"})]}):(0,h.jsx)(d.A,{children:"Image Preview"})}},82526:(e,s,a)=>{a.d(s,{WL:()=>t,a0:()=>i,yV:()=>r});const t=[{Header:"Ticket Number",accessor:"updatedTicketNumber",exportAccessor:"ticketNumber"},{Header:"Form",accessor:e=>{var s;return null===e||void 0===e||null===(s=e.form)||void 0===s?void 0:s.name}},{Header:"Status",accessor:e=>{var s;return null===e||void 0===e||null===(s=e.ticketStatus)||void 0===s?void 0:s.toUpperCase()},exportAccessor:"ticketStatus"},{Header:"Priority",accessor:e=>{var s;return null===e||void 0===e||null===(s=e.priority)||void 0===s?void 0:s.toUpperCase()},exportAccessor:"priority"},{Header:"Description",accessor:"description"},{Header:"Assigned Supervisor",accessor:e=>{var s,a;return null!==e&&void 0!==e&&e.supervisor_obj?`${null===e||void 0===e||null===(s=e.supervisor_obj)||void 0===s?void 0:s.name}-${null===e||void 0===e||null===(a=e.supervisor_obj)||void 0===a?void 0:a.code}`:"-"},exportAccessor:"supervisor_obj"},{Header:"Assigned O&M Engineer",accessor:e=>{var s,a;return null!==e&&void 0!==e&&e.assignee?`${null===e||void 0===e||null===(s=e.assignee)||void 0===s?void 0:s.name}-${null===e||void 0===e||null===(a=e.assignee)||void 0===a?void 0:a.code}`:"-"},exportAccessor:"assignee"},{Header:"Issue Type",accessor:"issue.name"},{Header:"Issue Sub Type",accessor:"sub_issue.name"},{Header:"Mobile Number",accessor:"mobileNumber"},{Header:"Remarks",accessor:"remarks"},{Header:"Assignee Remarks",accessor:"assigneeRemarks"},{Header:"Created By",accessor:"created.name"},{Header:"Created On",accessor:"createdAt"},{Header:"Updated By",accessor:"updated.name"},{Header:"Updated On",accessor:"updatedAt"},{Header:"Source",accessor:e=>{let{ticketSource:s}=e;return null===s||void 0===s?void 0:s.toUpperCase()},exportAccessor:"ticketSource"}],i=[{Header:"Status",accessor:e=>{var s;return null===e||void 0===e||null===(s=e.ticketStatus)||void 0===s?void 0:s.toUpperCase()}},{Header:"Priority",accessor:e=>{var s;return null===e||void 0===e||null===(s=e.priority)||void 0===s?void 0:s.toUpperCase()}},{Header:"Description",accessor:"description"},{Header:"Assigned Supervisor",accessor:e=>{var s,a;return null!==e&&void 0!==e&&e.supervisor_object?`${null===e||void 0===e||null===(s=e.supervisor_object)||void 0===s?void 0:s.name}-${null===e||void 0===e||null===(a=e.supervisor_object)||void 0===a?void 0:a.code}`:"-"}},{Header:"Assigned O&M Engineer",accessor:e=>{var s,a;return null!==e&&void 0!==e&&e.assignee_obj?`${null===e||void 0===e||null===(s=e.assignee_obj)||void 0===s?void 0:s.name}-${null===e||void 0===e||null===(a=e.assignee_obj)||void 0===a?void 0:a.code}`:"-"}},{Header:"Issue Type",accessor:"issue_obj.name"},{Header:"Issue Sub Type",accessor:"sub_issue_obj.name"},{Header:"Remarks",accessor:"remarks"},{Header:"Assignee Remarks",accessor:"assigneeRemarks"},{Header:"Mobile Number",accessor:"mobileNumber"},{Header:"Updated By",accessor:"updated.name"},{Header:"Updated On",accessor:"updatedAt"}],r=[{label:"All",id:"all"},{label:"Today",id:"0"},{label:"1 Days Old",id:"1"},{label:"2 Days Old",id:"2"},{label:"3 Days Old",id:"3"},{label:"5 Days Old",id:"5"},{label:"7 Days Old",id:"7"},{label:"More than 7 Days Old",id:"8",type:"error"}]},11790:(e,s,a)=>{a.r(s),a.d(s,{default:()=>K});var t=a(9950),i=a(27081),r=a(67535),o=a(4139),n=a(87233),l=a(60625),d=a(96583),c=a(9449),u=a(35431),m=a(14857),v=a(57073),p=a(60666),g=a(26473);const h=(0,a(17457).A)();var y=a(50287),j=a(80134),f=a(37119),b=a(73175),x=a(31656),k=a(82526),A=a(96951),S=a(29024),I=a(71826),w=a(14351),T=a(99635),z=a(60209),O=a(66004),C=a(62054),L=a(79033),M=a(88848),E=a(55519),H=a(84601),V=a(52867),D=a(72578),F=a(513),P=a(2606),N=a(33507),B=a(44414);const R={role:'All supervisors assigned in the "Supervisor Assignment" module will be displayed.',gaa:"The GAA area will be displayed according to the selected record's hierarchy. If the supervisor's name is not displayed, navigate to the \"Supervisor Assignment\" module and assign a supervisor with their O&M engineer.",organization:'If the supervisor\'s name is not displayed, navigate to "Supervisor Assignment" module and assign a supervisor with their O&M engineer.'},q=[{name:"attachments",label:"Attachments",accept:"image/*",required:!1,multiple:!0}],$=e=>{var s,a,l,u,$,G,U,W,_,Y,K,Q;let{disableFields:Z,projectId:J,onFormSubmit:X,ticket:ee,geoLocation:se,tableData:ae,tableColumns:te,openTickets:ie,ticketStatusTypeList:re,onCloseTicketForm:oe,gaaResponseData:ne}=e;const le=(0,m.A)(),de=(0,i.wA)(),[ce,ue]=(0,t.useState)(),[me,ve]=(0,t.useState)([]),[pe,ge]=(0,t.useState)({supervisor:[],installer:[]}),[he,ye]=(0,t.useState)({}),[je,fe]=(0,t.useState)(!1),[be,xe]=(0,t.useState)(!1),{projectMasterMakerLovs:ke}=(0,z.k)(),Ae=(null===ke||void 0===ke||null===(s=ke.projectMasterMakerLovsObject)||void 0===s?void 0:s.rows)||[],{projectWiseTicketMapping:Se}=(0,x.C)(),Ie=(null===(a=Se.projectWiseTicketMappingObject)||void 0===a?void 0:a.rows)||[],{users:we}=(0,O.k)(),{user:Te}=(0,N.A)(),ze=(0,t.useMemo)((()=>{var e;return null!==Te&&void 0!==Te&&null!==(e=Te.role)&&void 0!==e&&e.addTicket?"true":"false"}),[Te]),Oe=(0,t.useMemo)((()=>{var e;return(null===we||void 0===we||null===(e=we.usersObject)||void 0===e?void 0:e.rows)||[]}),[we]),{roleProjects:Ce}=(0,L.z)(),Le=(null===Ce||void 0===Ce||null===(l=Ce.roleProjectsObject)||void 0===l?void 0:l.rows)||[],{masterMakerOrgType:Me}=(0,M.$)(),Ee=null===Me||void 0===Me?void 0:Me.masterObject,{organizationsDropdown:He,organizationsLocByParent:Ve}=(0,E.G)(),De=(null===He||void 0===He?void 0:He.organizationDropdownObject)||[],Fe=(null===Ve||void 0===Ve||null===(u=Ve.organizationObject)||void 0===u?void 0:u.rows)||[],{supervisorUsers:Pe}=(0,O.k)(),Ne=(0,t.useMemo)((()=>{var e;return(null===Pe||void 0===Pe||null===(e=Pe.supervisorUsersObject)||void 0===e?void 0:e.rows)||[]}),[Pe]),Be=(0,t.useCallback)((async(e,s)=>{const a=await(0,I.default)("/ticket-form-data",{method:"GET",query:{formId:e,responseId:s}});var t;a.success?ue(a.data.data):((0,C.A)((null===a||void 0===a||null===(t=a.error)||void 0===t?void 0:t.message)||"Operation failed. Please try again.",{variant:"error"}),oe())}),[oe]),Re=(0,t.useCallback)((async()=>{const{responseId:e,formId:s}=ne||{};if(e&&s){const r=await(0,I.default)("/ticket-gaa-data",{method:"GET",query:{responseId:e,formId:s}});var a,t,i;if(r.success)ve((null===(a=r.data)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.data)||[]);else(0,C.A)((null===r||void 0===r||null===(i=r.error)||void 0===i?void 0:i.message)||"Operation failed. Please try again.",{variant:"error"}),oe()}}),[ne,oe]),qe=(0,t.useCallback)((async()=>{const e=await(0,I.default)("/ticket-occupied-user-list",{method:"GET"});var s,a;e.success?ye((null===e||void 0===e||null===(s=e.data)||void 0===s?void 0:s.data)||{}):((0,C.A)((null===e||void 0===e||null===(a=e.error)||void 0===a?void 0:a.message)||"Operation failed. Please try again.",{variant:"error"}),oe())}),[oe]);(0,t.useEffect)((()=>{ee?Be(ee.formId,ee.responseId):ae&&te&&ue({data:[ae],columns:te})}),[ee,ae,te,Be]),(0,t.useEffect)((()=>{Re()}),[Re]),(0,t.useEffect)((()=>{qe(),de((0,S.TS7)()),J&&(de((0,S.loF)({projectId:J,hasAccess:ze})),de((0,S.ORy)({projectId:J})),de((0,S.PBN)({selectedProject:J})),de((0,S.hCS)({projectId:[J],hasAccess:ze}))),de((0,S.VOH)("ORGANIZATION TYPE"))}),[de,qe,J,ze]);const $e=(0,c.mN)({resolver:(0,g.t)(p.Ik().shape({priority:H.A.required,issueId:H.A.required,subIssueId:H.A.required,assigneeType:H.A.required,mobileNumber:p.Yj().matches("^((\\+91)?|91)?[6789]\\d{9}$"," ").required(" "),description:H.A.required,supervisorId:p.Yj().when("assigneeType",{is:e=>"supervisor"===e,then:p.Yj().required(" ")}),assigneeId:p.Yj().when("assigneeType",{is:e=>"installer"===e,then:p.Yj().required(" ")})})),defaultValues:{issueId:(null===ee||void 0===ee?void 0:ee.issueId)||"",subIssueId:(null===ee||void 0===ee?void 0:ee.subIssueId)||"",assigneeType:(null===ee||void 0===ee?void 0:ee.assigneeType)||"nomc",description:(null===ee||void 0===ee?void 0:ee.description)||"",supervisorId:(null===ee||void 0===ee?void 0:ee.supervisorId)||"",assigneeId:(null===ee||void 0===ee?void 0:ee.assigneeId)||"",ticketStatus:(null===ee||void 0===ee?void 0:ee.ticketStatus)||"",remarks:(null===ee||void 0===ee?void 0:ee.remarks)||"",mobileNumber:(null===ee||void 0===ee?void 0:ee.mobileNumber)||"",assignBy:(null===ee||void 0===ee?void 0:ee.assignBy)||"",priority:(null===ee||void 0===ee?void 0:ee.priority)||""},mode:"all"}),{handleSubmit:Ge,setValue:Ue,getValues:We}=$e,_e=$e.watch("assignBy"),Ye=$e.watch("gaaLevel"),Ke=$e.watch("role"),Qe=$e.watch("organizationName"),Ze=$e.watch("organizationType"),Je=$e.watch("organizationBranch");(0,t.useEffect)((()=>{let e,s;const a=Ne.map((e=>e.id)),t=Oe.filter((e=>!a.includes(e.id)));switch(_e){case"gaa":e=(null===Ne||void 0===Ne?void 0:Ne.filter((e=>{var s;return null===(s=me.filter((e=>e.id===Ye))[0])||void 0===s?void 0:s.userIds.includes(e.id)})))||[],s=(null===t||void 0===t?void 0:t.filter((e=>{var s;return null===(s=me.filter((e=>e.id===Ye))[0])||void 0===s?void 0:s.userIds.includes(e.id)})))||[];break;case"role":e=[...Ne]||[],s=(null===t||void 0===t?void 0:t.filter((e=>e.roleId===Ke)))||[];break;case"organization":e=(null===Ne||void 0===Ne?void 0:Ne.filter((e=>e.oraganizationId===Qe&&e.oraganizationType===Ze&&(!Je||e.organisationBranchId===Je))))||[],s=(null===t||void 0===t?void 0:t.filter((e=>e.oraganizationId===Qe&&e.oraganizationType===Ze&&(!Je||e.organisationBranchId===Je))))||[];break;default:e=[],s=[]}e=e.map((e=>({id:e.id,name:`${e.name}-${e.code}`}))),s=s.map((e=>({id:e.id,name:`${e.name}-${e.code}`}))),ge({supervisor:e,installer:s})}),[_e,Ye,Ke,Je,Qe,Ze,Oe,Ne,me]),(0,t.useEffect)((()=>{Ze&&Qe&&de((0,S.VRs)({params:Ze+"/"+Qe,hasAccess:ze})),Ze&&de((0,S.d8s)(`${Ze}?hasAccess=${ze}`))}),[de,Ze,Qe,ze]);const Xe=(0,t.useCallback)(((e,s,a)=>{if("role"===e)Ue("role",(null===s||void 0===s?void 0:s.roleId)||"");else if("organization"===e)Ue("organizationBranch",(null===s||void 0===s?void 0:s.organisationBranchId)||""),Ue("organizationName",(null===s||void 0===s?void 0:s.oraganizationId)||""),Ue("organizationType",(null===s||void 0===s?void 0:s.oraganizationType)||"");else if("gaa"===e)for(let t=0;t<a.length;t++){const{userIds:e,id:i}=a[t];if(null!==e&&void 0!==e&&e.includes(null===s||void 0===s?void 0:s.id)){Ue("gaaLevel",i);break}}}),[Ue]);(0,t.useEffect)((()=>{if(!ee||"nomc"===ee.assigneeType)return;let e=null;switch(We("assigneeType")){case"installer":if(!Oe.length)return;[e]=Oe.filter((e=>e.id===We("assigneeId")));break;case"supervisor":if(!Ne.length)return;[e]=Ne.filter((e=>e.id===We("supervisorId")))}Xe(We("assignBy"),e,me)}),[Oe,Ne,me,Xe,We,ee]);return(0,B.jsxs)(B.Fragment,{children:[ae&&(0,B.jsx)(h,{spacing:2,sx:{mb:2},children:(0,B.jsx)(T.default,{hidePagination:!0,hideHeader:!0,data:(null===ce||void 0===ce||null===($=ce.data)||void 0===$?void 0:$.map(((e,s)=>({...e,id:s}))))||[],columns:(null===ce||void 0===ce||null===(G=ce.columns)||void 0===G?void 0:G.map((e=>({Header:e.name,accessor:e.name}))))||[],count:(null===ce||void 0===ce||null===(U=ce.data)||void 0===U?void 0:U.length)||0,hideEmptyTable:!0,hideActions:!0})}),ae&&"Success"!==ae["MDM Payload Status"]?(0,B.jsx)(j.A,{severity:"error",icon:(0,B.jsx)(b.A,{sx:{ml:1,mr:.5,mt:.5}}),children:(0,B.jsx)(f.A,{sx:{mt:1},children:"O&M activity can't be performed. Please sync data to MDM before proceeding."})}):ae&&(null===ie||void 0===ie?void 0:ie.length)>0?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(j.A,{severity:"error",icon:(0,B.jsx)(b.A,{sx:{ml:1,mr:.5,mt:.5}}),sx:{mb:2},children:(0,B.jsx)(f.A,{sx:{mt:1},children:"Ticket Already Exists."})}),(0,B.jsx)(T.default,{hidePagination:!0,hideHeader:!0,data:ie||[],columns:k.WL,count:(null===ie||void 0===ie?void 0:ie.length)||0,hideEmptyTable:!0,hideActions:!0})]}):(0,B.jsx)(A.Op,{methods:$e,onSubmit:Ge((async e=>{var s;if(fe(!0),!ee)return e.assigneeType&&(e.assignBy="organization"),await X(e,null===(s=Ie[0])||void 0===s?void 0:s.id),void fe(!1);e.newAttachments=e["attachments-paths"],delete e["attachments-paths"],delete e.attachments;const a={...ee,...e};"supervisor"===e.assigneeType||"installer"===e.assigneeType?("supervisor"===e.assigneeType?a.assigneeId=e.supervisorId:"installer"===e.assigneeType&&(a.supervisorId=null),a.ticketStatus="open"===a.ticketStatus?"assigned":a.ticketStatus):(a.assigneeId=null,a.supervisorId=null,a.ticketStatus="assigned"===a.ticketStatus?"open":a.ticketStatus),"closed"===a.ticketStatus&&(a.supervisorId=null,a.assigneeId=null);const t=await(0,I.default)("/update-ticket",{method:"PUT",params:ee.id,body:a});var i;t.success?((0,C.A)("Ticket updated successfully.",{variant:"success",autoHideDuration:1e4}),oe(!0)):(0,C.A)((null===t||void 0===t||null===(i=t.error)||void 0===i?void 0:i.message)||"Operation failed. Please try again.",{variant:"error"});fe(!1)})),children:(0,B.jsxs)(w.A,{title:ee?(0,B.jsxs)(o.Ay,{sx:{display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[(0,B.jsx)(v.A,{sx:{position:"absolute",left:10},onClick:()=>oe(),color:"primary",children:(0,B.jsx)(y.A,{})}),(0,B.jsx)(n.A,{sx:{position:"relative",left:25},variant:"h4",children:`Edit Ticket : ${(null===ee||void 0===ee?void 0:ee.updatedTicketNumber)||""}`})]}):null,children:[(0,B.jsxs)(o.Ay,{container:!0,rowSpacing:3,columnSpacing:2,sx:{mb:4},alignItems:"flex-end",children:[ee&&(0,B.jsx)(o.Ay,{item:!0,xs:12,children:(0,B.jsx)(T.default,{hidePagination:!0,hideHeader:!0,data:(null===ce||void 0===ce||null===(W=ce.data)||void 0===W?void 0:W.map(((e,s)=>({...e,id:s}))))||[],columns:(null===ce||void 0===ce||null===(_=ce.columns)||void 0===_?void 0:_.map((e=>({Header:e.name,accessor:e.name}))))||[],count:(null===ce||void 0===ce||null===(Y=ce.data)||void 0===Y?void 0:Y.length)||0,hideEmptyTable:!0,hideActions:!0})}),(0,B.jsx)(o.Ay,{item:!0,xs:3,children:(0,B.jsx)(A.o3,{disabled:Z,name:"mobileNumber",type:"number",placeholder:"Mobile Number",label:"Consumer Mobile Number",required:!0})}),(0,B.jsx)(o.Ay,{item:!0,xs:3,children:(0,B.jsx)(A.o3,{name:"geoLocation",label:"Geo Location",value:ee?(null===ce||void 0===ce?void 0:ce.location)||"":se,disabled:!0})}),(0,B.jsx)(o.Ay,{item:!0,xs:3,children:(ee?null===ce||void 0===ce?void 0:ce.location:se)&&(0,B.jsx)(r.A,{disabled:Z,onClick:()=>{(e=>{const s=e.split(",");window.open(`https://maps.google.com?q=${s[0]},${s[1]}`,"_blank")})(ee?(null===ce||void 0===ce?void 0:ce.location)||",":se)},children:"View on Map"})})]}),(0,B.jsxs)(o.Ay,{container:!0,rowSpacing:3,columnSpacing:2,children:[(0,B.jsx)(o.Ay,{item:!0,md:3,children:(0,B.jsx)(A.eu,{name:"issueId",placeholder:"Select Issue Type",label:"Issue Type",onChange:()=>{$e.setValue("subIssueId","")},menus:null===(K=Ie[0])||void 0===K?void 0:K.issueFields,disable:Z,required:!0})}),(0,B.jsx)(o.Ay,{item:!0,md:3,children:(0,B.jsx)(A.eu,{name:"subIssueId",placeholder:"Select Sub Issue Type",label:"Sub-Issue Type",menus:Ae.filter((e=>e.masterId===$e.watch("issueId"))).map((e=>({name:e.name,id:e.id}))),disable:Z,required:!0})}),re&&ee&&(0,B.jsx)(o.Ay,{item:!0,md:3,children:(0,B.jsx)(A.eu,{name:"ticketStatus",placeholder:"Select ticket status",label:"Ticket Status",menus:re,disable:Z,onChange:e=>{var s;"open"===(null===e||void 0===e||null===(s=e.target)||void 0===s?void 0:s.value)&&($e.setValue("assigneeId",""),$e.setValue("supervisorId",""),$e.setValue("assigneeType","nomc"),$e.setValue("assignBy",""))}})}),(0,B.jsx)(o.Ay,{item:!0,md:3,children:(0,B.jsx)(A.eu,{required:!0,name:"priority",placeholder:"Select ticket priority",label:"Ticket Priority",menus:D.tF,disable:Z,allowClear:!0})}),(0,B.jsx)(o.Ay,{item:!0,xs:6,md:6,children:(0,B.jsx)(A.gk,{name:"assigneeType",title:"Assignee Type",singleLineRadio:"true",disabled:ee&&"assigned"!==$e.watch("ticketStatus")||Z,labels:[{name:"NOMC",value:"nomc",disabled:ee&&"open"!==$e.watch("ticketStatus")},{name:"Supervisor",value:"supervisor"},{name:"O&M Engineer",value:"installer"}],onChange:e=>{$e.setValue("role",""),$e.setValue("assigneeId",""),$e.setValue("supervisorId",""),$e.setValue("organizationType",""),$e.setValue("organizationName",""),$e.setValue("organizationBranch",""),"nomc"===e.target.value&&$e.setValue("assignBy","")},style:{"& label":{marginTop:"0",width:"33%"},marginTop:"10px !important",borderRadius:"4px",border:"1px solid",borderColor:"dark"===le.palette.mode?le.palette.divider:le.palette.grey.A800,padding:"3px 0"},required:!0})}),(0,B.jsx)(o.Ay,{item:!0,xs:8,md:6,children:(0,B.jsx)(A.gk,{name:"assignBy",title:"Assign By",singleLineRadio:"true",labels:[{name:"GAA",value:"gaa"},{name:"Role",value:"role"},{name:"Organization",value:"organization"}],disabled:!$e.watch("assigneeType")||"nomc"===$e.watch("assigneeType")||ee&&"assigned"!==$e.watch("ticketStatus")||Z,style:{"& label":{marginTop:"0",width:"33%"},marginTop:"10px !important",borderRadius:"4px",border:"1px solid",borderColor:"dark"===le.palette.mode?le.palette.divider:le.palette.grey.A800,padding:"3px 0"},required:!0})}),"supervisor"===$e.watch("assigneeType")&&$e.watch("assignBy")&&(0,B.jsx)(o.Ay,{item:!0,xs:12,children:(0,B.jsxs)(n.A,{color:"error",children:["Note: ",R[$e.watch("assignBy")]]})}),"nomc"!==$e.watch("assigneeType")&&$e.watch("assignBy")&&(0,B.jsx)(o.Ay,{item:!0,xs:12,children:(0,B.jsxs)(o.Ay,{container:!0,spacing:2,children:["role"===$e.watch("assignBy")&&"supervisor"!==$e.watch("assigneeType")&&(0,B.jsx)(o.Ay,{item:!0,xs:3,children:(0,B.jsx)(A.eu,{name:"role",placeholder:"Role",label:"Select Role",menus:null===Le||void 0===Le?void 0:Le.filter((e=>{let{forTicket:s}=e;return s})),onChange:()=>{$e.setValue("supervisorId",""),$e.setValue("assigneeId","")},required:!0,disable:ee&&"assigned"!==$e.watch("ticketStatus")})}),"organization"===$e.watch("assignBy")&&(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(o.Ay,{item:!0,md:3,children:(0,B.jsx)(A.eu,{name:"organizationType",placeholder:"Organization Type",label:"Select Organization Type",menus:Ee,onChange:()=>{$e.setValue("organizationName",""),$e.setValue("organizationBranch",""),$e.setValue("supervisorId",""),$e.setValue("assigneeId","")},required:!0,disable:ee&&"assigned"!==$e.watch("ticketStatus")})}),(0,B.jsx)(o.Ay,{item:!0,md:3,children:(0,B.jsx)(A.eu,{name:"organizationName",placeholder:"Organization Name",label:"Select Organization Name",menus:De,onChange:()=>{$e.setValue("organizationBranch",""),$e.setValue("supervisorId",""),$e.setValue("assigneeId","")},required:!0,disable:ee&&"assigned"!==$e.watch("ticketStatus")})}),(0,B.jsx)(o.Ay,{item:!0,md:3,children:(0,B.jsx)(A.eu,{name:"organizationBranch",placeholder:"Organization Branch",label:"Select Organization Branch",menus:(0,V.HF)(Fe),onChange:()=>{$e.setValue("supervisorId",""),$e.setValue("assigneeId","")},allowClear:!0,disable:ee&&"assigned"!==$e.watch("ticketStatus")})})]}),"gaa"===$e.watch("assignBy")&&(0,B.jsx)(o.Ay,{item:!0,md:3,children:(0,B.jsx)(A.eu,{name:"gaaLevel",placeholder:"GAA Level",label:"Select GAA Level",menus:me.map((e=>({id:e.id,name:`${e.name} (${e.value})`}))),onChange:()=>{$e.setValue("supervisorId",""),$e.setValue("assigneeId","")},allowClear:!0,disable:ee&&"assigned"!==$e.watch("ticketStatus")})}),(0,B.jsx)(o.Ay,{item:!0,xs:3,children:(0,B.jsx)(A.eu,{name:"supervisor"===$e.watch("assigneeType")?"supervisorId":"assigneeId",placeholder:"supervisor"===$e.watch("assigneeType")?"Supervisor":"O&M Engineer",label:"Select "+("supervisor"===$e.watch("assigneeType")?"Supervisor":"O&M Engineer"),menus:pe[$e.watch("assigneeType")].map((e=>({id:e.id,name:`${e.name} (${he[e.id]||0})`}))),required:!0,disable:ee&&"assigned"!==$e.watch("ticketStatus")})})]})}),(0,B.jsx)(o.Ay,{item:!0,xs:6,children:(0,B.jsx)(A.o3,{required:!0,name:"description",disabled:Z,label:"Ticket Description",placeholder:"Enter ticket description",multiline:!0,rows:5})}),(0,B.jsx)(o.Ay,{item:!0,xs:6,children:(0,B.jsx)(A.o3,{name:"remarks",disabled:Z,label:"Remarks",placeholder:"Enter ticket remarks",multiline:!0,rows:5})}),(0,B.jsxs)(o.Ay,{item:!0,xs:4,sx:{display:"flex",alignItems:"flex-start",gap:"20px"},children:[(0,B.jsx)(r.A,{disabled:!$e.watch("attachments"),size:"small",variant:"outlined",sx:{mt:1},onClick:()=>{xe(!0)},children:"View Attachments"}),(0,B.jsx)(F.A,{disabled:Z,fileFields:q,setValue:Ue})]}),(0,B.jsx)(o.Ay,{item:!0,xs:8,sx:{display:"flex",justifyContent:"flex-end",alignItems:"flex-start"},children:(0,B.jsx)(r.A,{sx:{mt:1},disabled:Z||je,variant:"contained",size:"small",color:"primary",type:"submit",children:ee?"Update Ticket":"Raise Ticket"})})]})]})}),(0,B.jsx)(d.A,{open:be,onClose:()=>xe(null),scroll:"paper",disableEscapeKeyDown:!0,children:(0,B.jsx)(P.A,{base64Image:!0,imageList:(null===(Q=$e.watch("attachments-paths"))||void 0===Q?void 0:Q.map((e=>e.fileData)))||[]})})]})};var G=a(80733);const U=e=>{var s,a,l;let{onSearchResult:d,onCloseTicketForm:u}=e;const m=(0,i.wA)(),[h,j]=(0,t.useState)(),[f,b]=(0,t.useState)(!1),{projectsDropdown:k}=(0,G.Y)(),T=null===k||void 0===k?void 0:k.projectsDropdownObject,{formWiseTicketMapping:z}=(0,x.C)(),O=(null===z||void 0===z||null===(s=z.formWiseTicketMappingObject)||void 0===s?void 0:s.rows)||[];(0,t.useEffect)((()=>{m((0,S.uiG)()),m((0,S.FqD)())}),[m]);const L=(0,c.mN)({resolver:(0,g.t)(p.Ik().shape({projectId:H.A.required,formId:H.A.required,searchField:H.A.required,searchValue:H.A.required})),defaultValues:{searchField:"",searchValue:"",projectId:"",formId:""},mode:"all"}),{handleSubmit:M}=L;return(0,B.jsx)(A.Op,{methods:L,onSubmit:M((async e=>{const s={searchValue:e.searchValue.trim()||"",searchField:e.searchField,formId:e.formId,displayColumns:["id",...h.displayFields.map((e=>e.columnName))]};var a;h.geoLocationField&&s.displayColumns.push(null===(a=h.geoLocationField)||void 0===a?void 0:a.columnName);s.displayColumns=JSON.stringify(s.displayColumns),b(!0);const t=await(0,I.default)("/ticket-mapping-form-data-list",{method:"GET",query:s});var i;(b(!1),t.success)?t.data.data.length?d({data:[...t.data.data],ticketIssueTypes:h.ticketIssueTypes,form:h}):(0,C.A)("Data not found. Please try again with valid search.",{variant:"warning"}):(0,C.A)((null===t||void 0===t||null===(i=t.error)||void 0===i?void 0:i.message)||"Search failed. Please try again.",{variant:"error"})})),children:(0,B.jsx)(w.A,{title:(0,B.jsxs)(o.Ay,{sx:{display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[(0,B.jsx)(v.A,{sx:{position:"absolute",left:10},onClick:()=>u(),color:"primary",children:(0,B.jsx)(y.A,{})}),(0,B.jsx)(n.A,{sx:{position:"relative",left:25},variant:"h4",children:"Create Ticket"})]}),sx:{mb:2},children:(0,B.jsxs)(o.Ay,{container:!0,sx:{mb:2},spacing:2,children:[(0,B.jsx)(o.Ay,{item:!0,xs:12,md:2.75,children:(0,B.jsx)(A.eu,{name:"projectId",label:"Select Project",placeholder:"Project",menus:T,onChange:()=>{L.setValue("formId",""),L.setValue("searchField",""),L.setValue("searchValue","")},required:!0})}),(0,B.jsx)(o.Ay,{item:!0,xs:12,md:2.75,children:(0,B.jsx)(A.eu,{name:"formId",label:"Select Form",placeholder:"Form",menus:null===O||void 0===O||null===(a=O.filter((e=>e.projectId===L.watch("projectId"))))||void 0===a?void 0:a.map((e=>e.form)),onChange:e=>{L.setValue("searchField",""),L.setValue("searchValue",""),j((null===O||void 0===O?void 0:O.filter((s=>{var a,t;return(null===(a=s.form)||void 0===a?void 0:a.id)===(null===(t=e.target)||void 0===t?void 0:t.value)}))[0])||void 0)},required:!0})}),(0,B.jsx)(o.Ay,{item:!0,xs:12,md:2.75,children:(0,B.jsx)(A.eu,{name:"searchField",label:"Filter By",placeholder:"Filter",menus:(null===h||void 0===h||null===(l=h.searchFields)||void 0===l?void 0:l.map((e=>({id:e.columnName,name:e.name}))))||[],onChange:()=>{L.setValue("searchValue","")},required:!0})}),(0,B.jsx)(o.Ay,{item:!0,xs:12,md:2.75,children:(0,B.jsx)(A.o3,{fullWidth:!0,label:"Search Value",placeholder:"Value",autoComplete:"off",name:"searchValue",required:!0})}),(0,B.jsx)(o.Ay,{item:!0,xs:12,md:1,sx:{display:"flex",alignItems:"flex-end",justifyContent:"center"},children:(0,B.jsx)(r.A,{disabled:f,size:"small",variant:"contained",color:"primary",type:"submit",children:"Search"})})]})})})},W=e=>{var s,a;let{goToTicketList:i}=e;const[r,o]=(0,t.useState)(),[n,l]=(0,t.useState)([]),[c,u]=(0,t.useState)(),[m,v]=(0,t.useState)(!1),[p,g]=(0,t.useState)(null),[h,y]=(0,t.useState)(),j=(0,t.useCallback)((async()=>{if(c){const a=await(0,I.default)("/ticket-list",{method:"GET",params:null===c||void 0===c?void 0:c["Response ID"]});var e,s;if(a.success)g((null===a||void 0===a||null===(e=a.data)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.rows)||[]);else(0,C.A)("Failed to load previous open ticket records",{variant:"error"})}}),[c]);(0,t.useEffect)((()=>{j()}),[j]);return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(U,{onSearchResult:e=>{var s;(l(e.data),1===e.data.length)?(u(e.data[0]),y({responseId:null===(s=e.data[0])||void 0===s?void 0:s["Response ID"],formId:e.form.formId})):v(!0);o(e.form)},onCloseTicketForm:i}),(0,B.jsx)(d.A,{open:m,onClose:()=>v(!1),scroll:"paper",maxWidth:"lg",children:(0,B.jsx)(T.default,{data:(null===n||void 0===n?void 0:n.map(((e,s)=>({...e,id:s}))))||[],columns:(null===r||void 0===r||null===(s=r.displayFields)||void 0===s?void 0:s.map((e=>({Header:e.name,accessor:e.name}))))||[],count:(null===n||void 0===n?void 0:n.length)||0,hidePagination:!0,hideEditIcon:!0,hideHeader:!0,hideDeleteIcon:!0,miniAction:!0,hideHistoryIcon:!0,hideRestoreIcon:!0,handleRowView:e=>{var s;u(n[e.id]),y({responseId:null===(s=n[e.id])||void 0===s?void 0:s["Response ID"],formId:r.formId}),v(!1)}})}),(0,B.jsx)($,{disableFields:!c||(0!==(null===p||void 0===p?void 0:p.length)||"Success"!==c["MDM Payload Status"]),geoLocation:(null===c||void 0===c?void 0:c[null===r||void 0===r||null===(a=r.geoLocationField)||void 0===a?void 0:a.name])||null,tableData:c,tableColumns:null===r||void 0===r?void 0:r.displayFields,openTickets:p,projectId:null===r||void 0===r?void 0:r.projectId,onFormSubmit:async(e,s)=>{const a={issueId:e.issueId,subIssueId:e.subIssueId,description:e.description,projectId:r.projectId||null,formId:r.formId||null,formWiseMappingId:r.id||null,projectWiseMappingId:s,assigneeType:e.assigneeType,assignBy:e.assignBy,mobileNumber:e.mobileNumber,supervisorId:null,assigneeId:null,ticketStatus:"assigned",responseId:c["Response ID"],remarks:e.remarks||"",priority:e.priority,attachments:e["attachments-paths"]||[]};"supervisor"===e.assigneeType?(a.supervisorId=e.supervisorId,a.assigneeId=e.supervisorId):"installer"===e.assigneeType?(a.supervisorId=null,a.assigneeId=e.assigneeId):a.ticketStatus="open";const t=await(0,I.default)("/ticket-create",{method:"POST",timeoutOverride:6e5,body:a});var o;t.success?((0,C.A)(`Ticket created successfully. Ticket ID: ${t.data.data.updatedTicketNumber}`,{variant:"success",autoHideDuration:1e4}),i(!0)):(0,C.A)((null===t||void 0===t||null===(o=t.error)||void 0===o?void 0:o.message)||"Operation failed. Please try again.",{variant:"error"})},onCloseTicketForm:i,gaaResponseData:h})]})};var _=a(89649),Y=a(39225);const K=()=>{var e,s,a,m;const{paginations:{pageSize:v,pageIndex:p},setPageIndex:g,setPageSize:h}=(0,_.A)(),y=(0,i.wA)(),[j,f]=(0,t.useState)(),[b,x]=(0,t.useState)({id:"all",title:"All Tickets"}),[I,z]=(0,t.useState)(),[O,C]=(0,t.useState)(),[L,M]=(0,t.useState)(null),[E,H]=(0,t.useState)(!1),[V,F]=(0,t.useState)(!1),[N,R]=(0,t.useState)(),{projectsDropdown:q}=(0,G.Y)(),U=null===q||void 0===q?void 0:q.projectsDropdownObject,{tickets:K,ticketAging:Q,ticketHistory:Z}=(0,u.d)(),J=(null===(e=K.ticketsObject)||void 0===e?void 0:e.rows)||[],X=(null===K||void 0===K||null===(s=K.ticketsObject)||void 0===s?void 0:s.count)||0,ee=(null===Q||void 0===Q?void 0:Q.ticketAgingObject)||{},se=(null===Z||void 0===Z||null===(a=Z.ticketHistoryObject)||void 0===a?void 0:a.rows)||[],ae=(null===Z||void 0===Z||null===(m=Z.ticketHistoryObject)||void 0===m?void 0:m.count)||0,{searchString:te,accessorsRef:ie,setSearchString:re,setAccessors:oe}=(0,Y.A)(),ne=(0,t.useMemo)((()=>[...k.WL,{Header:"Attachments",accessor:e=>{if(null!==e&&void 0!==e&&e.attachments&&e.attachments.length)return(0,B.jsx)(r.A,{size:"small",variant:"outlined",onClick:()=>{F(!0),R(e.attachments)},children:"View"})}}]),[]);(0,t.useEffect)((()=>{y((0,S.uiG)())}),[y]);const le=(0,c.mN)({defaultValues:{ticketStatus:"all"},mode:"all"}),de=le.watch("ticketStatus"),ce=(0,t.useCallback)((()=>{j&&(y((0,S.lnE)({projectId:j,pageIndex:p,pageSize:v,aging:null===I||void 0===I?void 0:I.id,ticketStatus:de,searchString:te,accessorsRef:ie})),x({id:(null===I||void 0===I?void 0:I.id)||"all",title:`${(null===I||void 0===I?void 0:I.label)||"All"} Tickets`}))}),[y,p,v,I,de,te,ie,j]);(0,t.useEffect)((()=>{j&&y((0,S.c1F)({projectId:j,aging:null===I||void 0===I?void 0:I.id,ticketStatus:de}))}),[y,de,I,j]),(0,t.useEffect)((()=>{ce()}),[ce]),(0,t.useEffect)((()=>{L&&y((0,S.BaQ)({recordId:L.id,pageIndex:p,pageSize:v}))}),[y,L,p,v]);return(0,B.jsx)(B.Fragment,{children:E?(0,B.jsx)(B.Fragment,{children:(0,B.jsx)(W,{goToTicketList:e=>{H(!1),e&&ce()}})}):(0,B.jsx)(B.Fragment,{children:O?(0,B.jsx)($,{projectId:j,ticket:O,ticketStatusTypeList:D.Gf,gaaResponseData:{responseId:O.responseId,formId:O.formId},onCloseTicketForm:e=>{C(),e&&ce()}}):(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(A.Op,{methods:le,children:(0,B.jsx)(w.A,{title:(0,B.jsxs)(o.Ay,{container:!0,xl:12,spacing:2,children:[(0,B.jsx)(o.Ay,{item:!0,xl:10,md:10,children:(0,B.jsx)(n.A,{variant:"h4",children:"All Tickets"})}),(0,B.jsx)(o.Ay,{item:!0,xl:2,md:2,sx:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:(0,B.jsx)(r.A,{variant:"contained",size:"small",color:"primary",onClick:()=>{H(!0)},children:"Create New Ticket"})})]}),sx:{mb:2},children:(0,B.jsxs)(o.Ay,{container:!0,spacing:2,children:[(0,B.jsx)(o.Ay,{item:!0,xs:3,children:(0,B.jsx)(A.eu,{name:"project",onChange:e=>{var s;f(null===e||void 0===e||null===(s=e.target)||void 0===s?void 0:s.value)},label:"Select Project",InputLabelProps:{shrink:!0},menus:U,required:!0})}),(0,B.jsx)(o.Ay,{item:!0,xs:2,children:(0,B.jsx)(A.eu,{name:"ticketStatus",label:"Ticket Status",InputLabelProps:{shrink:!0},menus:[{id:"all",name:"All"},{id:"open",name:"Open"},{id:"closed",name:"Closed"}],required:!0})}),j&&(0,B.jsxs)(o.Ay,{container:!0,spacing:2,sx:{mt:2},children:[(0,B.jsx)(o.Ay,{item:!0,xs:12,style:{display:"flex",justifyContent:"flex-end",alignItems:"center"},children:(0,B.jsx)(l.A,{size:"medium",disableElevation:!0,children:k.yV.map((e=>(0,B.jsx)(r.A,{color:e.type&&"error"===e.type?"error":"primary",variant:(null===b||void 0===b?void 0:b.id)===e.id?"contained":"outlined",onClick:()=>{z(e)},children:`${e.label} (${ee[e.id]||0})`},e.id)))})}),(0,B.jsx)(o.Ay,{item:!0,xs:12,style:{display:"flex",gap:"20px",justifyContent:"flex-end",alignItems:"center",flexWrap:"wrap"},children:D.Gf.map((e=>"open"===le.watch("ticketStatus")&&"closed"===e.id?(0,B.jsx)(B.Fragment,{}):(0,B.jsx)(n.A,{sx:{p:1},variant:"span",children:`${e.name} (${J.filter((s=>s.ticketStatus===e.id)).length})`},e.id)))})]})]})})}),(0,B.jsx)(T.default,{data:J,columns:ne,count:X,setPageIndex:g,setPageSize:h,pageIndex:p,pageSize:v,hideAddButton:!0,fcAction:!0,hideViewIcon:!0,hideDeleteIcon:!0,hideRestoreIcon:!0,hideEditIcon:!1,handleRowUpdate:e=>{C(J.filter((s=>s.id===e.id))[0])},handleRowHistory:e=>{M({id:e.id,number:e.updatedTicketNumber})},searchConfig:{searchString:te,setAccessors:oe,setSearchString:re},exportConfig:{tableName:"tickets",apiQuery:{projectId:j,aging:null===I||void 0===I?void 0:I.id,ticketStatus:de}}}),(0,B.jsx)(d.A,{open:L,onClose:()=>{M(null)},scroll:"body",maxWidth:"lg",children:(0,B.jsx)(T.default,{isHistory:!0,title:`Ticket Number : ${(null===L||void 0===L?void 0:L.number)||""}`,data:se,columns:k.a0,count:ae,hideActions:!0,hideSearch:!0,hideAddButton:!0,hideExportButton:!0,setPageIndex:g,setPageSize:h,pageIndex:p,pageSize:v})}),(0,B.jsx)(d.A,{open:V,onClose:()=>F(null),scroll:"paper",disableEscapeKeyDown:!0,children:(0,B.jsx)(P.A,{imageList:N})})]})})})}},35431:(e,s,a)=>{a.d(s,{d:()=>r});var t=a(9950),i=a(27081);const r=()=>{const[e,s]=(0,t.useState)({ticketsObject:{},error:"",loading:!0}),[a,r]=(0,t.useState)({ticketAgingObject:{},error:"",loading:!0}),[o,n]=(0,t.useState)({ticketHistoryObject:null,error:"",loading:!0}),l=(0,i.d4)((e=>e.tickets||{})),d=(0,i.d4)((e=>e.ticketAging||{})),c=(0,i.d4)((e=>e.ticketHistory||{}));return(0,t.useEffect)((()=>{s((e=>({...e,...l})))}),[l]),(0,t.useEffect)((()=>{r((e=>({...e,...d})))}),[d]),(0,t.useEffect)((()=>{n((e=>({...e,...c})))}),[c]),{tickets:e,ticketAging:a,ticketHistory:o}}},26592:(e,s,a)=>{var t=a(24994);s.A=void 0;var i=t(a(79526)),r=a(44414);s.A=(0,i.default)((0,r.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutline")},36089:(e,s,a)=>{var t=a(24994);s.A=void 0;var i=t(a(79526)),r=a(44414);s.A=(0,i.default)((0,r.jsx)("path",{d:"m14.06 9.02.92.92L5.92 19H5v-.92zM17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29m-3.6 3.19L3 17.25V21h3.75L17.81 9.94z"}),"EditOutlined")},73175:(e,s,a)=>{var t=a(24994);s.A=void 0;var i=t(a(79526)),r=a(44414);s.A=(0,i.default)((0,r.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning")}}]);