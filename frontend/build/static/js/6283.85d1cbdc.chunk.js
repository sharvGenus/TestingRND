"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[6283],{96283:(e,s,t)=>{t.r(s),t.d(s,{default:()=>C});var r=t(9950),a=t(27081),n=t(96583),i=t(4139),o=t(66004),d=t(88848),l=t(55519),u=t(80733),c=t(87233),p=t(67535),v=t(60666),m=t(28429),g=t(9449),h=t(26473),x=t(96951),j=t(14351),A=t(84601),S=t(44414);const y=e=>{const s=(0,m.Zp)(),{usersData:t,supervisorData:r,showAdd:a,projectData:n,setSelectedUser:o,setSelectedSupervisor:d,setSelectedOrganizationType:l,selectedOrganizationType:u,setSelectedOrganizationName:y,selectedOrganizationName:f,organizationNameData:I,organizationTypeData:b,setSelectedProject:z}=e,D=(0,g.mN)({resolver:(0,h.t)(v.Ik().shape({projectId:A.A.other,firmId:A.A.other})),defaultValues:{},mode:"all"}),{setValue:O}=D;return(0,S.jsx)(S.Fragment,{children:(0,S.jsx)(x.Op,{methods:D,children:(0,S.jsx)(j.A,{title:(0,S.jsxs)(i.Ay,{container:!0,xl:12,sx:{justifyContent:"space-between",alignItems:"center"},children:[(0,S.jsx)(i.Ay,{item:!0,children:(0,S.jsx)(c.A,{variant:"h4",children:"Supervisor Assignment"})}),!a&&(0,S.jsx)(i.Ay,{item:!0,children:(0,S.jsx)(p.A,{onClick:()=>{s("/create-new-supervisor")},size:"small",variant:"contained",color:"primary",children:"Assign Supervisor"})})]}),sx:{mb:2},children:(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)(i.Ay,{container:!0,spacing:4,children:[(0,S.jsx)(i.Ay,{item:!0,md:3,xl:3,children:(0,S.jsx)(x.eu,{name:"projectId",label:"Project",InputLabelProps:{shrink:!0},menus:n,onChange:e=>{var s,t;z(null===e||void 0===e||null===(s=e.target)||void 0===s||null===(t=s.value)||void 0===t?void 0:t.split())},required:!0})}),(0,S.jsx)(i.Ay,{item:!0,md:3,xl:3,children:(0,S.jsx)(x.eu,{name:"oraganizationType",label:"Organization Type",InputLabelProps:{shrink:!0},menus:b,onChange:e=>{var s;l(null===e||void 0===e||null===(s=e.target)||void 0===s?void 0:s.value)},required:!0})}),(0,S.jsx)(i.Ay,{item:!0,md:3,xl:3,children:(0,S.jsx)(x.eu,{name:"oraganizationId",label:"Organization Name",InputLabelProps:{shrink:!0},menus:u?I:[],onChange:e=>{var s;y(null===e||void 0===e||null===(s=e.target)||void 0===s?void 0:s.value)},required:!0})}),(0,S.jsx)(i.Ay,{item:!0,md:3,xl:3}),(0,S.jsx)(i.Ay,{item:!0,md:3,xl:3,children:(0,S.jsx)(x.eu,{name:"supervisorSelected",label:"Search Supervisor",InputLabelProps:{shrink:!0},menus:f?r:[],onChange:e=>{var s;O("userSelected"),o(),d(null===e||void 0===e||null===(s=e.target)||void 0===s?void 0:s.value)},required:!1})}),(0,S.jsx)(i.Ay,{item:!0,md:.5,xl:.5,sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,S.jsx)(c.A,{children:"OR"})}),(0,S.jsx)(i.Ay,{item:!0,md:3,xl:3,children:(0,S.jsx)(x.eu,{name:"userSelected",label:"Search User",InputLabelProps:{shrink:!0},menus:f?t:[],onChange:e=>{var s;O("supervisorSelected"),d(),o(null===e||void 0===e||null===(s=e.target)||void 0===s?void 0:s.value)},required:!1})})]})})})})})};var f=t(22149),I=t(71826);const b=e=>{let{refreshPagination:s,deleteId:t,setOpenDeleteModal:a,fetchUsers:n}=e;const o=(0,g.mN)({resolver:(0,h.t)(v.Ik().shape({dateTo:A.A.other})),mode:"all"}),{handleSubmit:d,setValue:l}=o;(0,r.useEffect)((()=>{l("dateTo",(new Date).toISOString().slice(0,10))}),[l]);return(0,S.jsx)(x.Op,{methods:o,onSubmit:d((async e=>{e.isActive="0",(await(0,I.default)("/supervisor-assignments-update",{method:"PUT",body:e,params:t})).success&&(o.reset(),n(),a(!1),s())})),children:(0,S.jsxs)(i.Ay,{container:!0,spacing:3,sx:{p:2},children:[(0,S.jsx)(i.Ay,{item:!0,md:12,sx:{fontSize:22,fontWeight:"bold"},children:"Delete Supervisor Assignment"}),(0,S.jsx)(i.Ay,{item:!0,md:12,children:(0,S.jsx)(x.o3,{name:"dateTo",label:"Deletion Date",type:"date",required:!1,InputLabelProps:{shrink:!0}})}),(0,S.jsxs)(i.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[(0,S.jsx)(p.A,{size:"small",variant:"outlined",onClick:()=>a(!1),children:"Cancel"}),(0,S.jsx)(p.A,{size:"small",type:"submit",variant:"contained",children:"Delete"})]})]})})};var z=t(99635),D=t(89649),O=t(29024),w=t(12006);const C=()=>{var e,s;const[t,c]=(0,r.useState)(!1),[p,v]=(0,r.useState)(!1),[m,g]=(0,r.useState)(!1),[h,x]=(0,r.useState)(null),[j,A]=(0,r.useState)(null),{paginations:{pageSize:I,pageIndex:C,forceUpdate:H},refreshPagination:P,setPageIndex:T,setPageSize:k}=(0,D.A)(),[U,E]=(0,r.useState)(),[N,F]=(0,r.useState)(),[L,M]=(0,r.useState)(""),[q,R]=(0,r.useState)(""),[V,B]=(0,r.useState)(""),[G,W]=(0,r.useState)(null),K=(0,a.wA)();(0,r.useEffect)((()=>{K((0,O.uiG)()),K((0,O.VOH)("ORGANIZATION TYPE"))}),[K]);const Y=(0,r.useCallback)((()=>{q&&V&&(K((0,O.loF)({organizationId:V,projectId:q,supervision:!0})),K((0,O.hCS)({projectId:q,organizationId:V})))}),[K,q,V]);(0,r.useEffect)((()=>{Y()}),[Y]),(0,r.useEffect)((()=>{L&&K((0,O.d8s)(L))}),[K,L]);const{projectsDropdown:Z}=(0,u.Y)(),_=null===Z||void 0===Z?void 0:Z.projectsDropdownObject,{masterMakerOrgType:$}=(0,d.$)(),J=null===$||void 0===$?void 0:$.masterObject;(0,r.useEffect)((()=>{null!==h&&void 0!==h&&h.id&&K((0,w.A)({pageIndex:C,pageSize:I,recordId:null===h||void 0===h?void 0:h.id,listType:2}))}),[K,C,I,H,h]),(0,r.useEffect)((()=>{U&&K((0,w.d)({pageIndex:C,pageSize:I,userId:U,listType:1}))}),[K,C,I,U,H]),(0,r.useEffect)((()=>{N&&K((0,w.d)({pageIndex:C,pageSize:I,supervisorId:N,listType:1}))}),[K,C,I,N,H]);const{supervisorAssignments:Q,supervisorAssignmentHistory:X}=(0,f.c)(),{organizationsDropdown:ee}=(0,l.G)(),se=null===ee||void 0===ee?void 0:ee.organizationDropdownObject,{users:te,supervisorUsers:re}=(0,o.k)(),ae=(null===re||void 0===re||null===(e=re.supervisorUsersObject)||void 0===e?void 0:e.rows)||[],ne=(null===te||void 0===te||null===(s=te.usersObject)||void 0===s?void 0:s.rows)||[],{supervisorAssignmentData:ie,supervisorAssignmentCount:oe}=(0,r.useMemo)((()=>{var e,s;return{supervisorAssignmentData:(null===(e=Q.supervisorAssignmentsObject)||void 0===e?void 0:e.rows)||[],supervisorAssignmentCount:(null===(s=Q.supervisorAssignmentsObject)||void 0===s?void 0:s.count)||0,isLoading:Q.loading||!1}}),[Q]),{historyData:de,historyCounts:le}=(0,r.useMemo)((()=>{var e,s;return{historyData:(null===X||void 0===X||null===(e=X.supervisorAssignmentHistoryObject)||void 0===e?void 0:e.rows)||[],historyCounts:(null===X||void 0===X||null===(s=X.supervisorAssignmentHistoryObject)||void 0===s?void 0:s.count)||0,isLoading:(null===X||void 0===X?void 0:X.loading)||!1}}),[X]),ue=(0,r.useMemo)((()=>[{Header:"Supervisor",accessor:"supervisor.name"},{Header:"User",accessor:"user.name"},{Header:"Applicable Date",accessor:"dateFrom"}]),[]),ce=(0,r.useMemo)((()=>[{Header:"User",accessor:"user.name"},{Header:"Supervisor",accessor:"supervisor.name"},{Header:"Applicable Date",accessor:"dateFrom"}]),[]),pe=(0,r.useMemo)((()=>[{Header:"User",accessor:"user.name"},{Header:"Supervisor",accessor:"supervisor.name"},{Header:"Date From",accessor:"dateFrom"},{Header:"Date To",accessor:"dateTo"},{Header:"Status",accessor:"isActive"},{Header:"Updated On",accessor:"updatedAt"},{Header:"Updated By",accessor:"updated.name"},{Header:"Created On",accessor:"createdAt"},{Header:"Created By",accessor:"created.name"}]),[]),ve={refreshPagination:P,deleteId:j,setOpenDeleteModal:v,fetchUsers:Y};return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(y,{refreshPagination:P,setRefresh:()=>{W(null)},organizationNameData:se,setSelectedOrganizationType:M,selectedOrganizationType:L,organizationTypeData:J,setSelectedOrganizationName:B,selectedOrganizationName:V,selectedUser:U,setSelectedUser:E,setSelectedSupervisor:F,setSelectedProject:R,usersData:ne,projectData:_,supervisorData:ae,showAdd:t,setShowAdd:c,...G&&{data:G}}),(U||N)&&(0,S.jsx)(z.default,{hideHeader:!0,hideViewIcon:!0,hideHistoryIcon:!U,hideEditIcon:!0,data:ie,count:oe,columns:U?ce:ue,setPageIndex:T,setPageSize:k,pageIndex:C,pageSize:I,handleRowDelete:e=>{A(e),v(!0)},handleRowHistory:e=>{x(e),g(!0)}}),(0,S.jsx)(n.A,{open:p,onClose:()=>v(!1),scroll:"paper",maxWidth:"xs",disableEscapeKeyDown:!0,children:(0,S.jsx)(b,{...ve})}),(0,S.jsx)(n.A,{open:m,onClose:()=>g(!1),scroll:"paper",disableEscapeKeyDown:!0,minWidth:"xl",children:(0,S.jsx)(i.Ay,{container:!0,children:(0,S.jsx)(i.Ay,{item:!0,xs:12,children:(0,S.jsx)(z.default,{isHistory:!0,title:"Supervisor Assignment",data:de,columns:pe,count:le,hideActions:!0,hideSearch:!0,hideAddButton:!0,hideExportButton:!0,setPageIndex:T,setPageSize:k,pageIndex:C,pageSize:I})})})})]})}}}]);