"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[4766],{94766:(e,r,t)=>{t.r(r),t.d(r,{default:()=>H});var a=t(9950),l=t(96583),o=t(27081),d=t(29024),s=t(80733),n=t(12257),i=t(4139),c=t(67535),u=t(60666),v=t(9449),p=t(26473),m=t(71826),y=t(96951),h=t(14351),b=t(84601),f=t(62054),j=t(4840),g=t(44414);const x=e=>{const r=(0,o.wA)(),[t,l]=(0,a.useState)(),{data:s,view:x,update:A,setRefresh:I,selectedProject:S,setSelectedProject:P,setSelectedRuralId:E,refreshPagination:C,projectData:w,setSelectedParentId:L,user:H}=e,D="577b8900-b333-42d0-b7fb-347abc3f0b5c"===(null===H||void 0===H?void 0:H.id)||"57436bed-c176-4625-96af-aaeec88cdc90"===(null===H||void 0===H?void 0:H.id)?[{name:"Approved",id:"Approved"},{name:"Unapproved",id:"Unapproved"}]:[{name:"Unapproved",id:"Unapproved"}],N=(0,v.mN)({resolver:(0,p.t)(u.Ik().shape({name:b.A.other,code:b.A.other,urbanHierarchyId:b.A.other,projectId:b.A.other,approvalStatus:b.A.other})),defaultValues:{},mode:"all"}),{handleSubmit:O,setValue:k,getValues:B,clearErrors:R}=N,T=(0,a.useCallback)((()=>{I();const e=B();N.reset({name:"",code:"",projectId:e.projectId,urbanHierarchyId:e.urbanHierarchyId,approvalStatus:""})}),[I,N,B]);(0,a.useEffect)((()=>{var e,r;(s||T(),x||A)&&(k("urbanHierarchyId",s.urbanHierarchyId),k("projectId",null===s||void 0===s||null===(e=s.urban_hierarchy)||void 0===e?void 0:e.projectId),k("approvalStatus",null===s||void 0===s?void 0:s.approvalStatus),r=s,Object.entries(r).forEach((e=>{let[r,t]=e;k(r,t)})));R()}),[s,A,x,k,R,T]),(0,a.useEffect)((()=>{if(S&&null!==H&&void 0!==H&&H.id){const e="577b8900-b333-42d0-b7fb-347abc3f0b5c"===(null===H||void 0===H?void 0:H.id)||"57436bed-c176-4625-96af-aaeec88cdc90"===(null===H||void 0===H?void 0:H.id)?"":null===H||void 0===H?void 0:H.id;r((0,d.HmN)({projectId:S,userId:e}))}}),[r,S]);const{ruralProjects:z}=(0,j.Y)(),{ruralData:U}=(0,a.useMemo)((()=>{var e;return{ruralData:(null===z||void 0===z||null===(e=z.ruralProjectsObject)||void 0===e?void 0:e.rows)||[]}}),[z]),{ruralLevelParents:_}=(0,j.Y)(),{ruralLevelParentsData:M}=(0,a.useMemo)((()=>{var e,r;return{ruralLevelParentsData:(null===(e=_.ruralLevelParentsObject)||void 0===e||null===(r=e.rows)||void 0===r?void 0:r.map((e=>({id:e.id,name:`${e.name} - ${e.id}`}))))||[],isLoading:_.loading||!1}}),[_]),V=(e,r,t,a,l,o)=>(0,g.jsx)(n.A,{children:(0,g.jsx)(y.eu,{name:e,label:r,onChange:a,InputLabelProps:{shrink:!0},menus:t,...l&&{required:!0},...x||A?{disable:o}:{}})}),Y=function(e,r,t,a){let l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(0,g.jsx)(n.A,{spacing:1,children:(0,g.jsx)(y.o3,{name:e,type:t,label:r,InputLabelProps:{shrink:l},...a&&{required:!0},...x?{disabled:!0}:A?{disabled:!1}:{}})})};return(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(y.Op,{methods:N,onSubmit:O((async e=>{let r;if(r=A?await(0,m.default)("/rural-level-entry-update",{method:"PUT",body:e,params:s.id}):await(0,m.default)("/rural-level-entry-form",{method:"POST",body:e}),r.success){const e=A?"Level Entry updated successfully!":"Level Entry added successfully!";(0,f.A)(e,{variant:"success",autoHideDuration:1e4}),I(),C()}else{var t,a;(0,f.A)((null===(t=r)||void 0===t||null===(a=t.error)||void 0===a?void 0:a.message)||"Operation failed. Please try again.",{variant:"error"})}})),children:(0,g.jsxs)(h.A,{title:(x?"View ":A?"Update ":"Add ")+"Rural Level Entry",sx:{mb:2},children:[(0,g.jsxs)(i.Ay,{container:!0,spacing:4,alignItems:"center",children:[(0,g.jsx)(i.Ay,{item:!0,md:3,xl:2,children:V("projectId","Project Name",w,(e=>{var r;P(null===e||void 0===e||null===(r=e.target)||void 0===r?void 0:r.value)}),!0,!0)}),(0,g.jsx)(i.Ay,{item:!0,md:3,xl:2,children:V("urbanHierarchyId","Level Name","577b8900-b333-42d0-b7fb-347abc3f0b5c"===(null===H||void 0===H?void 0:H.id)||"57436bed-c176-4625-96af-aaeec88cdc90"===(null===H||void 0===H?void 0:H.id)?U:U.slice(1),(e=>{var t;E(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value);const a=U.find((r=>{var t;return r.rank+1==(null===(t=e.target)||void 0===t?void 0:t.rank)}));l(null===a||void 0===a?void 0:a.name),L(null===a||void 0===a?void 0:a.id),r((0,d.YG8)({listType:1,ruralId:null===a||void 0===a?void 0:a.id}))}),!0,!0)}),t&&(0,g.jsx)(i.Ay,{item:!0,md:6,xl:4,children:V("parentId",`Select ${t}`,M,!0,!0)}),(0,g.jsx)(i.Ay,{item:!0,md:3,xl:2,children:V("approvalStatus","Select Status",D,(e=>{var r;k("approvalStatus",null===e||void 0===e||null===(r=e.target)||void 0===r?void 0:r.value)}),!0,!1)}),(0,g.jsx)(i.Ay,{item:!0,md:3,xl:2,children:Y("name","Entry Name","text",!0,!1)}),(0,g.jsx)(i.Ay,{item:!0,md:3,xl:2,children:Y("code","Entry Code","text",!0,!1)})]}),(0,g.jsx)(i.Ay,{container:!0,spacing:2,alignItems:"end",sx:{mt:1},children:(0,g.jsx)(i.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px"},children:x?(0,g.jsx)(c.A,{onClick:T,size:"small",variant:"outlined",color:"primary",children:"Back"}):A?(0,g.jsxs)(i.Ay,{item:!0,sx:{display:"flex",gap:"20px"},children:[(0,g.jsx)(c.A,{size:"small",type:"submit",variant:"contained",color:"primary",children:"Update"}),(0,g.jsx)(c.A,{onClick:T,size:"small",variant:"outlined",color:"primary",children:"Back"})]}):(0,g.jsx)(i.Ay,{item:!0,sx:{display:"flex",gap:"20px"},children:(0,g.jsx)(c.A,{size:"small",type:"submit",variant:"contained",color:"primary",children:"Save"})})})})]})})})};var A=t(99635),I=t(64499),S=t(89649),P=t(39225),E=t(65920),C=t(30423),w=t(52867),L=t(33507);const H=()=>{const{paginations:{pageSize:e,pageIndex:r,forceUpdate:t},refreshPagination:n,setPageIndex:i,setPageSize:c}=(0,S.A)(),{searchString:u,setSearchString:v,accessorsRef:p,setAccessors:y,forceSearch:h,searchStringTrimmed:b}=(0,P.A)(),H=(0,o.wA)(),[D,N]=(0,a.useState)(""),[O,k]=(0,a.useState)(""),[B,R]=(0,a.useState)(!1),[T,z]=(0,a.useState)(!1),[U,_]=(0,a.useState)(!1),[M,V]=(0,a.useState)(null),[Y,F]=(0,a.useState)(null),[$,q]=(0,a.useState)(null),[G,J]=(0,a.useState)(1),[K,Q]=(0,a.useState)(null),[W,Z]=(0,a.useState)(!1),[X,ee]=(0,a.useState)(!1),[re,te]=(0,a.useState)(null),[ae,le]=(0,a.useState)(null),{user:oe}=(0,L.A)();(0,a.useEffect)((()=>{H((0,d.uiG)())}),[H]);const{filterObjectForApi:de}=(0,C.bZ)(),se=(0,E.A)(de),ne=(0,E.A)(re);(0,a.useEffect)((()=>{[[se,de],[ne,re]].some(w.$H)?n():D&&H((0,d.Lsj)({pageIndex:r,pageSize:e,listType:G,ruralId:D,...b&&{searchString:b,accessors:JSON.stringify(p.current)},sortBy:null===re||void 0===re?void 0:re[0],sortOrder:null===re||void 0===re?void 0:re[1],filterObject:de}))}),[H,r,e,G,D,t,b,re,p,h,se,de,ne,n]),(0,a.useEffect)((()=>{null!==M&&void 0!==M&&M.id&&H((0,d.ffA)({pageIndex:r,pageSize:e,listType:G,recordId:null===M||void 0===M?void 0:M.id}))}),[H,r,e,t,G,M]);const{projectsDropdown:ie}=(0,s.Y)(),ce=null===ie||void 0===ie?void 0:ie.projectsDropdownObject,{ruralLevelProjects:ue,ruralLevelEntryHistory:ve}=(0,j.Y)(),{ruralLevelData:pe,ruralCount:me}=(0,a.useMemo)((()=>{var e,r;return{ruralLevelData:(null===(e=ue.ruralLevelProjectsObject)||void 0===e?void 0:e.rows)||[],ruralCount:(null===(r=ue.ruralLevelProjectsObject)||void 0===r?void 0:r.count)||0,isLoading:ue.loading||!1}}),[ue]),{historyLevelEntryData:ye,historyLevelEntryCounts:he}=(0,a.useMemo)((()=>{var e,r;return{historyLevelEntryData:(null===(e=ve.ruralLevelEntryHistoryObject)||void 0===e?void 0:e.rows)||[],historyLevelEntryCounts:(null===(r=ve.ruralLevelEntryHistoryObject)||void 0===r?void 0:r.count)||0,isLoading:ve.loading||!1}}),[ve]),be=(0,a.useMemo)((()=>[{Header:"Entry ID",accessor:"id",filterProps:{tableName:"ruralEntry",getColumn:"id",customAccessor:"id",projectId:ae,levelId:D}},{Header:"Entry Name",accessor:"name",filterProps:{tableName:"ruralEntry",getColumn:"name",customAccessor:"name",projectId:ae,levelId:D}},{Header:"Entry Code",accessor:"code",filterProps:{tableName:"ruralEntry",getColumn:"code",customAccessor:"code",projectId:ae,levelId:D}},{Header:"Parent ID",accessor:e=>{var r;return null===(r=e.parent)||void 0===r?void 0:r.id},exportAccessor:"parent.id",filterProps:{tableName:"ruralEntry",getColumn:"parent_id",customAccessor:"parentId",projectId:ae,levelId:D}},{Header:"Parent Name",accessor:e=>{var r;return null===(r=e.parent)||void 0===r?void 0:r.name},exportAccessor:"parent.name",filterProps:{tableName:"ruralEntry",getColumn:"name",customAccessor:"parentName",projectId:ae,levelId:O}},{Header:"Approval Status",accessor:"approvalStatus",exportAccessor:"approval_status",filterProps:{tableName:"ruralEntry",getColumn:"approval_status",customAccessor:"approvalStatus",projectId:ae,levelId:D}},{Header:"Updated On",accessor:"updatedAt"},{Header:"Updated By",accessor:"updated.name",filterProps:{tableName:"ruralEntry",getColumn:"updated_by",customAccessor:"updatedBy",projectId:ae,levelId:D}},{Header:"Created On",accessor:"createdAt"},{Header:"Created By",accessor:"created.name",filterProps:{tableName:"ruralEntry",getColumn:"created_by",customAccessor:"createdBy",projectId:ae,levelId:D}}]),[D,ae,O]),fe=()=>{Z(!1),ee(!1),Q(null)};return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(x,{refreshPagination:n,selectedProject:ae,setSelectedProject:le,setSelectedRuralId:N,setSelectedParentId:k,projectData:ce,setRefresh:fe,user:oe,...K&&{data:K},...W&&{view:W,update:!1},...X&&{update:X,view:!1}}),D&&(0,g.jsx)(A.default,{hideAddButton:!0,hideImportButton:!1,data:pe,columns:be,count:me,setPageIndex:i,setPageSize:c,pageIndex:r,pageSize:e,handleRowRestore:async e=>{q(e),z(!0)},handleRowDelete:async e=>{F(e),R(!0)},handleRowUpdate:e=>{ee(!0),Z(!1),Q(e)},handleRowHistory:e=>{V(e),_(!0)},handleRowView:e=>{Z(!0),ee(!1),Q(e)},listType:G,setListType:e=>{J(e),fe()},searchConfig:{searchString:u,searchStringTrimmed:b,setSearchString:v,setAccessors:y},sortConfig:{sort:re,setSort:te},importConfig:{apiBody:{projectId:ae,levelId:D,parentId:O,tableName:"urban_level_entries"}},exportConfig:{tableName:"rural_level_entries",fileName:"rural-level-entry",apiQuery:{listType:G,urbanId:D,filterObject:de}},setSelectedParentId:k,disableDeleteIcon:"577b8900-b333-42d0-b7fb-347abc3f0b5c"!==(null===oe||void 0===oe?void 0:oe.id)&&"57436bed-c176-4625-96af-aaeec88cdc90"!==(null===oe||void 0===oe?void 0:oe.id),componentFrom:"rural-level-entry"}),(0,g.jsx)(I.A,{open:B,handleClose:()=>R(!1),handleConfirm:async()=>{const e=await(0,m.default)("/delete-rural-level-entry",{method:"DELETE",params:Y});var r;e.success?(n(),R(!1)):(0,f.A)(null===e||void 0===e||null===(r=e.error)||void 0===r?void 0:r.message)},title:"Confirm Delete",message:"Are you sure you want to delete?",confirmBtnTitle:"Delete"}),(0,g.jsx)(I.A,{open:T,handleClose:()=>z(!1),handleConfirm:async()=>{const e={...$,isActive:"1"};(await(0,m.default)("/rural-level-entry-update",{method:"PUT",body:e,params:e.id})).success&&(n(),z(!1))},title:"Confirm Restore",message:"Are you sure you want to restore?",confirmBtnTitle:"Restore"}),(0,g.jsx)(l.A,{open:U,onClose:()=>_(!1),scroll:"paper",disableEscapeKeyDown:!0,maxWidth:"lg",children:(0,g.jsx)(A.default,{isHistory:!0,title:null===M||void 0===M?void 0:M.name,data:ye,columns:be,count:he,hideActions:!0,hideSearch:!0,hideAddButton:!0,hideExportButton:!0,setPageIndex:i,setPageSize:c,pageIndex:r,pageSize:e})})]})}}}]);