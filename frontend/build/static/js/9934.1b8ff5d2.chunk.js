"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[9934],{69934:(e,l,a)=>{a.r(l),a.d(l,{default:()=>E});var t=a(9950),r=a(9449),n=a(26473),d=a(60666),o=a(27081),i=a(87233),s=a(67535),u=a(4139),v=a(8008),m=a(14351),c=a(84601),p=a(89649),g=a(99635),y=a(96951),f=a(29024),h=a(80733),I=a(76300),x=a(71826),j=a(88848),b=a(30304),S=a(44414);const A=[{id:"gaa",name:"GAA"}];const E=function(){var e,l,a,E,T,L,k,C,w,$;const{paginations:{pageSize:P,pageIndex:D},setPageIndex:_,setPageSize:F}=(0,p.A)(),[q,O]=(0,t.useState)(!1),[M,R]=(0,t.useState)(null),[z,N]=(0,t.useState)(null),[V,G]=(0,t.useState)(null===(e=A[0])||void 0===e?void 0:e.id),[Y,B]=(0,t.useState)(!1),[H,J]=(0,t.useState)(null),[W,X]=(0,t.useState)(-1),[K,Q]=(0,t.useState)(),[U,Z]=(0,t.useState)([]),ee=d.Ik().shape({projectId:c.A.other,formTypeId:c.A.formType,formId:c.A.form,mdmPayloadStatusId:c.A.other,...Array.from({length:10}).reduce(((e,l,a)=>(e[`gaaLevelEntryId${a}`]=d.YO().test("required-test","This field is required",((e,l)=>{var t;return!(l.path.includes("gaaLevelEntryId0")||(null===z||void 0===z||null===(t=z[a])||void 0===t?void 0:t.rank)<=W)||e&&e.length>0})),e)),{})}),le=(0,r.mN)({resolver:(0,n.t)(ee),defaultValues:{gaaLevelEntryId0:[]},mode:"all"}),{handleSubmit:ae,watch:te,setValue:re,getValues:ne,formState:{errors:de}}=le,[oe,ie,se,ue,ve,me]=te(["projectId","formTypeId","formId","mdmPayloadStatusId","dateFrom","dateTo"]),{masterMakerOrgType:ce}=(0,j.$)(),pe=null===ce||void 0===ce?void 0:ce.masterObject,ge=(0,v.r)(),ye=(null===ge||void 0===ge||null===(l=ge.mdmDataSyncReport)||void 0===l||null===(a=l.mdmDataSyncReportObject)||void 0===a?void 0:a.columns)||[],fe=null===ge||void 0===ge||null===(E=ge.mdmDataSyncReport)||void 0===E?void 0:E.loading,he=null===(T=(0,h.Y)())||void 0===T||null===(L=T.projectsDropdown)||void 0===L?void 0:L.projectsDropdownObject,Ie=(null===ge||void 0===ge?void 0:ge.mdmPayloadStatus.mdmPayloadStatusObject)||[],{webforms:xe}=(0,I.I)(),je=(null===(k=pe.find((e=>e.id===ie)))||void 0===k?void 0:k.name)||"",be=(null===Ie||void 0===Ie||null===(C=Ie.find((e=>e.id===ue)))||void 0===C?void 0:C.name)||"",Se=function(e,l,a,t,r){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];return(0,S.jsx)(y.o3,{name:e,disabled:!1,type:a,label:l,InputLabelProps:{shrink:n},...r&&{required:!0},defaultValue:t})},Ae=(null===xe||void 0===xe||null===(w=xe.webformDataObject)||void 0===w||null===($=w.rows)||void 0===$?void 0:$.filter((e=>e.isPublished&&e.form_attributes instanceof Array)).map((e=>({id:e.id,name:e.name,tableName:e.tableName}))))||[],Ee=(0,o.wA)();(0,t.useEffect)((()=>{se&&Ee((0,f.TMz)({formId:se}))}),[se,Ee]);const Te=(0,t.useCallback)((e=>{Q(!0),e=structuredClone(e);let l={},a=!1;if(z){var t;for(let a=(null===z||void 0===z?void 0:z.length)-1;a>=0;a--){var r;if(null!==(r=e[`gaaLevelEntryId${a}`])&&void 0!==r&&r.length){l[`${z[a].columnName}`]=e[`gaaLevelEntryId${a}`];break}}null!==(t=e.gaaLevelEntryId0)&&void 0!==t&&t.length||(le.setError("gaaLevelEntryId0",{message:"This field is required"},{shouldFocus:!0}),a=!0);for(let l=1;l<z.length;l++){var n;const{rank:t}=z[l];t<=W&&(null===(n=e[`gaaLevelEntryId${l}`])||void 0===n||!n.length)&&(le.setError(`gaaLevelEntryId${l}`,{message:"This field is required"},{shouldFocus:!0}),a=!0)}}if(a)return void Q(!1);J(l);const d={projectId:oe,formId:se,formType:je,pageSize:P,pageIndex:D,mdmPayloadStatus:be,gaaLevelDetails:l,dateFrom:ve,dateTo:me,setIsLoading:Q,setReportsData:Z};null!==oe&&void 0!==oe&&oe.length&&JSON.stringify(d)!==JSON.stringify(M)?(R(d),Ee((0,f.aIm)(d))):Q(!1)}),[z,oe,se,je,P,D,be,ve,me,M,Ee,le,W]);(0,t.useEffect)((()=>{if(!oe||!ie||!se||!ue||!q)return;const e=ne();Te(e)}),[se,ie,ne,ue,Te,oe,q]),(0,t.useEffect)((()=>{Ee((0,f.uiG)()),Ee((0,f.VOH)("FORM_TYPES"))}),[Ee,oe]),(0,t.useEffect)((()=>{oe&&ie&&Ee((0,f.XXG)({projectId:oe,typeId:ie.replace(" - O&M",""),accessSource:"Form Responses"}))}),[Ee,ie,oe]);const Le=(0,t.useCallback)((async()=>{B(!0);const e=await(0,x.default)("/area-project-level",{method:"GET",params:se,query:{formId:se,sort:["rank","ASC"]}});if(e.success){const{data:a,accessRank:t}=e.data;var l;if(X(t),a)N(null===(l=a[0])||void 0===l?void 0:l.gaaLevels);else N(null)}B(!1)}),[se]);(0,t.useEffect)((()=>{se&&Le()}),[se,Le]);const ke=(0,t.useCallback)(((e,l)=>{var a;const t=l-1;return null!==(a=te())&&void 0!==a&&a[`gaaLevelEntryId${t}`]?e.gaa_level_entries.filter((e=>{var l,a;return null===(l=te())||void 0===l||null===(a=l[`gaaLevelEntryId${t}`])||void 0===a?void 0:a.includes(null===e||void 0===e?void 0:e.parentId)})):e.gaa_level_entries}),[te]);(0,t.useEffect)((()=>{Ee(K?(0,b.vL)():(0,b.xv)())}),[Ee,K,U,fe]);const Ce=(0,t.useCallback)(((e,l,a,t,r)=>{(a=structuredClone(a))[`gaaLevelEntryId${e}`]=r;let n=e;for(;n<(t?l.length-1:l.length);){var d,o,i;const e=`gaaLevelEntryId${n+1}`,t=`gaaLevelEntryId${n}`,r=l[n+1],s=null!==(d=a)&&void 0!==d&&d[t]&&null!==r&&void 0!==r&&r.gaa_level_entries?null===r||void 0===r||null===(o=r.gaa_level_entries)||void 0===o?void 0:o.filter((e=>{var l;return(null===(l=a)||void 0===l?void 0:l[t])===(null===e||void 0===e?void 0:e.parentId)})):(null===r||void 0===r?void 0:r.gaa_level_entries)||[],u=Array.isArray(a[e])&&(null===(i=a[e])||void 0===i?void 0:i.filter((e=>s.some((l=>l.id===e)))))||[];re(e,u),a[e]=u,n+=1}}),[re]);return(0,S.jsxs)(m.A,{title:"MDM Data Sync Report",children:[(0,S.jsx)(y.Op,{methods:le,onSubmit:ae((()=>{O(!0)})),children:(0,S.jsxs)(u.Ay,{container:!0,spacing:4,mb:3,children:[(0,S.jsx)(u.Ay,{item:!0,md:3,xl:3,children:(0,S.jsx)(y.eu,{name:"projectId",label:"Project",menus:he||[],required:!0,onChange:()=>{re("formTypeId",""),re("formId",""),Z([]),O(!1)}})}),(0,S.jsx)(u.Ay,{item:!0,md:3,xl:3,children:(0,S.jsx)(y.eu,{name:"formTypeId",label:"Form Type",menus:pe,required:!0,onChange:()=>{re("formId",""),Z([]),O(!1)}})}),(0,S.jsx)(u.Ay,{item:!0,md:3,xl:3,children:(0,S.jsx)(y.eu,{name:"formId",label:"Type",menus:Ae||[],required:!0,onChange:()=>{Z([]),O(!1)}})}),(0,S.jsx)(u.Ay,{item:!0,xs:3,md:3,children:(0,S.jsx)(y.eu,{name:"mdmPayloadStatusId",label:"MDM Payload Status",menus:Ie||[],required:!0,onChange:()=>{Z([]),O(!1)}})}),(0,S.jsx)(u.Ay,{item:!0,md:3,xl:3,children:(0,S.jsx)(y.eu,{name:"hierarchyType",label:"Hierarchy Type",menus:A,required:!1,onChange:e=>{var l;return G(null===e||void 0===e||null===(l=e.target)||void 0===l?void 0:l.value)},defaultValue:A[0].id})}),"gaa"===V&&se&&(null===z||void 0===z?void 0:z.length)>0&&(null===z||void 0===z?void 0:z.map(((e,l)=>{var a,t,r;return(0,S.jsx)(u.Ay,{item:!0,md:3,xl:3,children:(0,S.jsx)(y.Yq,{required:0===l||e.rank<=W,name:`gaaLevelEntryId${l}`,label:e.name,onChange:Ce.bind(null,l,z,te(),!0),menus:ke(e,l),disable:0!==l&&e.rank>W&&!(null!==(a=te())&&void 0!==a&&null!==(t=a["gaaLevelEntryId"+(l-1)])&&void 0!==t&&t.length),errorMessage:null===(r=de[`gaaLevelEntryId${l}`])||void 0===r?void 0:r.message})},e.id)}))),(0,S.jsx)(u.Ay,{item:!0,md:3,xl:3,children:Se("dateFrom","Date From","date")}),(0,S.jsx)(u.Ay,{item:!0,md:3,xl:3,children:Se("dateTo","Date To","date")}),(0,S.jsx)(u.Ay,{item:!0,xs:12,sx:{mt:2,display:"flex",justifyContent:"flex-end",gap:"20px"},children:(0,S.jsx)(s.A,{disabled:Y,type:"submit",size:"small",variant:"contained",color:"primary",children:"Proceed"})})]})}),q&&(0,S.jsx)(S.Fragment,{children:(0,S.jsx)(g.default,{hideColumnsSelect:!0,hideSearch:!0,hideAddButton:!0,loadingCondition:fe,title:"MDM Data Sync Report",data:U||[],count:(null===U||void 0===U?void 0:U.length)||0,setPageIndex:_,setPageSize:F,pageIndex:D,pageSize:P,normalDate:!0,columns:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter((e=>{let{type:l}=e;return!["image","file","blob"].includes(l)})).map((e=>{var l,a,t,r;let n=structuredClone(e);"date"===n.type&&("dateOnly"===(null===(l=n)||void 0===l||null===(a=l.properties)||void 0===a?void 0:a.pickerType)||null===(t=n)||void 0===t||null===(r=t.properties)||void 0===r||r.pickerType);return n={...n,disableSortBy:!0},"checkbox"===n.type?{...n,accessor:e=>null===e||void 0===e?void 0:e[n.accessor]}:"network"===n.type?{...n,minWidth:550,Cell:e=>{var l,a;const t=null===e||void 0===e||null===(l=e.row)||void 0===l||null===(a=l.original)||void 0===a?void 0:a[n.accessor];if(t){const e=t.replace(/;/g,"<br />").replaceAll(",",", ").replaceAll(":",": ");return(0,S.jsx)(i.A,{dangerouslySetInnerHTML:{__html:e}})}return(0,S.jsx)(S.Fragment,{})}}:"location"===n.type?{...n,accessor:e=>{var l;return null===e||void 0===e||null===(l=e[n.accessor])||void 0===l?void 0:l.replaceAll(",",", ")},Cell:e=>{var l,a;const t=null===e||void 0===e||null===(l=e.row)||void 0===l||null===(a=l.original)||void 0===a?void 0:a[n.accessor];if(t){var r,d,o;const e=t.split(","),l=null===(r=e[0])||void 0===r?void 0:r.trim(),a=null===(d=e[1])||void 0===d?void 0:d.trim(),n=null===(o=e[2])||void 0===o?void 0:o.trim();return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{style:{minWidth:200},children:`${l}, ${a}`}),(0,S.jsx)("div",{children:n}),(0,S.jsx)(s.A,{onClick:()=>{window.open(`https://maps.google.com?q=${l},${a}`)},size:"small",variant:"outlined",color:"primary",children:"View"})]})}return(0,S.jsx)(S.Fragment,{})}}:n}))}(ye),hideActions:!0,exportConfig:{tableName:"form-responses",apiBody:{gaaLevelFilter:H,projectId:oe,formId:se,formType:je,pageSize:P,pageIndex:D,mdmPayloadStatus:be,dateFrom:ve,dateTo:me,isExport:!0},apiRoute:"/form-export-form-responses"}})})]})}}}]);