"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[4122],{74122:(e,t,a)=>{a.r(t),a.d(t,{default:()=>S});var r=a(9950),o=a(27081),n=a(4139),i=a(67535),l=a(60666),s=a(9449),d=a(26473),u=a(28429),c=a(29024),m=a(80415),v=a(88848),h=a(96951),p=a(14351),g=a(99635),f=a(71826),I=a(62054),y=a(47501),x=a(52351),L=a(44414);const b=[{Header:"Name",accessor:"material.name"},{Header:"Code",accessor:"material.code"},{Header:"Quantity",accessor:"quantity"},{Header:"UOM",accessor:"uom.name"}],S=()=>{const[e,t]=(0,r.useState)([]),[a,S]=(0,r.useState)([]),[j,A]=(0,r.useState)(!1),[k,T]=(0,r.useState)(m.j7.pageIndex),[q,w]=(0,r.useState)(m.j7.pageSize),[C,N]=(0,r.useState)([]),[z,_]=(0,r.useState)(!1),O=(0,u.Zp)(),D=(0,s.mN)({resolver:(0,d.t)(l.Ik().shape({})),defaultValues:{},mode:"all"}),H=(0,o.wA)();(0,r.useEffect)((()=>{H((0,c._G1)()),H((0,c.uiG)())}),[H]);const{masterMakerLovs:M}=(0,v.$)(),P=((e,t)=>{const a=e&&e.filter((e=>e.name===t));return a&&a.length?a[0].id:void 0})(M.masterMakerLovsObject.rows,"CANCELLTL"),{handleSubmit:E}=D,F=e=>{if(e&&e.length>0){return e.map((e=>e.serialNumber))}return[]},G=e=>{let t=[];return e&&e.length>0&&e.map((e=>t.push(e.id))),t};return(0,r.useEffect)((()=>{null!==C&&void 0!==C&&C.length&&(t(C.filter((e=>e.quantity>0))),S(C.filter((e=>e.quantity<0)).map((e=>({...e,quantity:Math.abs(e.quantity)})))))}),[C]),(0,L.jsxs)(L.Fragment,{children:[z&&(0,L.jsx)(x.A,{}),(0,L.jsx)(h.Op,{methods:D,onSubmit:E((async()=>{var t,r,o;_(!0);const n=(()=>{var t,r,o,n;const i=[];return a.map((e=>{i.push({transactionTypeId:P,projectId:e.projectId,requestNumber:e.referenceDocumentNumber,organizationId:null===e||void 0===e?void 0:e.organizationId,storeId:null===e||void 0===e?void 0:e.storeId,storeLocationId:null===e||void 0===e?void 0:e.storeLocationId,otherStoreId:null===e||void 0===e?void 0:e.otherStoreId,otherStoreLocationId:null===e||void 0===e?void 0:e.otherStoreLocationId,materialId:e.materialId,uomId:e.uomId,quantity:Math.abs(e.quantity),rate:e.rate,value:e.value,tax:e.tax,serialNumber:F(e.material_serial_numbers)})})),{transactionTypeId:P,transactionCreatedAt:null===(t=e[0])||void 0===t?void 0:t.createdAt,fromStoreLocationId:null===(r=e[0])||void 0===r?void 0:r.storeLocationId,ltlIds:G(C),ltlLedgerDetailId:null===e||void 0===e||null===(o=e[0])||void 0===o||null===(n=o.stock_ledger_detail)||void 0===n?void 0:n.id,stock_ledgers:i}})(),i=await(0,f.default)("/cancel-ltl-transaction-create",{method:"POST",body:n});var l;if(!i.success)return(0,I.A)((null===i||void 0===i||null===(l=i.error)||void 0===l?void 0:l.message)||"Operation failed. Please try again!",{variant:"error"}),void _(!1);const s=null!==(t=null===(r=i.data)||void 0===r?void 0:r.data)&&void 0!==t?t:{},d=s.referenceDocumentNumber||(null===(o=s[0])||void 0===o?void 0:o.referenceDocumentNumber);(0,I.A)(d?`Transaction cancelled with reference number: ${d}`:"Transaction cancelled successfully!",{variant:"success",autoHideDuration:1e4}),_(!1),O("/stock-ledger")})),children:(0,L.jsxs)(p.A,{title:"Cancel LTL(Location To Location)",sx:{mb:2},children:[(0,L.jsx)(y.A,{type:"stockLedger",transactionType:"LTL",fromStoreLabel:"Organization Store",showOrgType:!0,showFromStoreAddress:!0,disableAll:!(null===C||void 0===C||!C.length),setReqData:N}),e&&e.length>0&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(g.default,{title:"Cancel LTL",hideHeader:!0,hidePagination:!0,data:null===e||void 0===e?void 0:e.filter((e=>e.quantity>0)),count:e.length,columns:b,hideActions:!0,setPageIndex:T,setPageSize:w,pageIndex:k,pageSize:q}),(0,L.jsx)(n.Ay,{item:!0,md:12,xl:2,sx:{mt:4},children:(0,L.jsxs)(n.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px"},children:[(0,L.jsx)(i.A,{onClick:()=>{A(!j),t([]),N(void 0),O("/cancel-ltl")},size:"small",variant:"outlined",color:"primary",children:"Back"}),(0,L.jsx)(i.A,{disabled:z,size:"small",type:"submit",variant:"contained",color:"primary",children:"Reverse"})]})})]})]})})]})}}}]);