"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[4011],{74011:(e,t,a)=>{a.r(t),a.d(t,{default:()=>D});var r=a(9950),s=a(96583),l=a(27081),i=a(29024),o=a(80733),n=a(12257),d=a(4139),c=a(87233),u=a(67535),p=a(97539),m=a(14341),h=a(60666),j=a(9449),x=a(26473),v=a(71826),g=a(4840),y=a(96951),f=a(14351),A=a(84601),b=a(62054),S=a(44414);const C=e=>{const{data:t,view:a,update:o,setRefresh:C,refreshPagination:I,selectedProject:P,setSelectedProject:w,projectData:k}=e,[L,O]=(0,r.useState)(!1),[H,D]=(0,r.useState)(!1),N=(0,j.mN)({resolver:(0,x.t)(h.Ik().shape({name:A.A.other,code:A.A.other,rank:A.A.other,projectId:A.A.project})),defaultValues:{},mode:"all"}),z=(0,j.mN)({defaultValues:{},mode:"all"}),{handleSubmit:R,setValue:T,clearErrors:E,getValues:M}=N,B=(0,r.useCallback)((()=>{C();const e=M();N.reset({name:"",projectId:e.projectId})}),[C,N,M]);(0,r.useEffect)((()=>{var e;t||B(),(a||o)&&(T("projectId",t.projectId),e=t,Object.entries(e).forEach((e=>{let[t,a]=e;T(t,a)}))),E()}),[t,o,a,T,E,B]);const U=(0,l.wA)();(0,r.useEffect)((()=>{P&&U((0,i.HmN)({projectId:P}))}),[U,P,H]);const{ruralProjects:V}=(0,g.Y)(),{ruralData:_}=(0,r.useMemo)((()=>{var e;return{ruralData:(null===V||void 0===V||null===(e=V.ruralProjectsObject)||void 0===e?void 0:e.rows)||[]}}),[V]),Y=(e,t,r,s,l,i)=>(0,S.jsx)(n.A,{children:(0,S.jsx)(y.eu,{name:e,label:t,disable:i,onChange:s,InputLabelProps:{shrink:!0},menus:r,...l&&{required:!0},...a||o?{disable:!0}:{}})}),F=function(e,t,r,s){let l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(0,S.jsx)(n.A,{spacing:1,children:(0,S.jsx)(y.o3,{name:e,type:r,label:t,InputLabelProps:{shrink:l},...s&&{required:!0},...a?{disabled:!0}:o?{disabled:!1}:{}})})};return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(y.Op,{methods:N,onSubmit:R((async e=>{let a;if(delete e.isMapped,e.levelType="rural",a=o?await(0,v.default)("/rural-hierarchies-update",{method:"PUT",body:e,params:t.id}):await(0,v.default)("/rural-hierarchies-form",{method:"POST",body:e}),a.success){const e=o?"Level updated successfully!":"Level added successfully!";(0,b.A)(e,{variant:"success",autoHideDuration:1e4}),B(),I()}else{var r,s;(0,b.A)((null===(r=a)||void 0===r||null===(s=r.error)||void 0===s?void 0:s.message)||"Operation failed. Please try again.",{variant:"error"})}})),children:(0,S.jsxs)(f.A,{title:(0,S.jsxs)(d.Ay,{container:!0,xl:12,spacing:2,sx:{justifyContent:"space-between",alignItems:"center"},children:[(0,S.jsx)(d.Ay,{item:!0,xl:3,md:3,children:(0,S.jsx)(c.A,{variant:"h4",children:(a?"View ":o?"Update ":"Add ")+"Rural Level"})}),P&&!a&&!o&&(0,S.jsx)(d.Ay,{item:!0,md:2,xl:2,sx:{display:"flex",justifyContent:"flex-end"},children:(0,S.jsx)(u.A,{onClick:()=>O(!0),size:"small",variant:"contained",color:"primary",children:"Set Mapping Column"})})]}),sx:{mb:2},children:[(0,S.jsxs)(d.Ay,{container:!0,spacing:4,alignItems:"center",children:[(0,S.jsx)(d.Ay,{item:!0,md:3,xl:2,children:Y("projectId","Project Name",k,(e=>{var t;w(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value)}),!0)}),(0,S.jsx)(d.Ay,{item:!0,md:3,xl:2,children:F("name","Level Name","text",!0)}),(0,S.jsx)(d.Ay,{item:!0,md:3,xl:2,children:F("code","Level Code","text",!0)}),(0,S.jsx)(d.Ay,{item:!0,md:3,xl:2,children:F("rank","Rank","number",!0)})]}),(0,S.jsx)(d.Ay,{container:!0,spacing:2,alignItems:"end",sx:{mt:1},children:(0,S.jsx)(d.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px"},children:a?(0,S.jsx)(u.A,{onClick:B,size:"small",variant:"outlined",color:"primary",children:"Back"}):o?(0,S.jsxs)(d.Ay,{item:!0,sx:{display:"flex",gap:"20px"},children:[(0,S.jsx)(u.A,{size:"small",type:"submit",variant:"contained",color:"primary",children:"Update"}),(0,S.jsx)(u.A,{onClick:B,size:"small",variant:"outlined",color:"primary",children:"Back"})]}):(0,S.jsx)(d.Ay,{item:!0,sx:{display:"flex",gap:"20px"},children:(0,S.jsx)(u.A,{size:"small",type:"submit",variant:"contained",color:"primary",children:"Save"})})})})]})}),(0,S.jsx)(s.A,{open:L,onClose:()=>O(!1),scroll:"paper",disableEscapeKeyDown:!0,children:(0,S.jsx)(y.Op,{methods:z,onSubmit:z.handleSubmit((async e=>{let t;if(e.projectId=P,e.isMapped=1,t=await(0,v.default)("/rural-hierarchies-update",{method:"PUT",body:e,params:e.mappingColumn}),t.success){const e="Mapping column updated successfully!";(0,b.A)(e,{variant:"success",autoHideDuration:1e4}),D(!H),O(!1)}else{var a,r;(0,b.A)((null===(a=t)||void 0===a||null===(r=a.error)||void 0===r?void 0:r.message)||"Operation failed. Please try again.",{variant:"error"})}})),children:(0,S.jsxs)(d.Ay,{container:!0,spacing:3,sx:{p:2},children:[(0,S.jsx)(d.Ay,{item:!0,md:12,sx:{fontSize:22,fontWeight:"bold"},children:"Rural - Urban Mapping"}),(0,S.jsx)(d.Ay,{item:!0,md:6,xl:6,children:(0,S.jsxs)(n.A,{spacing:1,children:[(0,S.jsx)(c.A,{children:"Project Name"}),(0,S.jsx)(p.A,{value:k&&k.find((e=>e.id===P))||null,options:k,disabled:!0,disableClearable:!0,getOptionLabel:e=>e.name,renderInput:e=>(0,S.jsx)(m.A,{...e})})]})}),(0,S.jsx)(d.Ay,{item:!0,md:6,xl:6,children:Y("mappingColumn","Mapping Column",_)}),(0,S.jsxs)(d.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[(0,S.jsx)(u.A,{size:"small",variant:"outlined",onClick:()=>O(!1),children:"Cancel"}),(0,S.jsx)(u.A,{size:"small",type:"submit",variant:"contained",children:"Save"})]})]})})})]})};var I=a(99635),P=a(64499),w=a(89649),k=a(39225),L=a(30423),O=a(65920),H=a(52867);const D=()=>{const{paginations:{pageSize:e,pageIndex:t,forceUpdate:a},refreshPagination:n,setPageIndex:d,setPageSize:c}=(0,w.A)(),{searchString:u,setSearchString:p,accessorsRef:m,setAccessors:h,forceSearch:j,searchStringTrimmed:x}=(0,k.A)(),y=(0,l.wA)(),[f,A]=(0,r.useState)(""),[D,N]=(0,r.useState)(!1),[z,R]=(0,r.useState)(!1),[T,E]=(0,r.useState)(!1),[M,B]=(0,r.useState)(null),[U,V]=(0,r.useState)(null),[_,Y]=(0,r.useState)(null),[F,q]=(0,r.useState)(1),[K,W]=(0,r.useState)(null),[G,J]=(0,r.useState)(!1),[Q,Z]=(0,r.useState)(!1),[$,X]=(0,r.useState)(null);(0,r.useEffect)((()=>{y((0,i.uiG)())}),[y]);const{filterObjectForApi:ee}=(0,L.bZ)(),te=(0,O.A)(ee),ae=(0,O.A)($);(0,r.useEffect)((()=>{[[te,ee],[ae,$]].some(H.$H)?n():f&&y((0,i.HmN)({pageIndex:t,pageSize:e,listType:F,projectId:f,...x&&{searchString:x,accessors:JSON.stringify(m.current)},sortBy:null===$||void 0===$?void 0:$[0],sortOrder:null===$||void 0===$?void 0:$[1],filterObject:ee}))}),[y,t,e,F,f,x,$,m,j,a,n,te,ee,ae]),(0,r.useEffect)((()=>{null!==M&&void 0!==M&&M.id&&y((0,i.tng)({pageIndex:t,pageSize:e,listType:F,recordId:null===M||void 0===M?void 0:M.id}))}),[y,t,e,a,F,M]);const{projectsDropdown:re}=(0,o.Y)(),se=null===re||void 0===re?void 0:re.projectsDropdownObject,{ruralProjects:le,ruralHistory:ie}=(0,g.Y)(),{data:oe,count:ne}=(0,r.useMemo)((()=>{var e,t;return{data:(null===(e=le.ruralProjectsObject)||void 0===e?void 0:e.rows)||[],count:(null===(t=le.ruralProjectsObject)||void 0===t?void 0:t.count)||0,isLoading:le.loading||!1}}),[le]),{historyData:de,historyCounts:ce}=(0,r.useMemo)((()=>{var e,t;return{historyData:(null===(e=ie.ruralHistoryObject)||void 0===e?void 0:e.rows)||[],historyCounts:(null===(t=ie.ruralHistoryObject)||void 0===t?void 0:t.count)||0,isLoading:ie.loading||!1}}),[ie]),ue=(0,r.useMemo)((()=>[{Header:"Level ID",accessor:"id",filterProps:{tableName:"ruralLevel",getColumn:"id",customAccessor:"id",projectId:f}},{Header:"Level Name",accessor:"name",filterProps:{tableName:"ruralLevel",getColumn:"name",customAccessor:"name",projectId:f}},{Header:"Level Code",accessor:"code",filterProps:{tableName:"ruralLevel",getColumn:"code",customAccessor:"code",projectId:f}},{Header:"Rank",accessor:"rank",filterProps:{tableName:"ruralLevel",getColumn:"rank",customAccessor:"rank",projectId:f}},{Header:"Mapping",accessor:e=>0==e.isMapped?"-":"Yes",exportAccessor:"isMapped"},{Header:"Updated On",accessor:"updatedAt"},{Header:"Updated By",accessor:"updated.name",filterProps:{tableName:"ruralLevel",getColumn:"updated_by",customAccessor:"updatedBy",projectId:f}},{Header:"Created On",accessor:"createdAt",projectId:f},{Header:"Created By",accessor:"created.name",filterProps:{tableName:"ruralLevel",getColumn:"created_by",customAccessor:"createdBy",projectId:f}}]),[f]),pe=()=>{J(!1),Z(!1),W(null)};return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(C,{refreshPagination:n,selectedProject:f,setSelectedProject:A,setRefresh:pe,projectData:se,...K&&{data:K},...G&&{view:G,update:!1},...Q&&{update:Q,view:!1}}),f&&(0,S.jsx)(I.default,{hideAddButton:!0,hideRestoreIcon:!0,hideDeleteIcon:!0,hideType:!0,hideSearch:!0,data:oe,columns:ue,count:ne,setPageIndex:d,setPageSize:c,pageIndex:t,pageSize:e,handleRowRestore:async e=>{Y(e),R(!0)},handleRowDelete:e=>{V(e),N(!0)},handleRowUpdate:e=>{Z(!0),J(!1),W(e)},handleRowHistory:e=>{B(e),E(!0)},handleRowView:e=>{J(!0),Z(!1),W(e)},listType:F,setListType:e=>{q(e),pe()},searchConfig:{searchString:u,searchStringTrimmed:x,setSearchString:p,setAccessors:h},sortConfig:{sort:$,setSort:X,defaultSort:["rank","ASC"]},exportConfig:{tableName:"rural_hierarchies",fileName:"rural-level",apiQuery:{listType:F,projectId:f,filterObject:ee}}}),(0,S.jsx)(P.A,{open:D,handleClose:()=>N(!1),handleConfirm:async()=>{const e=await(0,v.default)("/delete-rural-hierarchies",{method:"DELETE",params:U});var t;e.success?(n(),N(!1)):(0,b.A)(null===e||void 0===e||null===(t=e.error)||void 0===t?void 0:t.message)},title:"Confirm Delete",message:"Are you sure you want to delete?",confirmBtnTitle:"Delete"}),(0,S.jsx)(P.A,{open:z,handleClose:()=>R(!1),handleConfirm:async()=>{const e={..._,isActive:"1"};(await(0,v.default)("/rural-hierarchies-update",{method:"PUT",body:e,params:e.id})).success&&(n(),R(!1))},title:"Confirm Restore",message:"Are you sure you want to restore?",confirmBtnTitle:"Restore"}),(0,S.jsx)(s.A,{open:T,onClose:()=>E(!1),scroll:"paper",disableEscapeKeyDown:!0,maxWidth:"lg",children:(0,S.jsx)(I.default,{isHistory:!0,title:null===M||void 0===M?void 0:M.name,data:de,columns:ue,count:ce,hideActions:!0,hideSearch:!0,hideAddButton:!0,hideExportButton:!0,setPageIndex:d,setPageSize:c,pageIndex:t,pageSize:e})})]})}}}]);