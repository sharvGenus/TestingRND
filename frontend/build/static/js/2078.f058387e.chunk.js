"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[2078],{22078:(e,t,a)=>{a.r(t),a.d(t,{default:()=>H});var r=a(9950),s=a(96583),o=a(27081),n=a(29024),i=a(80733),l=a(55851),d=a(12257),c=a(4139),u=a(67535),p=a(60666),m=a(9449),h=a(26473),v=a(71826),g=a(96951),j=a(14351),y=a(84601),f=a(62054),b=a(44414);const x=e=>{const{data:t,view:a,update:s,setRefresh:o,setSelectedProject:n,projectData:i,refreshPagination:l}=e,x=(0,m.mN)({resolver:(0,h.t)(p.Ik().shape({name:y.A.other,code:y.A.other,rank:y.A.other,projectId:y.A.project})),defaultValues:{},mode:"all"}),{handleSubmit:A,setValue:S,clearErrors:C,getValues:I}=x,w=(0,r.useCallback)((()=>{o();const e=I();x.reset({name:"",projectId:e.projectId})}),[o,x,I]);(0,r.useEffect)((()=>{var e;t||w(),(a||s)&&(S("projectId",t.project.id),e=t,Object.entries(e).forEach((e=>{let[t,a]=e;S(t,a)}))),C()}),[t,s,a,S,C,w]);const P=function(e,t,r,o){let n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(0,b.jsx)(d.A,{spacing:1,children:(0,b.jsx)(g.o3,{name:e,type:r,label:t,InputLabelProps:{shrink:n},...o&&{required:!0},...a?{disabled:!0}:s?{disabled:!1}:{}})})};return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(g.Op,{methods:x,onSubmit:A((async e=>{let a;if(e.levelType="urban",a=s?await(0,v.default)("/urban-hierarchies-update",{method:"PUT",body:e,params:t.id}):await(0,v.default)("/urban-hierarchies-form",{method:"POST",body:e}),a.success){const e=s?"Level updated successfully!":"Level added successfully!";(0,f.A)(e,{variant:"success",autoHideDuration:1e4}),o(),l()}else{var r,n;(0,f.A)((null===(r=a)||void 0===r||null===(n=r.error)||void 0===n?void 0:n.message)||"Operation failed. Please try again.",{variant:"error"})}})),children:(0,b.jsx)(j.A,{title:(a?"View ":s?"Update ":"Add ")+"Urban Level",sx:{mb:2},children:(0,b.jsxs)(c.Ay,{container:!0,spacing:4,children:[(0,b.jsx)(c.Ay,{item:!0,md:3,xl:2,children:(k="projectId",L="Project Name",H=i,O=e=>{var t;n(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value)},T=!0,(0,b.jsx)(d.A,{children:(0,b.jsx)(g.eu,{name:k,label:L,onChange:O,InputLabelProps:{shrink:!0},menus:H,...T&&{required:!0},...a||s?{disable:!0}:{}})}))}),(0,b.jsx)(c.Ay,{item:!0,md:3,xl:2,children:P("name","Level Name","text",!0)}),(0,b.jsx)(c.Ay,{item:!0,md:3,xl:2,children:P("code","Level Code","text",!0)}),(0,b.jsx)(c.Ay,{item:!0,md:3,xl:2,children:P("rank","Rank","number",!0)}),(0,b.jsx)(c.Ay,{container:!0,spacing:2,alignItems:"end",sx:{mt:1},children:(0,b.jsx)(c.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px"},children:a?(0,b.jsx)(u.A,{onClick:w,size:"small",variant:"outlined",color:"primary",children:"Back"}):s?(0,b.jsxs)(c.Ay,{item:!0,sx:{display:"flex",gap:"20px"},children:[(0,b.jsx)(u.A,{size:"small",type:"submit",variant:"contained",color:"primary",children:"Update"}),(0,b.jsx)(u.A,{onClick:w,size:"small",variant:"outlined",color:"primary",children:"Back"})]}):(0,b.jsx)(c.Ay,{item:!0,sx:{display:"flex",gap:"20px"},children:(0,b.jsx)(u.A,{size:"small",type:"submit",variant:"contained",color:"primary",children:"Save"})})})})]})})})});var k,L,H,O,T};var A=a(99635),S=a(64499),C=a(89649),I=a(39225),w=a(30423),P=a(65920),k=a(52867);const L=["rank","ASC"],H=()=>{const{paginations:{pageSize:e,pageIndex:t,forceUpdate:a},refreshPagination:d,setPageIndex:c,setPageSize:u}=(0,C.A)(),p=(0,o.wA)(),[m,h]=(0,r.useState)(""),[g,j]=(0,r.useState)(!1),[y,H]=(0,r.useState)(!1),[O,T]=(0,r.useState)(!1),[R,D]=(0,r.useState)(null),[B,N]=(0,r.useState)(null),[z,E]=(0,r.useState)(null),[U,V]=(0,r.useState)(1),[_,q]=(0,r.useState)(null),[F,M]=(0,r.useState)(!1),[G,J]=(0,r.useState)(!1),[K,Q]=(0,r.useState)(L),{searchString:W,setSearchString:X,accessorsRef:Y,setAccessors:Z,forceSearch:$,searchStringTrimmed:ee}=(0,I.A)();(0,r.useEffect)((()=>{p((0,n.uiG)())}),[p]),(0,r.useEffect)((()=>{null!==R&&void 0!==R&&R.id&&p((0,n.Xg8)({pageIndex:t,pageSize:e,listType:U,recordId:null===R||void 0===R?void 0:R.id}))}),[p,t,e,a,U,R]);const{filterObjectForApi:te}=(0,w.bZ)(),ae=(0,P.A)(te),re=(0,P.A)(K);(0,r.useEffect)((()=>{[[ae,te],[re,K]].some(k.$H)?d():m&&p((0,n.nqG)({pageIndex:t,pageSize:e,listType:U,projectId:m,...ee&&{searchString:ee,accessors:JSON.stringify(Y.current)},sortBy:null===K||void 0===K?void 0:K[0],sortOrder:null===K||void 0===K?void 0:K[1],filterObject:te}))}),[p,t,e,U,m,a,ee,K,Y,$,ae,te,re,d]);const{projectsDropdown:se}=(0,i.Y)(),oe=null===se||void 0===se?void 0:se.projectsDropdownObject,{urbanProjects:ne,urbanHistory:ie}=(0,l.H)(),{data:le,count:de}=(0,r.useMemo)((()=>{var e,t;return{data:(null===(e=ne.urbanProjectsObject)||void 0===e?void 0:e.rows)||[],count:(null===(t=ne.urbanProjectsObject)||void 0===t?void 0:t.count)||0,isLoading:ne.loading||!1}}),[ne]),{historyData:ce,historyCounts:ue}=(0,r.useMemo)((()=>{var e,t;return{historyData:(null===(e=ie.urbanHistoryObject)||void 0===e?void 0:e.rows)||[],historyCounts:(null===(t=ie.urbanHistoryObject)||void 0===t?void 0:t.count)||0,isLoading:ie.loading||!1}}),[ie]),pe=(0,r.useMemo)((()=>[{Header:"Level ID",accessor:"id",filterProps:{tableName:"urbanLevel",getColumn:"id",customAccessor:"id",projectId:m}},{Header:"Level Name",accessor:"name",filterProps:{tableName:"urbanLevel",getColumn:"name",customAccessor:"name",projectId:m}},{Header:"Level Code",accessor:"code",filterProps:{tableName:"urbanLevel",getColumn:"code",customAccessor:"code",projectId:m}},{Header:"Rank",accessor:"rank",filterProps:{tableName:"urbanLevel",getColumn:"rank",customAccessor:"rank",projectId:m}},{Header:"Updated On",accessor:"updatedAt"},{Header:"Updated By",accessor:"updated.name",filterProps:{tableName:"urbanLevel",getColumn:"updated_by",customAccessor:"updatedBy",projectId:m}},{Header:"Created On",accessor:"createdAt"},{Header:"Created By",accessor:"created.name",filterProps:{tableName:"urbanLevel",getColumn:"created_by",customAccessor:"createdBy",projectId:m}}]),[m]),me=()=>{M(!1),J(!1),q(null)};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(x,{refreshPagination:d,selectedProject:m,setSelectedProject:h,setRefresh:me,projectData:oe,..._&&{data:_},...F&&{view:F,update:!1},...G&&{update:G,view:!1}}),m&&(0,b.jsx)(A.default,{hideDeleteIcon:!0,hideRestoreIcon:!0,hideAddButton:!0,hideType:!0,hideSearch:!0,hideImportButton:!0,data:le,columns:pe,count:de,setPageIndex:c,setPageSize:u,pageIndex:t,pageSize:e,handleRowRestore:async e=>{E(e),H(!0)},handleRowDelete:e=>{N(e),j(!0)},handleRowUpdate:e=>{"rural"!==e.levelType?(J(!0),M(!1),q(e)):(0,f.A)("Update action is not allowed for Rural mapping level.",{variant:"warning"})},handleRowHistory:e=>{D(e),T(!0)},handleRowView:e=>{M(!0),J(!1),q(e)},listType:U,setListType:e=>{V(e),me()},searchConfig:{searchString:W,searchStringTrimmed:ee,setSearchString:X,setAccessors:Z},sortConfig:{sort:K,setSort:Q,defaultSort:L},exportConfig:{tableName:"urban_hierarchies",fileName:"urban-level",apiQuery:{listType:U,projectId:m,filterObject:te}}}),(0,b.jsx)(S.A,{open:g,handleClose:()=>j(!1),handleConfirm:async()=>{const e=await(0,v.default)("/delete-urban-hierarchies",{method:"DELETE",params:B});var t;e.success?(d(),j(!1)):(0,f.A)(null===e||void 0===e||null===(t=e.error)||void 0===t?void 0:t.message)},title:"Confirm Delete",message:"Are you sure you want to delete?",confirmBtnTitle:"Delete"}),(0,b.jsx)(S.A,{open:y,handleClose:()=>H(!1),handleConfirm:async()=>{const e={...z,isActive:"1"};(await(0,v.default)("/urban-hierarchies-update",{method:"PUT",body:e,params:e.id})).success&&(d(),H(!1))},title:"Confirm Restore",message:"Are you sure you want to restore?",confirmBtnTitle:"Restore"}),(0,b.jsx)(s.A,{open:O,onClose:()=>T(!1),scroll:"paper",disableEscapeKeyDown:!0,maxWidth:"lg",children:(0,b.jsx)(A.default,{isHistory:!0,title:null===R||void 0===R?void 0:R.name,data:ce,columns:pe,count:ue,hideActions:!0,hideSearch:!0,hideAddButton:!0,hideExportButton:!0,setPageIndex:c,setPageSize:u,pageIndex:t,pageSize:e})})]})}}}]);