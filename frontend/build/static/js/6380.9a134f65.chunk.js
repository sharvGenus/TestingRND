"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[6380],{46380:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Q});var r=o(9950),a=o(27081),l=o(53065),i=o(57073),n=o(4139),s=o(67535),d=o(36089),u=o(26592),c=o(28429),v=o(62375),m=o(26473),x=o(60666),S=o(12257),p=o(87233),g=o(9449),f=o(29024),I=o(96951),j=o(14351),y=o(84601),h=o(60845),b=o(52867),A=o(80733),L=o(88848),k=o(55519),O=o(79033),M=o(3147),T=o(12952),z=o(66004),N=o(90376),w=o(44414);const C=e=>{var t,o,l,i,d;let{disableAll:u,saveData:c}=e;const[v,C]=(0,r.useState)(""),[q,E]=(0,r.useState)(null),[F,_]=(0,r.useState)(null),[D,P]=(0,r.useState)(null),[H,V]=(0,r.useState)(!1),B=(0,g.mN)({resolver:(0,m.t)(x.Ik().shape({projectId:y.A.project,orgTypeId:y.A.organizationType,contractorStoreId:y.A.organizationStoreId,contractor:y.A.organizationId,roleId:y.A.requiredWithLabel("Role"),installerId:y.A.requiredWithLabel("Installer"),organizationStoreLocationId:y.A.requiredWithLabel("Organization Store Location")})),defaultValues:{},mode:"all"}),{handleSubmit:$,watch:R,setValue:G}=B,[U]=R(["projectId"]),Q=(0,a.wA)();(0,r.useEffect)((()=>{Q((0,f._G1)()),Q((0,f.uiG)())}),[Q]);const{projectsDropdown:W}=(0,A.Y)(),{masterMakerLovs:Y}=(0,L.$)(),J=((e,t)=>{const o=e&&e.filter((e=>e.name===t));return o&&o.length?o[0].id:void 0})(Y.masterMakerLovsObject.rows,"ITC"),Z=e=>{"projectId"===e&&(G("orgTypeId",null),G("contractor",null),G("contractorBranch",null),G("contractorStoreId",null),G("roleId",null),G("installerId",null),G("organizationStoreLocationId",null),C("")),"orgTypeId"===e&&(G("contractor",null),G("contractorBranch",null),G("contractorStoreId",null),G("roleId",null),G("installerId",null),G("organizationStoreLocationId",null),C("")),"contractor"===e&&(G("contractorBranch",null),G("contractorStoreId",null),G("roleId",null),G("installerId",null),G("organizationStoreLocationId",null),C("")),"contractorBranch"===e&&(G("contractorStoreId",null),G("roleId",null),G("installerId",null),G("organizationStoreLocationId",null),C("")),"contractorStoreId"===e&&(G("roleId",null),G("installerId",null),G("organizationStoreLocationId",null)),"roleId"===e&&(G("installerId",null),G("organizationStoreLocationId",null)),"installerId"===e&&G("organizationStoreLocationId",null)},{organizationsDropdown:X,organizationsLocationDropdown:K}=(0,k.G)(),{roleProjects:ee}=(0,O.z)(),te=(null===ee||void 0===ee||null===(t=ee.roleProjectsObject)||void 0===t?void 0:t.rows)||[],oe=null===W||void 0===W?void 0:W.projectsDropdownObject,{organizationStores:re}=(0,M.E)(),{firmStoreLocations:ae,companyStoreLocations:le}=(0,T.V)(),ie=[...(null===(o=re.organizationStoreObject)||void 0===o?void 0:o.rows)||[]],{users:ne}=(0,z.k)(),se=(null===X||void 0===X?void 0:X.organizationDropdownObject)||[],de=(null===K||void 0===K?void 0:K.organizationLocationDropdownObject)||[],ue=[...se],[ce,ve]=(0,r.useState)([]),me=(null===ae||void 0===ae||null===(l=ae.firmStoreLocationsObject)||void 0===l?void 0:l.rows)||[],xe=(null===le||void 0===le||null===(i=le.companyStoreLocationsObject)||void 0===i?void 0:i.rows)||[],Se=H?xe:me,pe=(null===(d=ne.usersObject)||void 0===d?void 0:d.rows)||[],ge=(e,t,o,r,a)=>(0,w.jsx)(S.A,{children:(0,w.jsx)(I.eu,{name:e,label:t,..."function"===typeof a&&{onChange:a},InputLabelProps:{shrink:!0},menus:o,...u&&{disable:!0},...r&&{required:!0}})});(0,r.useEffect)((()=>{U&&Q((0,f.PBN)({selectedProject:U}))}),[Q,U]);const{masterMakerOrgTypeSecond:{masterObject:fe}}=(0,L.$)();return(0,r.useEffect)((()=>{Q((0,f.rHZ)("ORGANIZATION TYPE"))}),[Q]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(j.A,{title:"Material Transfer Installer to Contractor",sx:{mb:2},children:(0,w.jsx)(I.Op,{methods:B,children:(0,w.jsxs)(n.Ay,{container:!0,spacing:4,children:[(0,w.jsx)(n.Ay,{item:!0,xs:12,sx:{textAlign:"right"},mt:-9,children:(0,w.jsx)(N.ON,{tableName:"itc",apipath:"/import-itc-transaction",forTraxns:!0})}),(0,w.jsx)(n.Ay,{item:!0,md:3,xl:2,children:ge("projectId","Project",oe,!0,(()=>{Z("projectId")}))}),(0,w.jsx)(n.Ay,{item:!0,md:3,xl:2,children:ge("orgTypeId","Organization Type",fe.filter((e=>"420e7b13-25fd-4d23-9959-af1c07c7e94b"===e.id||"decb6c57-6d85-4f83-9cc2-50e0630003df"===e.id)),!0,(e=>{var t,o,r,a,l,i,n;(Z("orgTypeId"),null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value)&&(Q((0,f.d8s)(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value)),Q((0,f.Ywh)(null===e||void 0===e||null===(r=e.target)||void 0===r?void 0:r.value)),Q((0,f.qV$)({organizationType:null===e||void 0===e||null===(a=e.target)||void 0===a?void 0:a.value})),"420e7b13-25fd-4d23-9959-af1c07c7e94b"===(null===e||void 0===e||null===(l=e.target)||void 0===l?void 0:l.value)?(G("isCompany",!0),V(!0),Q((0,h.Ru)({organizationType:null===e||void 0===e||null===(i=e.target)||void 0===i?void 0:i.value}))):(G("isCompany",!1),V(!1),Q((0,h.c1)({organizationType:null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value}))))}))}),(0,w.jsx)(n.Ay,{item:!0,md:3,xl:2,children:ge("contractor","Organization",(0,b.HF)(ue),!0,(e=>{var t;if(Z("contractor"),null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value){var o;_(e.target.value),E(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value);let t=de.filter((t=>t.parent&&null!==t.parent&&t.parent.id===e.target.value));ve(t)}}))}),(0,w.jsx)(n.Ay,{item:!0,md:3,xl:2,children:ge("contractorBranch","Organization Branch",(0,b.HF)(ce),!1,(e=>{var t;if(Z("contractorBranch"),null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value){var o,r,a;let t=null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.row;_(t&&t.parent&&null!==t.parent?null===t||void 0===t||null===(r=t.parent)||void 0===r?void 0:r.id:e.target.value),E(null===e||void 0===e||null===(a=e.target)||void 0===a?void 0:a.value)}}))}),(0,w.jsx)(n.Ay,{item:!0,md:3,xl:2,children:ge("contractorStoreId","Organization Store",ie.filter((e=>e.organizationId===q)),!0,(e=>{var t;if(Z("contractorStoreId"),null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value){var o;const t=((e,t)=>{const o=e&&e.filter((e=>e.id===t));return o&&o.length?o[0]:{}})(ie,e.target.value),r=t.city,a=(t.address,t.address),l=t.pincode?t.pincode:t.pinCode;C(`${a}, ${r.name}, ${r.state.name}, ${r.state.country.name}, ${l}`),P(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value)}}))}),(0,w.jsxs)(n.Ay,{item:!0,md:3,xl:2,children:[(0,w.jsx)(p.A,{children:"Address: "}),(0,w.jsx)(p.A,{mt:2,children:v})]}),(0,w.jsx)(n.Ay,{item:!0,md:3,xl:2,children:ge("roleId","Role",te,!0,(e=>{var t,o;(Z("roleId"),null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value)&&Q((0,f.loF)({organizationId:F,roleId:null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value}))}))}),(0,w.jsx)(n.Ay,{item:!0,md:3,xl:2,children:ge("installerId","From Installer",pe,!0,(()=>{Z("installerId")}))}),(0,w.jsx)(n.Ay,{item:!0,md:3,xl:3,children:ge("organizationStoreLocationId","Organization Store Location",Se.filter((e=>{var t,o;return e.organizationStoreId===D&&(null===e||void 0===e||null===(t=e.name)||void 0===t||null===(o=t.toLowerCase())||void 0===o?void 0:o.includes("receiving"))})),!0)}),(0,w.jsx)(n.Ay,{item:!0,md:3,xl:2,children:function(e,t,o,r){let a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(0,w.jsx)(S.A,{spacing:1,children:(0,w.jsx)(I.o3,{name:e,type:o,label:t,InputLabelProps:{shrink:a},...u&&{disabled:!0},...r&&{required:!0}})})}("remarks","Remarks","text",!1)}),!u&&(0,w.jsx)(n.Ay,{container:!0,spacing:4,children:(0,w.jsx)(n.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px"},mt:4,children:(0,w.jsx)(s.A,{size:"small",variant:"contained",onClick:$((e=>{e.orgId=F,e.contractorId=F,e.transactionTypeId=J,c(e)})),color:"primary",children:"Next"})})})]})})})})};var q=o(65669),E=o(14563),F=o(95615),_=o(62054),D=o(71826),P=o(62605),H=o(94826);const V={cursor:"pointer",fontSize:24},B=e=>{let{materials:t,onMaterailsInput:o,formData:l,selectedItems:i,view:d,update:u,showData:c,hideTaxDetails:v=!1}=e;const[S,h]=(0,r.useState)(!1),[A,k]=(0,r.useState)(null),[O,M]=(0,r.useState)(null),[z,N]=(0,r.useState)(c&&c.rate?null===c||void 0===c?void 0:c.rate:null),[C,B]=(0,r.useState)([]),[$,R]=(0,r.useState)(null),[G,U]=(0,r.useState)(""),[Q,W]=(0,r.useState)(""),[Y,J]=(0,r.useState)(null),[Z,X]=(0,r.useState)([]),[K,ee]=(0,r.useState)(!1),[te,oe]=(0,r.useState)(!1),[re,ae]=(0,r.useState)(!1),le=(0,a.wA)();(0,r.useEffect)((()=>{le((0,f._G1)())}),[le]);const{masterMakerLovs:ie}=(0,L.$)(),ne=ie.masterMakerLovsObject.rows,{firmStoreLocations:se,companyStoreLocations:de}=(0,T.V)(),ue=(0,b.x)(ne,"CONTRACTOR"),ce=(0,b.x)(ne,"COMPANY");(0,r.useEffect)((()=>{ue&&le((0,f.c1B)({organizationType:ue})),ce&&le((0,f.Ru7)({organizationType:ce}))}),[le,ue,ce]),(0,r.useEffect)((()=>{h(!!d)}),[d,u]);const ve=(0,g.mN)({resolver:(0,m.t)(x.Ik().shape({materialId:y.A.requiredWithLabel("Material"),quantity:te?y.A.checkForInteger("Quantity",O):y.A.maxQuantity(O,!0),fromStoreLocationId:y.A.fromStoreLocationId})),defaultValues:{},mode:"all"}),{handleSubmit:me,setValue:xe,reset:Se,watch:pe}=ve,ge=pe("uom");(0,r.useEffect)((()=>{var e;(d||u)&&c&&(ee(!0),R(c),le((0,f.a2o)({project:null===l||void 0===l?void 0:l.projectId,store:null===l||void 0===l?void 0:l.contractorStoreId,storeLocation:null===c||void 0===c?void 0:c.fromStoreLocationId,material:null===c||void 0===c?void 0:c.materialId,installerId:null===l||void 0===l?void 0:l.installerId})),le((0,f.J9T)({project:null===l||void 0===l?void 0:l.projectId,store:null===l||void 0===l?void 0:l.contractorStoreId,storeLocation:null===c||void 0===c?void 0:c.fromStoreLocationId,material:null===c||void 0===c?void 0:c.materialId,installer:null===l||void 0===l?void 0:l.installerId})),e=c,Object.entries(e).forEach((e=>{let[t,o]=e;"actions"!==t&&xe(t,o),"uom"===t&&xe(t,"string"===typeof o?o:o.name)})))}),[d,u,c,Se,xe,le,l]);const fe=(0,r.useMemo)((()=>{var e;return(null===se||void 0===se||null===(e=se.firmStoreLocationsObject)||void 0===e?void 0:e.rows)||[]}),[se]),Ie=(0,r.useMemo)((()=>{var e;return(null===de||void 0===de||null===(e=de.companyStoreLocationsObject)||void 0===e?void 0:e.rows)||[]}),[de]),je=(0,r.useMemo)((()=>[...fe,...Ie]||[]),[fe,Ie]);(0,r.useEffect)((()=>{if(je){const e=je.filter((e=>{var t,o;return e.id!==c.StoreLocationId&&(null===e||void 0===e||null===(t=e.name)||void 0===t||null===(o=t.toLowerCase())||void 0===o?void 0:o.includes("installer"))&&e.organizationStoreId===l.contractorStoreId}));B(e)}}),[je,l,c]);const ye=(e,t,o,r,a,l)=>(0,w.jsx)(I.eu,{name:e,label:t,onChange:a,InputLabelProps:{shrink:!0},menus:o,...l&&{disable:!0},...r&&{required:!0}}),he=function(e,t,o,r,a){let l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return(0,w.jsx)(I.o3,{name:e,type:o,label:t,..."function"===typeof a&&{handleChange:a},InputLabelProps:{shrink:i},...(l||S)&&{disabled:!0},...r&&{required:!0}})},[be,Ae]=(0,r.useState)([]),[Le,ke]=(0,r.useState)([]),[Oe,Me]=(0,r.useState)(!1),[Te,ze]=(0,r.useState)(!1),Ne=e=>{Ae(e)},we=()=>{Me(!1)},{txnByLocationMaterial:Ce,serialNumbers:qe}=(0,P.t)();let{projectSLData:Ee}=(0,r.useMemo)((()=>({projectSLData:(null===Ce||void 0===Ce?void 0:Ce.stocksObject)||[],isLoading:Ce.loading||!1})),[Ce]);(0,r.useEffect)((()=>{Ee&&X(Ee)}),[Ee]),(0,r.useEffect)((()=>{if(ae(!1),(null===Z||void 0===Z?void 0:Z.length)>0&&null!==Y){const e=null===Z||void 0===Z?void 0:Z[0],t=(null===$||void 0===$?void 0:$.id)+Y,o=null===i||void 0===i?void 0:i[t],r=(0,b.$G)(e.quantity),a=(null===o||void 0===o?void 0:o.quantity)||u&&(null===c||void 0===c?void 0:c.quantity)||0,l=(null===o||void 0===o?void 0:o.material_serial_numbers)||u&&(null===c||void 0===c?void 0:c.material_serial_numbers)||[];xe("qtyStk",r),xe("quantity",a),xe("rate",parseFloat(e.rate).toFixed(2)),xe("tax",e.tax),Ae(l),M(r),N(parseFloat(e.rate).toFixed(2)),null!==c&&void 0!==c&&c.quantity&&xe("value",parseFloat(e.rate*c.quantity).toFixed(2))}else xe("qtyStk",null!==Y?0:null),xe("rate","0"),N(0),xe("tax","0"),xe("value","0"),M(null)}),[Z,xe,i,u,$,Y,c]);const{serialNumbersData:Fe}=(0,r.useMemo)((()=>{var e;return{serialNumbersData:(null===qe||void 0===qe?void 0:qe.data)||[],countSN:(null===qe||void 0===qe||null===(e=qe.data)||void 0===e?void 0:e.count)||0}}),[qe]);return(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(j.A,{sx:{mb:2,pb:4},children:(0,w.jsxs)(I.Op,{methods:ve,children:[re&&(0,w.jsx)(H.A,{}),(0,w.jsxs)(n.Ay,{container:!0,spacing:2,sx:{mt:2},children:[(0,w.jsx)(n.Ay,{item:!0,xs:12,sm:4,children:ye("materialId","Material",(0,b.Jw)(t),!0,(e=>{var t;if(null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value){var o;let t=null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.row;xe("code",null===t||void 0===t?void 0:t.code),xe("uom",null===t||void 0===t?void 0:t.uomName),xe("fromStoreLocationId",null),J(null),xe("quantity",null),M(null),xe("qtyStk",null),R(t)}}),!!u)}),(0,w.jsx)(n.Ay,{item:!0,xs:12,sm:4,children:he("code","Code","text",!0,void 0,!0)}),(0,w.jsx)(n.Ay,{item:!0,xs:12,sm:4,children:ye("fromStoreLocationId","From Store Location",C,!0,(e=>{var t,o,r,a,i;null!==e&&void 0!==e&&null!==(t=e.target)&&void 0!==t&&t.value&&(ae(!0),Ae([]),ke([]),c.material_serial_numbers=[],xe("qtyStk","0"),M("0"),W(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.name),J(null===e||void 0===e||null===(r=e.target)||void 0===r?void 0:r.value),le((0,f.a2o)({project:null===l||void 0===l?void 0:l.projectId,store:null===l||void 0===l?void 0:l.contractorStoreId,storeLocation:null===e||void 0===e||null===(a=e.target)||void 0===a?void 0:a.value,material:null===$||void 0===$?void 0:$.id,installerId:null===l||void 0===l?void 0:l.installerId})),le((0,f.J9T)({project:null===l||void 0===l?void 0:l.projectId,store:null===l||void 0===l?void 0:l.contractorStoreId,storeLocation:null===e||void 0===e||null===(i=e.target)||void 0===i?void 0:i.value,material:null===$||void 0===$?void 0:$.id,installer:null===l||void 0===l?void 0:l.installerId})))}),!1)}),(0,w.jsx)(n.Ay,{item:!0,xs:12,sm:2,children:he("quantity","Quantity",(0,b.VF)(ge)?"text":"number",!0,(e=>{var t,o;(0,b.VF)(ge)?oe(!1):oe(!0),k(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value),xe("value",((null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value)*z).toFixed(2))}))}),(0,w.jsx)(n.Ay,{item:!0,xs:12,sm:2,children:he("qtyStk","Qty In Stock","number",!1,void 0,!0)}),(0,w.jsx)(n.Ay,{item:!0,xs:12,sm:2,children:he("uom","UOM","text",!0,void 0,!0)}),(0,w.jsx)(n.Ay,{item:!0,xs:12,sm:2,style:{display:"none"},children:he("uomId","UOMId","text",!0)}),(0,w.jsx)(n.Ay,{item:!0,xs:12,sm:2,...v&&{display:"none"},children:he("rate","Rate","text",!0,(e=>{var t;N(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value)}),!0)}),(0,w.jsx)(n.Ay,{item:!0,xs:12,sm:2,...v&&{display:"none"},children:he("tax","Tax%","text",!0,void 0,!0)}),(0,w.jsx)(n.Ay,{item:!0,xs:12,sm:2,...v&&{display:"none"},children:he("value","Value","number",!0,void 0,!0)}),(0,w.jsxs)(n.Ay,{item:!0,xs:12,sm:2,sx:{textAlign:"center"},children:[((null===$||void 0===$?void 0:$.isSerialNumber)||u&&(null===c||void 0===c?void 0:c.isSerialNumber))&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(p.A,{mb:-1,children:"SerialNumber"})," ",(0,w.jsx)("br",{})," ",(0,w.jsx)(s.A,{size:"small",onClick:()=>{ke(Fe[(null===$||void 0===$?void 0:$.id)||(null===c||void 0===c?void 0:c.materialId)]),ze(!0)},variant:"contained",color:"primary",children:"View"})]}),G&&""!==G&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("br",{}),(0,w.jsx)(p.A,{color:"error",sx:{fontSize:12,marginTop:2},children:G})]})]}),(0,w.jsx)(n.Ay,{item:!0,xs:12,sm:2,mt:4,textAlign:"right",children:!d&&(0,w.jsx)(s.A,{size:"small",onClick:me((async e=>{if($&&null!==$&&void 0!==$&&$.isSerialNumber&&0===be.length)U("Serial Number is required");else if($&&null!==$&&void 0!==$&&$.isSerialNumber&&be.length!==e.quantity)U(`Please select a total of ${e.quantity} serial numbers`);else{U(!1),be&&(e.material_serial_numbers=be),e.tax=0===e.tax?"0":e.tax,e.fromStoreLocationName=Q;const r=await(0,D.default)("/installation-check",{method:"POST",body:{projectId:l.projectId,installerOrgId:l.orgId,installerStoreId:l.contractorStoreId,isCompany:l.isCompany,materialId:e.materialId,...$.isSerialNumber&&{serialNumber:e.material_serial_numbers}}});var t;if(r.success&&(o(e,null===$||void 0===$?void 0:$.id,(null===$||void 0===$?void 0:$.id)+Y),Ae([]),ke([]),R(null),X([]),xe("qtyStk",null),M(null),ee(!1),Se()),r.error&&r.error.message)(0,_.A)((null===r||void 0===r||null===(t=r.error)||void 0===t?void 0:t.message)||"Operation failed. Please try again!",{variant:"error"})}})),variant:"contained",color:"primary",children:K?"Update":"Add"})})]}),(0,w.jsx)(q.A,{open:Oe,onClose:we,"aria-labelledby":"modal-modal-title",children:(0,w.jsx)(E.default,{handleCloseSerial:we,closeCss:V,quantity:A,setSerialNumbers:Ne})}),Te&&(0,w.jsx)(F.default,{open:Te,onClose:()=>{ze(!1)},maxQuantity:A,serialNumberData:Le,showCheckboxes:!0,onSave:e=>{Ne(e)},selectedSerials:be})]})})})};var $=o(99635),R=o(52351),G=o(68388);const U=e=>{let{values:t,onEdit:o,onDelete:r,onView:a}=e;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(l.A,{title:"Edit",placement:"bottom",children:(0,w.jsx)(i.A,{color:"secondary",onClick:()=>o(t),children:(0,w.jsx)(d.A,{})})}),(0,w.jsx)(l.A,{title:"Delete",placement:"bottom",children:(0,w.jsx)(i.A,{color:"secondary",onClick:()=>r(t),children:(0,w.jsx)(u.A,{})})}),(null===t||void 0===t?void 0:t.isSerialNumber)&&(0,w.jsx)(l.A,{title:"View Serial Number",placement:"bottom",children:(0,w.jsx)(i.A,{color:"secondary",onClick:()=>a(t),children:(0,w.jsx)(v.A,{})})})]})},Q=()=>{const e=(0,c.Zp)(),[t,o]=(0,r.useState)([]),[l,i]=(0,r.useState)(!1),[d,u]=(0,r.useState)([]),[v,m]=(0,r.useState)([]),[x,S]=(0,r.useState)({}),[p,g]=(0,r.useState)({}),[j,y]=(0,r.useState)(!1),[h,b]=(0,r.useState)(!1),[A,L]=(0,r.useState)(null),[k,O]=(0,r.useState)(!1),[M,T]=(0,r.useState)(null),[z,N]=(0,r.useState)(!1),[q,E]=(0,r.useState)(null),H=(0,a.wA)(),V=(0,r.useMemo)((()=>[{Header:"Actions",accessor:"actions"},{Header:"Name",accessor:"name"},{Header:"Code",accessor:"code"},{Header:"Quantity",accessor:"quantity"},{Header:"UOM",accessor:"uomName"},{Header:"From Store Location",accessor:"fromStoreLocationName"}]),[]),Q=()=>{u([]),g({}),S({}),b(!1),L(null)},W=(0,r.useCallback)((e=>{y(!1),b(!0),S({...e,StoreLocationId:null===A||void 0===A?void 0:A.contractorStoreLocationId})}),[A]),Y=e=>{E(e),N(!0),null!==e&&void 0!==e&&e.material_serial_numbers||T([])};(0,r.useEffect)((()=>{null!==q&&void 0!==q&&q.material_serial_numbers&&T(null===q||void 0===q?void 0:q.material_serial_numbers)}),[q]);const{transactionMaterialList:J,serialNumbers:Z}=(0,P.t)(),{materials:X}=(0,r.useMemo)((()=>{var e;return{materials:(null===J||void 0===J?void 0:J.stocksObject)||[],count:(null===J||void 0===J||null===(e=J.stocksObject)||void 0===e?void 0:e.count)||0}}),[J]),{serialNumbersData:K}=(0,r.useMemo)((()=>{var e;return{serialNumbersData:(null===Z||void 0===Z?void 0:Z.data)||[],countSN:(null===Z||void 0===Z||null===(e=Z.data)||void 0===e?void 0:e.count)||0}}),[Z]);(0,r.useEffect)((()=>{if(l&&X){const e=(e=>{const t=[];return e&&e.length>0&&e.map((e=>{t.push({id:e.id,name:e.name,isSerialNumber:e.is_serial_number,tax:e.tax>0?e.tax:"0",value:e.value,uomName:e.uom_name,uomId:e.uom_id,rate:parseFloat(e.rate).toFixed(2),code:e.code,hsnCode:e.hsn_code,material_serial_numbers:K[e.id]?K[e.id]:[]})})),t})(X);o(e.filter((e=>"84b473e1-62bb-4afe-af56-1691bdffbc55"!==e.id)))}}),[X,K,l,W]);const ee=(0,G.A)({dataObject:J,key:"stocksObject",resetTrigger:null===A});return(0,r.useEffect)((()=>{Array.isArray(ee)&&0===ee.length&&(Q(),(0,_.A)("There are no available materials for your selected combination",{variant:"error"}))}),[ee]),(0,w.jsxs)(w.Fragment,{children:[k&&(0,w.jsx)(R.A,{}),(0,w.jsx)(C,{disableAll:!!A,onClick:Q,saveData:e=>{e&&e.projectId&&e.contractorStoreId&&(L(e),i(!0),H((0,f.UjX)({project:e.projectId,store:e.contractorStoreId})))}}),A&&t&&t.length>0&&(0,w.jsx)(B,{materials:t,onMaterailsInput:(e,o,r)=>{((e,o)=>{o&&(t.map((t=>{let r={};if(t.id===e.materialId){r={...structuredClone(t),...e},r.uomId=null===t||void 0===t?void 0:t.uomId;let a=v;a.push(r.fromStoreLocationId),m(a);const l=d.findIndex((t=>t.id===o&&(null===e||void 0===e?void 0:e.fromStoreLocationId)===(null===t||void 0===t?void 0:t.fromStoreLocationId)));if(l>=0){const e=structuredClone(d);e[l]=r,u(e)}else u(d.concat(r))}})),b(!1))})(e,o);const a={...p};a[r]||(a[r]={}),a[r]=e,g(a)},hideTaxDetails:!0,formData:A,view:j,update:h,showData:x,selectedLocations:v,selectedItems:p}),A&&d&&d.length>0&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)($.default,{title:"",hideHeader:!0,hidePagination:!0,data:(e=>{const t=[];return e&&e.length>0&&e.map(((e,o)=>{t.push({...e,actions:(0,w.jsx)(U,{values:e,onEdit:W,onDelete:e=>{((e,t)=>{if(d){const o=d.filter(((t,o)=>o!==e));let r=[];o.map((e=>r.push(e.fromStoreLocationId))),u(o),m(r),delete p[t.materialId+t.fromStoreLocationId]}})(o,e)},onView:Y})})})),t})(d),count:d.length,columns:V,hideActions:!0}),z&&q&&M&&(0,w.jsx)(F.default,{open:z,onClose:()=>{N(!1)},serialNumberData:M})]}),(0,w.jsx)(I.Op,{children:(0,w.jsx)(n.Ay,{container:!0,spacing:4,children:(0,w.jsxs)(n.Ay,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",gap:"20px",mt:2},children:[A&&(0,w.jsx)(s.A,{onClick:Q,size:"small",variant:"outlined",color:"primary",children:"Back"}),A&&t&&t.length>0&&(0,w.jsx)(s.A,{disabled:h||k,onClick:async()=>{var t,o,r,a;O(!0);const l={transactionTypeId:A.transactionTypeId,installerId:A.installerId,stock_ledgers:(i=d,n=A,i.filter((e=>parseFloat(e.quantity)>0)).map((e=>({transactionTypeId:n.transactionTypeId,organizationId:n.contractorId,projectId:n.projectId,fromStoreLocationId:e.fromStoreLocationId,storeId:n.contractorStoreId,storeLocationId:n.organizationStoreLocationId,materialId:e.id,uomId:e.uomId,quantity:e.quantity,rate:e.rate,value:e.value,tax:e.tax,remarks:n.remarks,serialNumber:e.material_serial_numbers}))))};var i,n;if(0===(null===(t=l.stock_ledgers)||void 0===t?void 0:t.length))return(0,_.A)("Please have atleast one material with some quantity",{variant:"error"}),void O(!1);const s=await(0,D.default)("/cti-transaction-create",{method:"POST",body:l,timeoutOverride:12e4});var u;if(!s.success)return(0,_.A)((null===s||void 0===s||null===(u=s.error)||void 0===u?void 0:u.message)||"Operation failed. Please try again!",{variant:"error"}),void O(!1);const c=null!==(o=null===(r=s.data)||void 0===r?void 0:r.data)&&void 0!==o?o:{},v=c.referenceDocumentNumber||(null===(a=c[0])||void 0===a?void 0:a.referenceDocumentNumber);(0,_.A)(v?`Transaction created with reference number: ${v}`:"Transaction created successfully!",{variant:"success",autoHideDuration:1e4}),O(!1),e("/stock-ledger")},size:"small",variant:"contained",color:"primary",children:"Submit"})]})})})]})}},88848:(e,t,o)=>{o.d(t,{$:()=>l});var r=o(9950),a=o(27081);const l=()=>{const[e,t]=(0,r.useState)({masterMakerLovsObject:{},error:"",loading:!0}),[o,l]=(0,r.useState)({masterMakerLovsObject:{},error:"",loading:!0}),[i,n]=(0,r.useState)({masterObject:[],error:"",loading:!0}),[s,d]=(0,r.useState)({masterObject:[],error:"",loading:!0}),[u,c]=(0,r.useState)({masterObject:[],error:"",loading:!0}),[v,m]=(0,r.useState)({currencyObject:[],error:"",loading:!0}),[x,S]=(0,r.useState)({gstStatusObject:[],error:"",loading:!0}),[p,g]=(0,r.useState)({paymentTermObject:[],error:"",loading:!0}),[f,I]=(0,r.useState)({incotermsObject:[],error:"",loading:!0}),[j,y]=(0,r.useState)({titleObject:[],error:"",loading:!0}),[h,b]=(0,r.useState)({masterMakerLovHistoryObject:{},error:"",loading:!0}),A=(0,a.d4)((e=>e.masterMakerLov||{})),L=(0,a.d4)((e=>e.masterMakerLovList||{})),k=(0,a.d4)((e=>e.lovsForMasterName||[])),O=(0,a.d4)((e=>e.lovsForMasterNameSecond||[])),M=(0,a.d4)((e=>e.lovsForMasterNameThird||[])),T=(0,a.d4)((e=>e.currency||[])),z=(0,a.d4)((e=>e.gstStatus||[])),N=(0,a.d4)((e=>e.paymentTerm||[])),w=(0,a.d4)((e=>e.incoterms||[])),C=(0,a.d4)((e=>e.title||[])),q=(0,a.d4)((e=>e.masterMakerLovHistory||{}));return(0,r.useEffect)((()=>{t((e=>({...e,...A})))}),[A]),(0,r.useEffect)((()=>{l((e=>({...e,...L})))}),[L]),(0,r.useEffect)((()=>{n((e=>({...e,...k})))}),[k]),(0,r.useEffect)((()=>{d((e=>({...e,...O})))}),[O]),(0,r.useEffect)((()=>{c((e=>({...e,...M})))}),[M]),(0,r.useEffect)((()=>{m((e=>({...e,...T})))}),[T]),(0,r.useEffect)((()=>{S((e=>({...e,...z})))}),[z]),(0,r.useEffect)((()=>{g((e=>({...e,...N})))}),[N]),(0,r.useEffect)((()=>{I((e=>({...e,...w})))}),[w]),(0,r.useEffect)((()=>{y((e=>({...e,...C})))}),[C]),(0,r.useEffect)((()=>{b((e=>({...e,...q})))}),[q]),{masterMakerLovs:e,masterMakerLovsList:o,masterMakerOrgType:i,masterMakerOrgTypeSecond:s,masterMakerOrgTypeThird:u,masterMakerCurrency:v,masterMakerGstStatus:x,masterMakerIncoterms:f,masterMakerPaymentTerm:p,masterMakerLovHistory:h,masterMakerTitle:j}}},79033:(e,t,o)=>{o.d(t,{z:()=>l});var r=o(9950),a=o(27081);const l=()=>{const[e,t]=(0,r.useState)({rolesObject:{},error:"",loading:!0}),[o,l]=(0,r.useState)({roleProjectsObject:[],error:"",loading:!0}),[i,n]=(0,r.useState)({rolesHistoryObject:{},error:"",loading:!0}),s=(0,a.d4)((e=>e.roles||{})),d=(0,a.d4)((e=>e.roleProjects||[])),u=(0,a.d4)((e=>e.rolesHistory||{}));return(0,r.useEffect)((()=>{t((e=>({...e,...s})))}),[s]),(0,r.useEffect)((()=>{l((e=>({...e,...d})))}),[d]),(0,r.useEffect)((()=>{n((e=>({...e,...u})))}),[u]),{roles:e,roleProjects:o,rolesHistory:i}}},66004:(e,t,o)=>{o.d(t,{k:()=>a});var r=o(27081);const a=()=>({users:(0,r.d4)((e=>e.users)),usersByPermission:(0,r.d4)((e=>e.usersByPermission)),usersWithForms:(0,r.d4)((e=>e.usersWithForms)),usersSecond:(0,r.d4)((e=>e.usersSecond)),usersHistory:(0,r.d4)((e=>e.usersHistory)),supervisorUsers:(0,r.d4)((e=>e.supervisorUsers))})},62375:(e,t,o)=>{var r=o(24994);t.A=void 0;var a=r(o(79526)),l=o(44414);t.A=(0,a.default)((0,l.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")}}]);