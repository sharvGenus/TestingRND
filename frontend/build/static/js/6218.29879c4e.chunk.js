"use strict";(self.webpackChunkgenus_power=self.webpackChunkgenus_power||[]).push([[6218],{6218:(e,t,o)=>{o.r(t),o.d(t,{default:()=>_});var i=o(80415),l=o(9950),r=o(12257),n=o(14857),d=o(2683),a=o(4139),u=o(87233),s=o(67535),m=o(74745),c=o(9449),v=o(60666),p=o(28429),h=o(42074),y=o(26473),f=o(27081),A=o(15999),b=o(76300),x=o(29024),g=o(96951),w=o(71826),j=o(84601),I=o(10447),C=o(62054),S=o(99635),V=o(64499),O=o(26059),T=o(44414);const k=function(e,t,o,i,l){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];return(0,T.jsx)(r.A,{spacing:1,children:(0,T.jsx)(g.o3,{name:e,type:o,label:t,placeholder:l,InputLabelProps:{shrink:n},...i&&{required:!0}})})},W=e=>{const{conditionsArray:t,setConditionsArray:o,columnData:n,dropdownLOVs:d,setDropdownLOVs:m,formId:p}=e,[h,f]=(0,l.useState)(),[b,x]=(0,l.useState)(),I=(0,c.mN)({resolver:(0,y.t)(v.Ik().shape({fromAttributeId:j.A.other,operatorKey:j.A.other})),defaultValues:{},mode:"all"}),{handleSubmit:S}=I,V=(e,t,o,i,l,n)=>(0,T.jsx)(r.A,{children:(0,T.jsx)(g.eu,{name:e,placeholder:l,label:t,onChange:n,InputLabelProps:{shrink:!0},menus:o,...i&&{required:!0}})}),[O,W]=(0,l.useState)(),[_,D]=(0,l.useState)();return(0,T.jsx)(g.Op,{methods:I,onSubmit:S((async e=>{const{fromAttributeId:i,operatorKey:l,compareWithFormAttributeId:r,compareWithValue:n}=e;o([...t,{fromAttributeId:i,operatorKey:l,compareWithFormAttributeId:r||null,compareWithValue:n,compare_with_form_value:{name:b},form_attribute:{name:h}}]),I.reset({operatorKey:"",compareWithValue:"",compareWithFormAttributeId:"",compare_with_form_value:"",form_attribute:"",fromAttributeId:""}),m([])})),children:(0,T.jsx)(a.Ay,{container:!0,alignItems:"center",sx:{pl:4,pr:4},children:(0,T.jsxs)(a.Ay,{container:!0,rowSpacing:4,columnSpacing:3,mt:1,mb:3,direction:"row",children:[(0,T.jsxs)(a.Ay,{item:!0,md:2.5,xl:2.5,children:[V("fromAttributeId","Column",n.filter((e=>{var t;return!["dateOnly","timeOnly"].includes(null===(t=e.properties)||void 0===t?void 0:t.pickerType)})),!0,"Select Column",(async e=>{var t,o,i,l,r,n,d,a,u,s,c,v,h,y;I.resetField("compareWithFormAttributeId"),I.resetField("compareWithValue"),f(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.name),D(null===e||void 0===e||null===(o=e.target)||void 0===o?void 0:o.value),W(null===e||void 0===e||null===(i=e.target)||void 0===i?void 0:i.type);const A=[{name:null===e||void 0===e||null===(l=e.target)||void 0===l?void 0:l.name,sourceTable:null===e||void 0===e||null===(r=e.target)||void 0===r||null===(n=r.row)||void 0===n||null===(d=n.properties)||void 0===d?void 0:d.sourceTable,sourceColumn:null===e||void 0===e||null===(a=e.target)||void 0===a||null===(u=a.row)||void 0===u||null===(s=u.properties)||void 0===s?void 0:s.sourceColumn,type:"and",conditions:null===e||void 0===e||null===(c=e.target)||void 0===c||null===(v=c.row)||void 0===v||null===(h=v.properties)||void 0===h?void 0:h.conditions}];if("Dropdown"===(null===e||void 0===e||null===(y=e.target)||void 0===y?void 0:y.type)){const t=await(0,w.default)("/form-get-dropdown-field-data",{method:"POST",body:{formId:p,formDropdowns:A}});var b,x,g;if(t.success)m(null===(b=t.data)||void 0===b||null===(x=b.dropdownData[0])||void 0===x?void 0:x[null===(g=e.target)||void 0===g?void 0:g.name]);else(0,C.A)(t.error.message,{variant:"error"})}}))," "]}),(0,T.jsx)(a.Ay,{item:!0,md:.15,xl:.15}),(0,T.jsx)(a.Ay,{item:!0,md:2,xl:2,children:V("operatorKey","Operation",i.we,!0,"Select")}),(0,T.jsx)(a.Ay,{item:!0,md:.15,xl:.15}),"Dropdown"!==O&&(0,T.jsxs)(a.Ay,{item:!0,md:2.5,xl:2.5,children:[V("compareWithFormAttributeId","Matching Column",n.filter((e=>{var t;return!["dateOnly","timeOnly"].includes(null===(t=e.properties)||void 0===t?void 0:t.pickerType)})),!1,"Select Column",(e=>{var t;x(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.name)}))," "]}),"Dropdown"!==O&&(0,T.jsx)(a.Ay,{item:!0,md:.5,xl:.5,sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,T.jsx)(u.A,{children:"OR"})}),"Chip Select"===O||"Checkbox"===O?(0,T.jsx)(a.Ay,{item:!0,md:2.5,xl:2.5,children:V("compareWithValue","Matching Value",I.watch("fromAttributeId")?n.filter((e=>(null===e||void 0===e?void 0:e.id)==_)).flatMap((e=>{var t,o;return Object.keys(null===e||void 0===e?void 0:e.properties).length?null===e||void 0===e||null===(t=e.properties)||void 0===t||null===(o=t.values)||void 0===o?void 0:o.split(",").map((e=>({name:e,id:e}))):[]})):[],!1,"Select Value")}):"Date Time"===O?(0,T.jsxs)(a.Ay,{item:!0,md:2.5,xl:2.5,children:[(0,T.jsx)(A.A,{name:"compareWithValue",label:"Matching Value",pickerType:"dateTimeBoth",timeFormat:"24hour",format:"dd/MM/yyyy HH:mm"})," "]}):"Dropdown"===O?(0,T.jsx)(a.Ay,{item:!0,md:2.5,xl:2.5,children:V("compareWithValue","Matching Value",d,!1,"Select Value")}):(0,T.jsx)(a.Ay,{item:!0,md:2.5,xl:2.5,children:k("compareWithValue","Matching Value","text",!1,"Enter Value")}),(0,T.jsx)(a.Ay,{item:!0,md:1,sx:{mt:4},children:(0,T.jsx)(s.A,{variant:"contained",size:"small",color:"primary",type:"submit",children:"Add"})})]})})})},_=()=>{var e,t;const o=(0,n.A)(),{formId:i}=(0,p.g)(),r=(0,p.zy)(),A=(0,f.wA)(),_=null===(e=r.state)||void 0===e?void 0:e.blockData,[D,M]=(0,l.useState)([]),[P,E]=(0,l.useState)([]),[F,H]=(0,l.useState)(!1),[R,K]=(0,l.useState)(null),z=(0,p.Zp)(),L=(0,c.mN)({resolver:(0,y.t)(v.Ik().shape({name:j.A.other,endpoint:j.A.other,type:j.A.other,method:j.A.other})),defaultValues:{},mode:"all"}),{handleSubmit:N,setValue:B}=L;(0,l.useEffect)((()=>{(null===_||void 0===_?void 0:_.id)&&A((0,x.yS1)(null===_||void 0===_?void 0:_.id))}),[A,null===_||void 0===_?void 0:_.id]);const{attributeIntegrationCondition:q}=(0,b.I)(),Q=(0,l.useMemo)((()=>{var e;return(null===q||void 0===q||null===(e=q.formAttributeIntegrationConditionObject)||void 0===e?void 0:e.rows)||[]}),[q]);(0,l.useEffect)((()=>{M((e=>[...e,...Q]))}),[Q]);(0,l.useEffect)((()=>{var e;B("name",null===_||void 0===_?void 0:_.name),B("endpoint",null===_||void 0===_?void 0:_.endpoint),B("auth",null===_||void 0===_?void 0:_.auth),B("type",null===_||void 0===_?void 0:_.type),B("method",null===_||void 0===_?void 0:_.method),B("fromAttribute",null===_||void 0===_||null===(e=_.form_attribute)||void 0===e?void 0:e.id)}),[_,B]);const U=null!==_&&void 0!==_&&_.id?async e=>{e.formId=i,e.conditionsArray=D,e.integrationBlockId=null===_||void 0===_?void 0:_.id;const t=await(0,w.default)("/attribute-integration-block-update",{method:"PUT",body:e,params:null===_||void 0===_?void 0:_.id});t.success?z(`/form-integration-rules/${i}`):(0,C.A)(t.error.message,{variant:"error"})}:async e=>{e.conditionsArray=D,e.formId=i;const t=await(0,w.default)("/attribute-integration-block-create",{method:"POST",body:e});t.success?z(`/form-integration-rules/${i}`):(0,C.A)(t.error.message,{variant:"error"})};(0,l.useEffect)((()=>(i&&A((0,x.u44)({formId:i,sortBy:"rank",sortOrder:"ASC"})),()=>{A(I.wF.actions.reset()),A(I.aE.actions.reset())})),[A,i]);const{formAttributes:$}=(0,b.I)(),Z=(0,l.useMemo)((()=>{var e;return(null===$||void 0===$||null===(e=$.formAttributesObject)||void 0===e?void 0:e.rows)||[]}),[null===$||void 0===$||null===(t=$.formAttributesObject)||void 0===t?void 0:t.rows]),[G,J]=(0,l.useState)({}),X=(0,l.useRef)([]),Y=(0,l.useCallback)((async e=>{var t;const o=null===Z||void 0===Z?void 0:Z.find((t=>t.id===e.fromAttributeId));if(o&&"dropdown"===(null===o||void 0===o||null===(t=o.default_attribute)||void 0===t?void 0:t.inputType)){var l,r,n;const t=[{name:"lov",sourceTable:null===o||void 0===o||null===(l=o.properties)||void 0===l?void 0:l.sourceTable,sourceColumn:null===o||void 0===o||null===(r=o.properties)||void 0===r?void 0:r.sourceColumn,type:"and",conditions:[{column:null===O.Q||void 0===O.Q||null===(n=O.Q.find((e=>{var t;return e.id===(null===o||void 0===o||null===(t=o.properties)||void 0===t?void 0:t.sourceTable)})))||void 0===n?void 0:n.tableIdCell,operation:"et",value:e.compareWithValue}]}],s=await(0,w.default)("/form-get-dropdown-field-data",{method:"POST",body:{formId:i,formDropdowns:t}});var d,a,u;return s.success?null===(d=s.data)||void 0===d||null===(a=d.dropdownData[0])||void 0===a||null===(u=a.lov[0])||void 0===u?void 0:u.name:""}return""}),[Z,i]);(0,l.useEffect)((()=>{Z&&Z.length>0&&(async()=>{const e=X.current,t=null===D||void 0===D?void 0:D.filter((t=>!e.includes(t)));if(t.length>0){const e=(await Promise.all(t.map((async e=>({id:e.compareWithValue,name:await Y(e)}))))).reduce(((e,t)=>{let{id:o,name:i}=t;return i&&(e[o]=i),e}),{});J((t=>({...t,...e})))}X.current=D})()}),[D,Y,Z]);const ee=[{Header:"Column",accessor:"form_attribute.name"},{Header:"Operator",accessor:"operatorKey"},{Header:"Matching Column / Value",accessor:e=>{var t,o,i,l;return"dropdown"===(null===Z||void 0===Z||null===(t=Z.find((t=>t.id===e.fromAttributeId)))||void 0===t||null===(o=t.default_attribute)||void 0===o?void 0:o.inputType)?G[e.compareWithValue]:e.compareWithValue||(null===(i=e.compare_with_column)||void 0===i?void 0:i.name)||(null===(l=e.compare_with_form_value)||void 0===l?void 0:l.name)}}];return(0,T.jsxs)(d.A,{sx:{maxHeight:"85vh",minHeight:"85vh",overflow:"auto",border:"1px solid",borderRadius:1,borderColor:o.palette.grey.A800,boxShadow:"inherit"},children:[(0,T.jsxs)(g.Op,{methods:L,onSubmit:N(U),children:[(0,T.jsxs)(a.Ay,{sx:{position:"absolute",top:0,width:"100%",background:"white",zIndex:10,p:2,pb:0},children:[(0,T.jsx)(a.Ay,{container:!0,children:(0,T.jsxs)(a.Ay,{item:!0,md:12,sx:{display:"flex",justifyContent:"space-between"},children:[(0,T.jsx)(u.A,{variant:"h4",children:null!==_&&void 0!==_&&_.id?"Edit Integration Rule":"Add Integration Rule"}),(0,T.jsxs)(a.Ay,{item:!0,sx:{display:"flex",gap:2},children:[(0,T.jsx)(s.A,{component:h.N_,to:"/form-integration-rules/"+i,size:"small",variant:"outlined",color:"primary",children:"Back"}),null!==_&&void 0!==_&&_.id?(0,T.jsx)(s.A,{size:"small",type:"submit",variant:"contained",color:"primary",children:"Update"}):(0,T.jsx)(s.A,{size:"small",type:"submit",variant:"contained",color:"primary",children:"Save"})]})]})}),(0,T.jsx)(m.A,{sx:{mt:2}})]}),(0,T.jsxs)(a.Ay,{container:!0,spacing:4,sx:{pl:4,pr:4,pt:2,mt:5,mb:2},children:[(0,T.jsx)(a.Ay,{item:!0,md:3,xl:3,children:k("name","Rule Name","text",!0,"Rule Name")}),(0,T.jsx)(a.Ay,{item:!0,md:3,xl:3,children:k("endpoint","API Endpoint","text",!0,"API Endpoint")}),(0,T.jsx)(a.Ay,{item:!0,md:3,xl:3,children:(0,T.jsx)(g.eu,{name:"method",placeholder:"Select Method",label:"Method",menus:[{id:"put",name:"PUT"},{id:"post",name:"POST"},{id:"patch",name:"PATCH"}],required:!0})}),(0,T.jsx)(a.Ay,{item:!0,md:3,xl:3,children:(0,T.jsx)(g.eu,{name:"type",placeholder:"Select Condition Type",label:"Condition Type",menus:[{id:"and",name:"AND ( Match all of below )"},{id:"or",name:"OR ( Match any of below )"}],required:!0})})]})]}),(0,T.jsx)(W,{blockData:_,setConditionsArray:M,conditionsArray:D,columnData:Z,dropdownLOVs:P,setDropdownLOVs:E,formId:i}),(0,T.jsx)(a.Ay,{sx:{width:"95%",pl:4,pr:4,pt:2,mb:4},children:(0,T.jsx)(S.default,{hidePagination:!0,hideHistoryIcon:!0,hideViewIcon:!0,hideEditIcon:!0,hideEmptyTable:!0,hideHeader:!0,data:D.filter((e=>0!=(null===e||void 0===e?void 0:e.isActive))),columns:ee,count:D.filter((e=>0!=(null===e||void 0===e?void 0:e.isActive))).length,handleRowDelete:async e=>{K(e),H(!0)}})}),(0,T.jsx)(V.A,{open:F,handleClose:()=>H(!1),handleConfirm:()=>{const e=D.findIndex((e=>(null===e||void 0===e?void 0:e.id)===R||(null===e||void 0===e?void 0:e.fromAttributeId)===(null===R||void 0===R?void 0:R.fromAttributeId)&&(null===e||void 0===e?void 0:e.operatorKey)===(null===R||void 0===R?void 0:R.operatorKey)&&(null===e||void 0===e?void 0:e.compareWithFormAttributeId)===(null===R||void 0===R?void 0:R.compareWithFormAttributeId)&&(null===e||void 0===e?void 0:e.compareWithValue)===(null===R||void 0===R?void 0:R.compareWithValue)&&!("isActive"in e)));if(-1!==e){const t={...D[e]};t.isActive=0,D[e]=t}H(!1)},title:"Delete Condition",message:"Are you sure you want to delete?",confirmBtnTitle:"Delete"})]})}}}]);